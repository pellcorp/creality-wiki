{"config":{"lang":["en"],"separator":"[\\s\\u200b\\-_,:!=\\[\\]()\"`/]+|\\.(?!\\d)|&[lg]t;|(?!\\b)(?=[A-Z][a-z])","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"additional_camera/","title":"Additional Camera","text":"<p>For Simple AF for RPi you can setup multiple cameras via crowsnest.  However for K1 Series (which includes K1, K1M, K1SE, K1C, Ender 5 Max and Ender 3 V3 KE) you  cannot run more than one camera on the printer itself, the webcam service only supports a single camera because trying to run more than one camera is  a really bad idea on this hardware.</p> <p>The solution on K1 Series for additional cameras is to setup a separate RPi or Orange Pi (or the like) on the same network as your printer and install crowsnest. and then update /usr/data/printer_data/config/webcam.conf with that camera so that fluidd and mainsail will load it, but the printer itself will have nothing to do with this.</p> <p>Get yourself a raspberry pi or an orange pi zero and get some kind of debian distribution installed, the following instructions will assume debian.</p>"},{"location":"additional_camera/#install-crowsnest","title":"Install Crowsnest","text":"<p>We use crowsnest on Simple AF for RPi, I am sure there are different options you can try but I know crowsnest so I will document that, lets get it installed first.</p> <pre><code>sudo apt-get update\nsudo apt-get --yes install make\ngit clone https://github.com/mainsail-crew/crowsnest.git ~/crowsnest\ncd crowsnest/\nsudo CROWSNEST_UNATTENDED=1 CROWSNEST_ADD_CROWSNEST_MOONRAKER=0 make install\n</code></pre> <p>Lets start it so it writes its default config which we will need next:</p> <pre><code>sudo systemctl enable crowsnest\nsudo systemctl start crowsnest\n</code></pre> <p>The config file for crowsnest will be located at <code>~/printer_data/config/crowsnest.conf</code></p> <p>The config file will look something like:</p> <pre><code>[crowsnest]\nlog_path: /home/orangepi/printer_data/logs/crowsnest.log\nlog_level: verbose                      # Valid Options are quiet/verbose/debug\ndelete_log: false                       # Deletes log on every restart, if set to true\nno_proxy: false                         # If set to true, no reverse proxy is required. Only change this, if you know what you are doing.\n\n[cam 1]\nmode: ustreamer                         # ustreamer - Provides MJPG and snapshots. (All devices)\n                                        # camera-streamer - Provides WebRTC, MJPG and snapshots. (only RPiOS + RPi 0/1/2/3/4)\nenable_rtsp: false                      # If camera-streamer is used, this also enables usage of an RTSP server\nrtsp_port: 8554                         # Set different ports for each device!\nport: 8080                              # HTTP/MJPG stream/snapshot port\ndevice: /dev/video0                     # See log for available devices\nresolution: 640x480                     # &lt;width&gt;x&lt;height&gt; format\nmax_fps: 15                             # If hardware supports it, it will be forced, otherwise ignored/coerced.\n#custom_flags:                          # You can run the stream services with custom flags.\n#v4l2ctl:                               # Add v4l2-ctl parameters to setup your camera, see log for your camera capabilities.\n</code></pre> <p>You must change the <code>no_proxy</code> from <code>false</code> to <code>true</code> because otherwise the camera service is not available on the wifi or ethernet interface.</p> <p>And additionally its possible you will need to change the device: <code>/dev/video0</code> to something else than the default and to find out what devices are  available you can use a crowsnest tool:</p> <pre><code>~/crowsnest/tools/dev-helper.sh -c\n</code></pre> <p></p> <p>Warning</p> <p>According to the crowsnest project, its always preferable to use full paths, especially in Mutlicam setups using /dev/video*  will lead to errors or unexpected behaviours.</p> <p>Source: https://crowsnest.mainsail.xyz/configuration/cam-section#device</p> <p>Note</p> <p>After you have changed the <code>no_proxy</code> and potentially the <code>device</code> you must restart crowsnest with <code>sudo systemctl restart crowsnest</code></p>"},{"location":"additional_camera/#enable-camera-in-moonraker","title":"Enable Camera in moonraker","text":"<p>You can just add an additional camera to the <code>webcam.conf</code> located in the config directory which you can edit via fluidd or mainsail and then just restart moonraker from the services menu, the additional config might look like:</p> <pre><code>[webcam additional]\nlocation: rpi\nenabled: True\nservice: mjpegstreamer\nflip_horizontal: False\nflip_vertical: False\nrotation: 0\ntarget_fps: 10\ntarget_fps_idle: 5\nstream_url: /webcam/?action=stream\nsnapshot_url: /webcam/?action=snapshot\nstream_url: http://X.X.X.X:8080/?action=stream\nsnapshot_url: http://X.X.X.X:8080/?action=snapshot\n</code></pre> <p>Where <code>X.X.X.X</code> would be replaced with the ip address of your RPi running crowsnest!</p> <p>More information about the format of webcam definitions can be found at https://moonraker.readthedocs.io/en/latest/configuration/#webcam</p>"},{"location":"backups/","title":"Backups","text":"<p>Every time the installer.sh is run a new backup of the existing printer_data/config directory is saved, this makes it possible to restore an earlier version of the config in case you get yourself into trouble.</p> <p>Danger</p> <p>Restoring a backup currently does not create a backup of your existing config before doing the restore, so you will lose any of you current changes, you can force a backup of your current config by first running:</p> <pre><code>~/pellcorp/tools/backup.sh --create\n</code></pre> <p>We might end up making a change to the backup.sh to do this in the near future!</p>"},{"location":"backups/#restoring-a-backup","title":"Restoring a backup","text":"<p>If you wish to revert to a previous version of your config files, its possible to do this via the backup tool.  You can get a list of all the backups with the command:</p> <pre><code>~/pellcorp/tools/backups.sh --list\n</code></pre> <p>Note</p> <p>If you run the above and receive an error like:</p> <pre><code>```\nroot@K1Max-AF34 /root [#] ~/pellcorp/tools/backups.sh --list\n-sh: /root/pellcorp/tools/backups.sh: not found\n```\n</code></pre> <p>It means you are on an older version of Simple AF and you should instead use the old style commands:</p> <pre><code>```\n/usr/data/pellcorp/k1/installer.sh --branch main\n~/pellcorp/tools/backups.sh --list\n```\n</code></pre> <p>And you can revert to one of them with:</p> <pre><code>~/pellcorp/tools/backups.sh --restore filename\n</code></pre> <p>Where <code>filename</code> is one of the backups listed, so for instance:</p> <pre><code>root@K1Max-AF34 /root [#] ~/pellcorp/tools/backups.sh --list\nbackup-2025-08-29_13-36-22.tar.gz\nbackup-latest.tar.gz\nbackup-2025-08-27_11-21-15.tar.gz\nbackup-2025-08-22_16-06-32.tar.gz\nbackup-2025-08-22_16-04-02.tar.gz\nbackup-2025-08-22_04-56-40.tar.gz\nbackup-2025-08-22_04-51-21.tar.gz\n</code></pre> <p>I can restore to:</p> <pre><code>~/pellcorp/tools/backups.sh --restore backup-2025-08-22_04-51-21.tar.gz\n</code></pre>"},{"location":"beacon/","title":"Beacon","text":""},{"location":"beacon/#where-can-i-get-help","title":"Where can I get help?","text":"<p>Come on over to the pellcorp discord server, here is the invite, the <code>#simple-af-beacon</code> channel has been setup for anyone wanting support for beacon.</p> <p>https://discord.gg/2uGDzyJ3WX</p>"},{"location":"beacon/#thanks","title":"Thanks","text":"<p>Thanks to https://raven3dtech.com.au/ and https://beacon3d.com for donating Beacon probes to the Simple AF project to add support and continue to support the Beacon.</p>"},{"location":"beacon/#firmware-requirements","title":"Firmware requirements","text":""},{"location":"beacon/#limits-on-x-and-y-microsteps","title":"Limits on X and Y microsteps","text":"<p>You cannot use more than <code>microsteps: 32</code> for <code>[stepper_x]</code> and <code>[stepper_y]</code>, the MCU cannot handle high microsteps, it puts too much pressure on the mainboard and it will cause stuttering and other reliability issues including random crashes.</p> <p>Note</p> <p>This limit generally does not apply to RPi Series Simple AF</p>"},{"location":"beacon/#k1-series","title":"K1 Series","text":"<p>This guide assumes you have a K1, K1C, K1SE or K1 Max and you are running stock creality firmware 1.3.3.5 or higher (The firmware 1.3.3.5 is much older than 1.3.3.46 for example), or alternately you can use my prerooted firmware.</p>"},{"location":"beacon/#ender-5-max","title":"Ender 5 Max","text":"<p>This guide assumes you are running stock Creality firmware 1.2.0.10 or higher on your Ender 5 Max.</p> <p>The stock firmware comes pre-rooted, with the default root password being <code>Creality@2024_Wh_464</code></p> <p>Please note that you will need to change the screen orientation to horizontal, here is a model for that https://www.printables.com/model/1246910-ender-5-max-screen-bracket</p>"},{"location":"beacon/#ender-3-v3-ke","title":"Ender 3 V3 KE","text":"<p>This guide assumes you have a stock Ender 3 V3 KE with Nebula Pad with Root enabled, when you get to installation below, you should specify the <code>--mount Default</code> to install Simple AF on the KE for Beacon.</p> <p>Please note that you will need to change the screen orientation to horizontal, here is a model for that https://www.printables.com/model/727362-ender-3-v3-ke-screen-holder-landscape-for-guppyscr, but please do not follow the installation instructions on that page, just print the model and remount your screen only!</p> <p>An alternative model which honestly seems a bit cleaner: https://www.printables.com/model/706657-creality-ender-3-v3-e3v3-se-ke-and-cr-10-se-portra</p>"},{"location":"beacon/#simple-af-for-rpi","title":"Simple AF for RPi","text":"<p>See Simple AF for RPi</p>"},{"location":"beacon/#slicer-settings","title":"Slicer Settings","text":"<p>Danger</p> <p>Creality Print won't be able to see your printer after you have installed Simple AF, the only tested slicer we all use is OrcaSlicer, likely if you want to use Creality Print you will need to print via usb.</p> <p>Cura Slicer won't work out of the box for configuring START_PRINT variables as below, you need to change the start print EXTRUDER_TEMP and BED_TEMP to pass in the correct values, but since I don't use Cura Slicer I can't advise on that!</p> <p>There is an assumption that you are using a slicer like OrcaSlicer and Machine G-code like:</p> <p></p> <p>Machine start G-code <pre><code>M140 S0\nM104 S0 \nSTART_PRINT EXTRUDER_TEMP=[nozzle_temperature_initial_layer] BED_TEMP=[bed_temperature_initial_layer_single]\n</code></pre></p> <p>Machine end G-code <pre><code>END_PRINT\n</code></pre></p>"},{"location":"beacon/#custom-bed-mesh-profile","title":"Custom Bed Mesh Profile","text":"<p>If you want to select a specific predefined bed mesh profile (which disables adaptive mesh generation), you can pass in an additional <code>START_PRINT</code> parameter:</p> <p>You can either hard code it to a particular model, like <code>BED_MESH_PROFILE=myprofile</code> or you can specify a profile based on orca slicer variables, such as <code>BED_MESH_PROFILE=\"[curr_bed_type] - [filament_type]\"</code>, but you have to make sure you have all the possible profiles defined for each of the bed type and filament type combinations.</p> <p></p>"},{"location":"beacon/#probe-installation","title":"Probe Installation","text":"<p>It is strongly recommended to connect your probe to the front USB port initially and use it for a while that way to make sure its stable, before directly wiring it to either the mainboard or making a cable for the lidar port (K1M users only).   If possible avoid destroying the original cable when you are making your lidar or direct mainboard connection as you might need it in the future!</p> <p>Danger</p> <p>If you are not using a side mount you must verify config changes for beacon.cfg before homing your printer, using Screws Tilt Calculate or doing a bed mesh!  </p> <p>Ignoring these instructions can lead to significant damage to your build plate and/or probe.</p>"},{"location":"beacon/#mount-options","title":"Mount Options","text":"Mount Printer Beacon URL Notes Default K1, K1C, K1M, K1SE RevH\u00a0Standard https://www.printables.com/model/1071641-beacon-probe-mounts-for-creality-k1-series BootyGantry K1, K1C, K1M, K1SE RevH\u00a0Standard https://github.com/tlace17/K1-Linear-Rail-Gantry/blob/main/STLs/Probe%20Mounts/Rail%20Carriage%20Carto%20Mount.stl SkeletorMK7 K1, K1C, K1M, K1SE RevH\u00a0Low\u00a0Profile https://www.printables.com/model/833769-the-skeletor-collection-a-creality-k1k1-maxk1c-coo SkeletorSideMount K1, K1C, K1M, K1SE All RevH variants https://www.printables.com/model/1362668-skeletor-mk7-side-mounted-cartographer-integration SimplyHexed Ender 5 Max RevH\u00a0Standard https://www.printables.com/model/1209230-ender-5-max-simply-hexed Default Ender 3 V3 KE RevH\u00a0Standard https://www.printables.com/model/732262-ender-3-v3-ke-beaconcartographer-mount Might require shimming depending on the hotend / nozzle you use"},{"location":"beacon/#nozzle-offset","title":"Nozzle Offset","text":"<p>Warning</p> <p>It is vital that you verify the coil to nozzle tip distance is within the valid range of 2.6 to 3mm, you can use this simple tool to verify the range:     https://www.printables.com/model/1325363-cartographer-and-beacon-z-offset-goldilocks-tool</p> <p>Just be sure to use digital calipers to verify the print printed with the correct size before relying on it, if you have trouble with  your z not being always entirely accurate consider printing the model on its side.</p>"},{"location":"beacon/#beacon-firmware","title":"Beacon Firmware","text":"<p>Warning</p> <p>You must have flashed your beacon with the latest beacon firmware (2.1.0 currently) before starting the installation</p> <p>For K1 Series Simple AF there is a guide.</p> <p>For Simple AF for RPi, you can use the standard beacon guide https://docs.beacon3d.com/contact/#51-firmware-update</p>"},{"location":"beacon/#installation","title":"Installation","text":"<p>Warning</p> <p>The installation section does not apply to Simple AF for RPi, See Simple AF for RPi</p> <p>The installation can only be performed on a printer which has been rooted and ssh granted</p> <p>You need root access, if you are not already root, then follow Helper Script Enable Root Access</p>"},{"location":"beacon/#factory-reset","title":"Factory Reset","text":"<p>You must do a factory reset only if you have installed Helper Script or Fluidd/Mainsail directly from Creality, otherwise you can safely proceed directly to installation.    If you have setup your printer with stock firmware only it can be quite handy to skip a factory reset so that you can use Switch to Stock</p> <pre><code>wget --no-check-certificate https://raw.githubusercontent.com/pellcorp/creality/main/k1/services/S58factoryreset -O /tmp/S58factoryreset\nchmod +x /tmp/S58factoryreset\n/tmp/S58factoryreset reset\n</code></pre> <p>Danger</p> <p>It is really important you do not close the ssh session until you get this message:</p> <p></p> <p>It can take up to 5 minutes for a factory restart to finish, it is vital you do not power cycle your printer before the stock screen appears. There may be a 3002 error on the screen, this is completely normal.   If you are planning to install Simple AF you can ignore it, if you are trying to go back to stock, power cycle the printer again to clear the error.  </p> <p>Failing to follow this advice can lead to your printer getting bricked and requiring much more involved intervention to recover!</p> <p></p>"},{"location":"beacon/#clone-the-repo","title":"Clone the Repo","text":"<pre><code>git config --global http.sslVerify false\ngit clone https://github.com/pellcorp/creality.git /usr/data/pellcorp\n</code></pre>"},{"location":"beacon/#run-the-installer","title":"Run the installer","text":"<p>Note</p> <p>If you have pellcorp-overrides in github but not stored locally, you need to recreate the ~/pellcorp-overrides directory before running the installer.sh!</p> <p>To run the script, you must use the following command:</p> <pre><code>/usr/data/pellcorp/installer.sh --install beacon --mount Mount\n</code></pre> <p>Warning</p> <p>For <code>Mount</code> you must specify the mount option for the mount you have used, if you do not do this the printer will be incorrectly configured for your mount, and bed meshes, x and y limits and related config will be wrong.   Please refer to Mount Options for supported mounts.   </p> <p>If you are using a non-supported mount you should specify a mount option as close to your mount as possible and properly adjust your configuration after installation before trying to perform a bed mesh or Screws Tilt Calculate!</p>"},{"location":"beacon/#post-installation","title":"Post Installation","text":""},{"location":"beacon/#mcu-firmware-updates-are-pending","title":"MCU Firmware updates are pending","text":"<p>At the end of the installer process if you get this message:</p> <pre><code>WARNING: MCU Firmware updates are pending you need to power cycle your printer!\n</code></pre> <p>It means that new MCU firmware updates need to be applied and this can only be done by power cycling the printer.  After your printer is power cycled you can verify firmware was updated with the <code>CHECK_FIRMWARE</code> macro from Fluidd or Mainsail, if you see this message:</p> <pre><code>INFO: Your MCU Firmware is up to date!\n</code></pre> <p>Your printer MCU firmware was updated successfully.   If you still see the <code>MCU Firmware updates are pending you need to power cycle your printer!</code> message after a power cycle, check the <code>/tmp/mcu_update.log</code>, you may be asked to provide this file on Discord if you need additional assistance, sometimes an additional power cycle can solve the problem, there is a very short window of time (15 seconds) in which the MCU firmware can be updated, so  there is a chance it will work after an additional power cycle.</p>"},{"location":"beacon/#verify-usb-key","title":"Verify USB Key","text":"<p>It is important to make sure you have a way to emergency factory reset the printer, if the worst happens.   There is a macro in Simple AF called <code>CHECK_USB_KEY</code> that will wait for you to plug a USB thumb drive (aka USB key) in and tell you if it was able to be successfully mounted.</p> <p>You can find the CHECK_USB_KEY macro in Fluidd or Mainsail, because Fluidd and Mainsail are already installed, you can access Fluidd by opening your browser and connecting using http://X.X.X.X, where X.X.X.X is your ip address that you used to login via ssh to your printer, you can also access Fluidd via http://X.X.X.X:4408 and Mainsail via http://X.X.X.X:4409!</p> <p></p> <p>After running the macro you should see output like the following:</p> <p></p> <ul> <li>If you get the message: <code>INFO - USB Key was recognised and mounted correctly (/tmp/udisk/sda1)</code>, your USB thumb drive (aka USB key) is perfect to use for a factory reset.</li> <li>If you get no message at all before the script ends (after 60 seconds), your USB thumb drive (aka USB key) is defective.   You can check the <code>messages</code> file in the logs section of your UI to get more details about why the usb key could not be mounted!</li> </ul> <p>Tip</p> <p>You should verify your USB thumb drive (aka USB key) often just to make sure you have something if you need to unbrick your printer, simply type <code>CHECK_USB_KEY</code> or hit the button in Fluidd / Mainsail The USB key should be FAT32 formatted and be no larger than 32GB!</p> <p>Note</p> <p>If you have plugged your beacon into the front usb port, you are going to have to temporarily remove the beacon from the front usb slot and replace it with your USB thumb drive (aka USB key), after you have finished verifying the USB thumb drive (aka USB key) can be used in an emergency, you can replace the beacon into the front usb slot and restart klipper or power cycle your printer.</p>"},{"location":"beacon/#calibration","title":"Calibration","text":"<p>Warning</p> <p>The following calibration steps are required to setup a new printer:</p> <ul> <li>Beacon Calibrate</li> <li>PID Tuning and Input Shaping</li> </ul>"},{"location":"beacon/#beacon-calibrate","title":"Beacon Calibrate","text":"<p>Note</p> <p>The beacon team recommends heat soaking the printer a bit before doing calibration</p> <ol> <li>Run <code>_SET_KIN_MAX_Z</code> and move toolhead so that the nozzle  of the beacon is only a few mm above the bed surface</li> <li>Run <code>_CALIBRATE_HEAT_SOAK</code>, which will heat the bed to 60c, nozzle to 150c and wait 8.5 minutes!</li> <li>Run the <code>STOP_CAMERA</code> macro to stop the camera</li> <li>Run the <code>TURN_OFF_HEATERS</code> macro to stop heaters before starting calibration</li> <li>Run <code>BEACON_CALIBRATE</code> Follow the Paper Test Method Upon completion <code>SAVE_CONFIG</code></li> </ol> <p>Warning</p> <p>Do not use a metal feeler gauge for this step, it could damage your beacon!!!</p> <p>Source: https://docs.beacon3d.com/quickstart/#6-calibrate-beacon</p> <p>Note</p> <p>Is normal to show the Z position at almost at the max height of the printer even if the nozzle is somewhere in the middle or even close to the bed, this is not a bug, its intentional.   Until this calibration step is completed, the Z axes cannot be homed, so we make the printer pretend the bed is down the bottom of the printer so that you can freely move the bed up to meet the nozzle during the paper test without running into out of range issues.  You however won't be able to move the bed further away from the nozzle more than a few mm.</p> <p></p>"},{"location":"beacon/#pid-tuning-and-input-shaping","title":"Pid Tuning and Input Shaping","text":"<p>At least PID tuning (bed and extruder) and input shaping is required for acceptable printing.  If you try and print after running the installer.sh and a power cycle but before any calibration you will most likely have horrendous quality, the worst you have ever seen on the k1.   After PID tuning and input shaping you should see the same kind of quality as you get with stock k1 + input shaper fix.</p> <p>Note</p> <p>You can use the QUICK_START Macro to complete Bed and Nozzle PID Tuning and Input Shaping Automatically.</p>"},{"location":"beacon/#pid-tuning","title":"Pid Tuning","text":"<p>Source: Calibrate Pid Settings</p> <p>For example you might run these:</p> <pre><code>PID_CALIBRATE_BED BED_TEMP=65\nPID_CALIBRATE_HOTEND HOTEND_TEMP=230\n</code></pre> <p>Note</p> <p>The <code>PID_CALIBRATE_BED</code> and <code>PID_CALIBRATE_HOTEND</code> macros are located in the <code>useful_macros.cfg</code> file and they have defaults values for BED_TEMP and HOTEND_TEMP so you can just run them by clicking on them if you want that same temperature.</p>"},{"location":"beacon/#input-shaping","title":"Input Shaping","text":"<p>There is no default configuration for input shaping so it is essentially disabled out of the box.</p> <p>You can use the <code>SHAPER_CALIBRATE</code> macro to run input shaping, just be sure to <code>SAVE CONFIG</code> at the end, to choose the automatically selected shaper config, be aware though that the shaper chosen might be sub-optimal due to a slight difference in vibrations between two options.  So you should probably review the output and potentially choose an alternative if it gives you higher recommended max acceleration for minimal increase in vibration.</p> <p>Input Shaper Auto Calibration</p>"},{"location":"beacon/#axis-twist-compensation","title":"Axis Twist Compensation","text":"<p>If you are using a rear mount it is highly recommended to perform axis twist compensation, this will affect the quality of your bed mesh, so best to do it before.</p> <p>Tip</p> <p>There is no need to run axis twist compensation if you have mounted the eddy with a side mount that has a 0 y offset!</p> <ol> <li>Home All (<code>G28</code>)</li> <li>Run <code>AXIS_TWIST_COMPENSATION_CALIBRATE</code> The calibration wizard will prompt you to measure the probe Z offset at a few points along the bed    Upon completion <code>SAVE_CONFIG</code></li> </ol> <p>Source: https://www.klipper3d.org/Axis_Twist_Compensation.html</p>"},{"location":"beacon/#first-print","title":"First Print","text":"<p>You should optimise your model offset using baby stepping.</p> <p>In fluidd the save button after you finish or cancel your print can be a bit hard to find, look for</p> <p></p>"},{"location":"beacon/#other-calibrations","title":"Other Calibrations","text":"<p>Info</p> <p>The default value for pressure advance is set to <code>0.04</code></p> <p>Refer to Orcaslicer Calibration for more calibrations</p> <p>Refer to the Ellis Print Tuning Guide for more great tuning ideas.</p>"},{"location":"beacon_faq/","title":"Frequently Asked Questions","text":""},{"location":"beacon_faq/#how-do-i-use-my-beacon-for-input-shaping","title":"How do I use my beacon for input shaping?","text":"<p>Note</p> <p>These instructions do not apply to Simple AF for RPi, although it is certainly possible to use the Beacon as ADXL on non creality printers.</p> <p>This just needs a few changes in <code>printer.cfg</code></p> <p>You can remove the <code>[adxl345]</code> section</p> <p>Change the <code>[resonance_tester]</code> <code>accel_chip</code> from <code>adxl345</code> to <code>beacon</code></p> <p>So your <code>[resonance_tester]</code> should look something like this:</p> <pre><code>[resonance_tester]\naccel_chip: beacon\naccel_per_hz: 75\nprobe_points:\n   110,110,10\n</code></pre> <p>Source: https://docs.beacon3d.com/config/#resonance_tester</p>"},{"location":"beacon_flashing/","title":"Beacon Flashing","text":"<p>Danger</p> <p>THIS IS A RISKY OPERATION YOU CAN BRICK YOUR BEACON</p>"},{"location":"beacon_flashing/#flashing-the-beacon","title":"Flashing the Beacon","text":"<p>You will need some kind of linux environment, this can be a Raspberry Pi, desktop Linux or even a Linux Server if you can plug something in via USB.   If you do not have anything like that, you will need to create a Live USB key running Ubuntu 24.04 Desktop edition.</p>"},{"location":"beacon_flashing/#creating-a-live-usb-key","title":"Creating a Live USB Key","text":"<p>You should create a live USB with Ubuntu 24.04 Desktop, make sure the USB is at least 8GB in size!</p> <p>https://ubuntu.com/tutorials/try-ubuntu-before-you-install#1-getting-started</p>"},{"location":"beacon_flashing/#install-some-deps-on-ubuntu","title":"Install some deps on Ubuntu","text":"<pre><code>sudo apt-get update\nsudo apt-get install virtualenv python3-dev python3-pip libffi-dev build-essential git dfu-util\n</code></pre>"},{"location":"beacon_flashing/#clone-klipper-and-beacon-klipper","title":"Clone Klipper and Beacon-Klipper","text":"<pre><code>git clone \"https://github.com/Klipper3d/klipper\" $HOME/klipper\ngit clone https://github.com/beacon3d/beacon_klipper.git $HOME/beacon-klipper\n</code></pre>"},{"location":"beacon_flashing/#setup-klipper-virtual-env","title":"Setup Klipper Virtual Env","text":"<pre><code>virtualenv --system-site-packages $HOME/klippy-env\n$HOME/klippy-env/bin/pip3 install -r $HOME/klipper/scripts/klippy-requirements.txt\n</code></pre>"},{"location":"beacon_flashing/#flash-beacon","title":"Flash Beacon","text":"<pre><code>cd $HOME/beacon-klipper\nsudo -E ./install.sh\n</code></pre>"},{"location":"beacon_troubleshooting/","title":"Troubleshooting","text":""},{"location":"beacon_troubleshooting/#manual-beacon-serial-device-configuration","title":"Manual Beacon Serial Device configuration","text":"<p>You can run the following command to fix your serial if you forgot to plug your beacon in during the installation or update:</p> <pre><code>~/pellcorp/k1/installer.sh --fix-serial\n</code></pre> <p>Note</p> <p>If you run the above and receive an error like:</p> <pre><code>```\nroot@K1Max-AF34 /root [#] ~/pellcorp/installer.sh --fix-serial\n-sh: /root/pellcorp/installer.sh: not found\n```\n</code></pre> <p>It means you are on an older version of Simple AF and you should instead use the old style commands:</p> <pre><code>```\n/usr/data/pellcorp/k1/installer.sh --fix-serial\n```\n</code></pre>"},{"location":"beacon_troubleshooting/#beaconprobe-object-has-no-attribute-_mcu_freq","title":"'BeaconProbe' object has no attribute '_mcu_freq'","text":"<p>This often indicates the beacon was disconnected during homing or some other operation, you need to reboot</p> <p></p> <p>On rare occasions this also occurs when the printer gets overloaded, if the error does not clear after a power cycle, try leaving your printer completely powered off for 15 minutes, see if the error clears afterwards.  If the error does not clear after doing this, I would be looking for a hardware issue, such as a dodgy cable.</p>"},{"location":"beacon_wiring/","title":"Beacon Wiring","text":"<p>Note</p> <p>This wiring section applies to K1/K1C/K1SE/K1M printers only</p> <p>On a K1M you can use the lidar cable either directly by repinning it, or via the pass through lidar port on the toolhead.  However you cannot use the lidar port on the toolhead for K1, K1C or K1SE.   The reason this does not work is because for Lidar on the K1M creality actually routes a completely separate USB cable from the mainboard.</p> <p></p>"},{"location":"bltouch/","title":"BL Touch, CR-Touch and 3D Touch","text":""},{"location":"bltouch/#where-can-i-get-help","title":"Where can I get help?","text":"<p>Come on over to the pellcorp discord server, the <code>#simple-af-bltouch</code> channel has been setup for anyone wanting support for bltouch, crtouch or 3dtouch.</p> <p>https://discord.gg/2uGDzyJ3WX</p>"},{"location":"bltouch/#what-about-crtouch","title":"What about CrTouch","text":"<p>Yep you can use a CrTouch as an alternative to a BlTouch, however I have not personally used either of these with a K1 and so I can't currently provide detailed guidance on what config is required.</p>"},{"location":"bltouch/#what-about-3d-touch","title":"What about 3d Touch","text":"<p>Its possible a 3d touch will work too, but depending on the capabilities of the 3d touch clone, you might need to make some post installation changes.   I also think 3dTouch might require slightly different wiring.</p> <p>Please refer to more details, specifically note the fact that the <code>QUERY_PROBE</code> may not be supported, and the <code>probe_with_touch_mode</code> feature is not supported!</p> <p>https://www.klipper3d.org/BLTouch.html#bl-touch-clones</p>"},{"location":"bltouch/#firmware-requirements","title":"Firmware requirements","text":""},{"location":"bltouch/#limits-on-x-and-y-microsteps","title":"Limits on X and Y microsteps","text":"<p>You cannot use more than <code>microsteps: 64</code> for <code>[stepper_x]</code> and <code>[stepper_y]</code>, the MCU cannot handle high microsteps, it puts too much pressure on the mainboard and it will cause stuttering and other reliability issues including random crashes.</p> <p>Note</p> <p>This limit generally does not apply to RPi Series Simple AF</p>"},{"location":"bltouch/#k1-series","title":"K1 Series","text":"<p>This guide assumes you have a K1, K1C, K1SE or K1 Max and you are running stock creality firmware 1.3.3.5 or higher (The firmware 1.3.3.5 is much older than 1.3.3.46 for example), or alternately you can use my prerooted firmware.</p>"},{"location":"bltouch/#ender-3-v3-ke","title":"Ender 3 V3 KE","text":"<p>This guide assumes you have a stock Ender 3 V3 KE with Nebula Pad with Root enabled, when you get to installation below, you should specify the <code>--mount Default</code> to install Simple AF on the KE for Cr-Touch.</p> <p>Please note that you will need to change the screen orientation to horizontal, here is a model for that https://www.printables.com/model/727362-ender-3-v3-ke-screen-holder-landscape-for-guppyscr, but please do not follow the installation instructions on that page, just print the model and remount your screen only!</p>"},{"location":"bltouch/#ender-5-max","title":"Ender 5 Max","text":"<p>This probe is currently not supported on Ender 5 Max</p>"},{"location":"bltouch/#simple-af-for-rpi","title":"Simple AF for RPi","text":"<p>See Simple AF for RPi</p>"},{"location":"bltouch/#slicer-settings","title":"Slicer Settings","text":"<p>Danger</p> <p>Creality Print won't be able to see your printer after you have installed Simple AF, the only tested slicer we all use is OrcaSlicer, likely if you want to use Creality Print you will need to print via usb.</p> <p>Cura Slicer won't work out of the box for configuring START_PRINT variables as below, you need to change the start print EXTRUDER_TEMP and BED_TEMP to pass in the correct values, but since I don't use Cura Slicer I can't advise on that!</p> <p>There is an assumption that you are using a slicer like OrcaSlicer and Machine G-code like:</p> <p></p> <p>Machine start G-code <pre><code>M140 S0\nM104 S0 \nSTART_PRINT EXTRUDER_TEMP=[nozzle_temperature_initial_layer] BED_TEMP=[bed_temperature_initial_layer_single]\n</code></pre></p> <p>Machine end G-code <pre><code>END_PRINT\n</code></pre></p>"},{"location":"bltouch/#custom-bed-mesh-profile","title":"Custom Bed Mesh Profile","text":"<p>If you want to select a specific predefined bed mesh profile (which disables adaptive mesh generation), you can pass in an additional <code>START_PRINT</code> parameter:</p> <p>You can either hard code it to a particular model, like <code>BED_MESH_PROFILE=myprofile</code> or you can specify a profile based on orca slicer variables, such as <code>BED_MESH_PROFILE=\"[curr_bed_type] - [filament_type]\"</code>, but you have to make sure you have all the possible profiles defined for each of the bed type and filament type combinations.</p> <p></p>"},{"location":"bltouch/#probe-installation","title":"Probe Installation","text":"<p>Danger</p> <p>If you are not using a side mount you must verify config changes for bltouch.cfg before homing your printer, using Screws Tilt Calculate or doing a bed mesh!  </p> <p>Ignoring these instructions can lead to significant damage to your build plate and/or probe.</p>"},{"location":"bltouch/#mount-options","title":"Mount Options","text":"Mount Printer URL Notes Default K1, K1C, K1M, K1SE https://www.printables.com/model/666186-creality-k1-bltouch-adapter CrTouch K1, K1C, K1M, K1SE https://www.printables.com/model/1073375-cr-touch-mount-k1-k1maxk1c-zero-y-offset Untested on K1M Default Ender 3 V3 SE N/A Default CR Touch Mount Default Ender 3 V3 KE N/A Default CR Touch Mount"},{"location":"bltouch/#installation","title":"Installation","text":"<p>Warning</p> <p>The installation section does not apply to Simple AF for RPi, See Simple AF for RPi</p> <p>The installation can only be performed on a printer which has been rooted and ssh granted</p> <p>You need root access, if you are not already root, then follow the excellent Helper Script Enable Root Access instructions.</p>"},{"location":"bltouch/#factory-reset","title":"Factory Reset","text":"<p>You must do a factory reset only if you have installed Helper Script or Fluidd/Mainsail directly from Creality, otherwise you can safely proceed directly to an installation.    If you have setup your printer with stock firmware only it can be quite handy to skip a factory reset so that you can use Switch to Stock</p> <p>Please note that because the Ender 5 Max and Ender 3 V3 KE both use the same basic software as the K1 series, the following step applies to these printers as well.</p> <pre><code>wget --no-check-certificate https://raw.githubusercontent.com/pellcorp/creality/main/k1/services/S58factoryreset -O /tmp/S58factoryreset\nchmod +x /tmp/S58factoryreset\n/tmp/S58factoryreset reset\n</code></pre> <p>Danger</p> <p>It is really important you do not close the ssh session until you get this message:</p> <p></p> <p>It can take up to 5 minutes for a factory restart to finish, it is vital you do not power cycle your printer before the stock screen appears. There may be a 3002 error on the screen, this is completely normal.   If you are planning to install Simple AF you can ignore it, if you are trying to go back to stock, power cycle the printer again to clear the error.  </p> <p>Failing to follow this advice can lead to your printer getting bricked and requiring much more involved intervention to recover!</p> <p></p>"},{"location":"bltouch/#clone-the-repo","title":"Clone the Repo","text":"<pre><code>git config --global http.sslVerify false\ngit clone https://github.com/pellcorp/creality.git /usr/data/pellcorp\n</code></pre>"},{"location":"bltouch/#run-the-installer","title":"Run the installer","text":"<p>Note</p> <p>If you have pellcorp-overrides in github but not stored locally, you need to recreate the ~/pellcorp-overrides directory before running the installer.sh!</p> <p>To run the script, you must specify the probe you want to use.</p> <pre><code>/usr/data/pellcorp/installer.sh --install bltouch --mount Mount\n</code></pre> <p>Warning</p> <p>For <code>Mount</code> you must specify the mount option for the mount you have used, if you do not do this the printer will be incorrectly configured for your mount, and bed meshes, x and y limits and related config will be wrong.   Please refer to Mount Options for supported mounts.   </p> <p>If you are using a non-supported mount you should specify a mount option as close to your mount as possible and properly adjust your configuration after installation before trying to perform a bed mesh or Screws Tilt Calculate!</p>"},{"location":"bltouch/#post-installation","title":"Post Installation","text":""},{"location":"bltouch/#mcu-firmware-updates-are-pending","title":"MCU Firmware updates are pending","text":"<p>At the end of the installer process if you get this message:</p> <pre><code>WARNING: MCU Firmware updates are pending you need to power cycle your printer!\n</code></pre> <p>It means that new MCU firmware updates need to be applied and this can only be done by power cycling the printer.  After your printer is power cycled you can verify firmware was updated with the <code>CHECK_FIRMWARE</code> macro from Fluidd or Mainsail, if you see this message:</p> <pre><code>INFO: Your MCU Firmware is up to date!\n</code></pre> <p>Your printer MCU firmware was updated successfully.   If you still see the <code>MCU Firmware updates are pending you need to power cycle your printer!</code> message after a power cycle, check the <code>/tmp/mcu_update.log</code>, you may be asked to provide this file on Discord if you need additional assistance, sometimes an additional power cycle can solve the problem, there is a very short window of time (15 seconds) in which the MCU firmware can be updated, so  there is a chance it will work after an additional power cycle.</p>"},{"location":"bltouch/#verify-usb-key","title":"Verify USB Key","text":"<p>It is important to make sure you have a way to emergency factory reset the printer, if the worst happens.   There is a macro in Simple AF called <code>CHECK_USB_KEY</code> that will wait for you to plug a USB thumb drive (aka USB key) in and tell you if it was able to be successfully mounted.</p> <p>You can find the CHECK_USB_KEY macro in Fluidd or Mainsail, because Fluidd and Mainsail are already installed, you can access Fluidd by opening your browser and connecting using http://X.X.X.X, where X.X.X.X is your ip address that you used to login via ssh to your printer, you can also access Fluidd via http://X.X.X.X:4408 and Mainsail via http://X.X.X.X:4409!</p> <p></p> <p>After running the macro you should see output like the following:</p> <p></p> <ul> <li>If you get the message: <code>INFO - USB Key was recognised and mounted correctly (/tmp/udisk/sda1)</code>, your USB thumb drive (aka USB key) is perfect to use for a factory reset.</li> <li>If you get no message at all before the script ends (after 60 seconds), your USB thumb drive (aka USB key) is defective.   You can check the <code>messages</code> file in the logs section of your UI to get more details about why the usb key could not be mounted!</li> </ul> <p>Tip</p> <p>You should verify your USB thumb drive (aka USB key) often just to make sure you have something if you need to unbrick your printer, simply type <code>CHECK_USB_KEY</code> or hit the button in Fluidd / Mainsail The USB key should be FAT32 formatted and be no larger than 32GB!</p>"},{"location":"bltouch/#calibration","title":"Calibration","text":"<p>Warning</p> <p>The following calibration steps are required to setup a new printer:</p> <ul> <li>Probe Calibrate</li> <li>PID Tuning and Input Shaping</li> </ul>"},{"location":"bltouch/#probe-calibrate","title":"Probe Calibrate","text":"<p>For the bltouch/3dtouch/crtouch it is extremely important to do the PROBE_CALIBRATE step to configure your z-offset, regardless of what model you have used to mount the probe!</p> <p></p> <ol> <li>Home All (<code>G28</code>)</li> <li>Run <code>PROBE_CALIBRATE</code></li> <li>Follow the Paper Test Method Upon completion <code>SAVE_CONFIG</code></li> </ol> <p>Note</p> <p>The default z-offset for BLTouch, 3dTouch and CrTouch is 0, so your prints won't stick without doing this step.</p>"},{"location":"bltouch/#pid-tuning-and-input-shaping","title":"Pid Tuning and Input Shaping","text":"<p>At least PID tuning (bed and extruder) and input shaping is required for acceptable printing.  If you try and print after running the installer.sh and a power cycle but before any calibration you will most likely have horrendous quality, the worst you have ever seen on the k1.   After PID tuning and input shaping you should see the same kind of quality as you get with stock k1 + input shaper fix.</p> <p>Note</p> <p>You can use the QUICK_START Macro to complete Bed and Nozzle PID Tuning and Input Shaping Automatically.</p>"},{"location":"bltouch/#pid-tuning","title":"Pid Tuning","text":"<p>Source: Calibrate Pid Settings</p> <p>For example you might run these:</p> <pre><code>PID_CALIBRATE_BED BED_TEMP=65\nPID_CALIBRATE_HOTEND HOTEND_TEMP=230\n</code></pre> <p>Note</p> <p>The <code>PID_CALIBRATE_BED</code> and <code>PID_CALIBRATE_HOTEND</code> macros are located in the <code>useful_macros.cfg</code> file and they have defaults values for BED_TEMP and HOTEND_TEMP so you can just run them by clicking on them if you want that same temperature.</p>"},{"location":"bltouch/#input-shaping","title":"Input Shaping","text":"<p>There is no default configuration for input shaping so it is essentially disabled out of the box.</p> <p>You can use the <code>SHAPER_CALIBRATE</code> macro to run input shaping, just be sure to <code>SAVE CONFIG</code> at the end, to choose the automatically selected shaper config, be aware though that the shaper chosen might be sub-optimal due to a slight difference in vibrations between two options.  So you should probably review the output and potentially choose an alternative if it gives you higher recommended max acceleration for minimal increase in vibration.</p> <p>Input Shaper Auto Calibration</p>"},{"location":"bltouch/#axis-twist-compensation","title":"Axis Twist Compensation","text":"<p>Next it is highly recommended to perform axis twist compensation calibration before doing anything else, this will affect the quality of your bed mesh, so best to do it before.</p> <ol> <li>Home All (<code>G28</code>)</li> <li>Run <code>AXIS_TWIST_COMPENSATION_CALIBRATE</code>  The calibration wizard will prompt you to measure the probe Z offset at a few points along the bed    Upon completion <code>SAVE_CONFIG</code></li> </ol> <p>Source: https://www.klipper3d.org/Axis_Twist_Compensation.html</p>"},{"location":"bltouch/#first-print","title":"First Print","text":"<p>You should optimise your probe z offset using baby stepping.</p> <p>In fluidd the save button after you finish or cancel your print can be a bit hard to find, look for</p> <p></p>"},{"location":"bltouch/#probing-speed","title":"Probing speed","text":"<p>On a K1/Max a faster lift_speed may counter the backlash on the Z-axis belts. Going too fast is likely making the bed bounce back in the opposite direction. Find the best speeds for probing by varying the probe_speed and lift_speed parameters.  Start with probe_speed=1 and vary the lift_speed values to find the optimal lift_speed first.</p> <pre><code>PROBE_ACCURACY probe_speed=1 lift_speed=15\n</code></pre> <p>In this case, lift_speed of 15mm/s seems optimal.</p> <p></p> <p>After determining the optimal lift_speed, different probe_speed values can be tested until the sweet spot is found. Here 1.0mm/s works most reliably, however, the slow speed will make the meshing process take longer.</p> <p></p> <p>Credit to Ales Omahen (@Havoc on discord) for this section</p>"},{"location":"bltouch/#other-calibrations","title":"Other Calibrations","text":"<p>Info</p> <p>The default value for pressure advance is set to <code>0.04</code></p> <p>Refer to Orcaslicer Calibration for more calibrations</p> <p>Refer to the Ellis Print Tuning Guide for more great tuning ideas.</p>"},{"location":"bltouch_wiring/","title":"BlTouch Wiring","text":"<p>Note</p> <p>This wiring section applies to K1/K1C/K1SE/K1M printers only</p> <p>The probe and the TOUCH port on the Nozzle MCU board both mate with a 5-pin Molex Picoblade connector. A 5-pin cable is needed to connect the probe to the TOUCH port.</p> <p>Some sellers may call the connector \"Micro JST SH 1.25\" but that is incorrect. Several premade cables are compatible. Most notably the Creality cable for their CR Touch probe:</p> <ul> <li>https://www.aliexpress.us/item/1005004960067376.html</li> <li>https://www.amazon.com/dp/B0BKPFY24M/</li> </ul> <p></p> <p></p> <p>Connect to TOUCH port on the nozzle MCU. it is accessible from the side left (LIDAR) side of the printhead and only the external cover of the printhead has to be removed.</p> <p></p> <p></p> <p>Important</p> <p>The configuration file assumes a bltouch is mounted on the back of the tool head.   If you have a Crtouch or are mounting your bltouch or 3dtouch using a different model, you must make additional changes to the bltouch.cfg file before trying to home your printer.</p> <p>Note</p> <p>Portions of this section are copied from the K1 Bltouch guide for helper script.</p>"},{"location":"btteddy/","title":"BTT Eddy","text":""},{"location":"btteddy/#where-can-i-get-help","title":"Where can I get help?","text":"<p>Come on over to the pellcorp discord server, the <code>#simple-af-btteddy</code> channel has been setup for anyone wanting support for btt eddy.</p> <p>https://discord.gg/2uGDzyJ3WX</p>"},{"location":"btteddy/#what-about-cfs-support","title":"What about CFS support?","text":"<p>The Creality CFS uses proprietary code blobs and likely will never be supported by Simple AF, there is a project underway to support Eddy with CFS that is not affiliated with Simple AF, but does use some stuff from Simple AF and some of our  config and docs: https://github.com/mikeinredding/K1Max-Klipper-Eddy</p>"},{"location":"btteddy/#firmware-requirements","title":"Firmware requirements","text":""},{"location":"btteddy/#limits-on-x-and-y-microsteps","title":"Limits on X and Y microsteps","text":"<p>You cannot use more than <code>microsteps: 32</code> for <code>[stepper_x]</code> and <code>[stepper_y]</code>, the MCU cannot handle high microsteps, it puts too much pressure on the mainboard and it will cause stuttering and other reliability issues including random crashes.</p> <p>Note</p> <p>This limit generally does not apply to RPi Series Simple AF</p>"},{"location":"btteddy/#k1-series","title":"K1 Series","text":"<p>This guide assumes you have a K1, K1C, K1SE or K1 Max and you are running stock creality firmware 1.3.3.5 or higher (The firmware 1.3.3.5 is much older than 1.3.3.46 for example), or alternately you can use my prerooted firmware.</p>"},{"location":"btteddy/#ender-5-max","title":"Ender 5 Max","text":"<p>This probe is currently not supported on Ender 5 Max</p>"},{"location":"btteddy/#ender-3-v3-ke","title":"Ender 3 V3 KE","text":"<p>There is experimental untested support for a Default mount on the Ender 3 V3 KE.</p>"},{"location":"btteddy/#simple-af-for-rpi","title":"Simple AF for RPi","text":"<p>See Simple AF for RPi</p>"},{"location":"btteddy/#slicer-settings","title":"Slicer Settings","text":"<p>Danger</p> <p>Creality Print won't be able to see your printer after you have installed Simple AF, the only tested slicer we all use is OrcaSlicer, likely if you want to use Creality Print you will need to print via usb.</p> <p>Cura Slicer won't work out of the box for configuring START_PRINT variables as below, you need to change the start print EXTRUDER_TEMP and BED_TEMP to pass in the correct values, but since I don't use Cura Slicer I can't advise on that!</p> <p>There is an assumption that you are using a slicer like OrcaSlicer and Machine G-code like:</p> <p></p> <p>Machine start G-code <pre><code>M140 S0\nM104 S0\nSTART_PRINT EXTRUDER_TEMP=[nozzle_temperature_initial_layer] BED_TEMP=[bed_temperature_initial_layer_single]\n</code></pre></p> <p>Machine end G-code <pre><code>END_PRINT\n</code></pre></p>"},{"location":"btteddy/#custom-bed-mesh-profile","title":"Custom Bed Mesh Profile","text":"<p>If you want to select a specific predefined bed mesh profile (which disables adaptive mesh generation), you can pass in an additional <code>START_PRINT</code> parameter:</p> <p>You can either hard code it to a particular model, like <code>BED_MESH_PROFILE=myprofile</code> or you can specify a profile based on orca slicer variables, such as <code>BED_MESH_PROFILE=\"[curr_bed_type] - [filament_type]\"</code>, but you have to make sure you have all the possible profiles defined for each of the bed type and filament type combinations.</p> <p></p>"},{"location":"btteddy/#probe-installation","title":"Probe Installation","text":"<p>It is strongly recommended to initially connect your probe to the front USB Slot initially and use it for a while that way to make sure its stable, before directly wiring it to either the mainboard or making a cable for the lidar port (K1M users only).   If possible avoid destroying the original cable when you are making your lidar or direct mainboard connection as you might need it in the future.</p> <p>Danger</p> <p>If you are not using a side mount you must verify config changes for btteddy.cfg before homing your printer, using Screws Tilt Calculate or doing a bed mesh!  </p> <p>Ignoring these instructions can lead to significant damage to your build plate and/or probe.</p>"},{"location":"btteddy/#mount-options","title":"Mount Options","text":"Mount Printer URL Notes Default K1, K1C, K1M, K1SE https://www.printables.com/model/1012524-btteddy-creality-k1-k1c-k1-max-mounthttps://www.printables.com/model/1097856-btt-eddy-duo-mount Pellcorp K1, K1C, K1M, K1SE https://www.printables.com/model/965667-wip-k1-btt-eddy-rear-mount-v4 Ballaswag K1, K1C, K1M, K1SE https://makerworld.com/en/models/494931 Config copied from k1_mod sources, otherwise not tested Slam K1, K1C, K1M, K1SE https://www.printables.com/model/1195575-btt-eddy-mount-for-k1c Default Ender 3 KE https://www.printables.com/model/1002777-cr-touch-to-btt-eddy-adapter-bracket This probe and mount has not been tested on a KE running Simple AF, experimental"},{"location":"btteddy/#nozzle-offset","title":"Nozzle Offset","text":"<p>Warning</p> <p>If you use a different probe mount you must make sure the bottom of the btt eddy is between 2.6mm and 3mm from the tip of the nozzle, so if the nozzle is touching the bed (when both are cold), the bottom of the eddy should be at least 2.5mm above the bed and no more than 3mm.</p> <p>You can try this tool https://www.printables.com/model/1277844-btt-eddy-and-eddy-ng-setup-helpers</p>"},{"location":"btteddy/#btt-eddy-firmware","title":"BTT Eddy Firmware","text":"<p>Warning</p> <p>It is assumed that you have flashed your eddy with the firmware from https://github.com/pellcorp/klipper/blob/master/fw/K1/btteddy.uf2 before starting the installation!!!</p> <p>For K1 Series Simple AF there is a guide</p> <p>For Simple AF for RPi, you can follow this guide https://github.com/bigtreetech/Eddy?tab=readme-ov-file#compiling-firmware.   But make sure you are not trying to use any fork of klipper than pellcorp/klipper-rpi!  You can also skip this compilation step and just copy  the <code>~/klipper/fw/k1/btteddy.uf2</code> file to the Eddy after putting it into boot mode.</p>"},{"location":"btteddy/#installation","title":"Installation","text":"<p>Warning</p> <p>The installation section does not apply to Simple AF for RPi, See Simple AF for RPi</p> <p>The installation can only be performed on a printer which has been rooted and ssh granted</p> <p>You need root access, if you are not already root, then follow the excellent Helper Script Enable Root Access instructions.</p> <p>Tip</p> <p>ZeroDotCmd (aka Zero on discord) has provided an excellent BTT Eddy installation video, you can find it https://www.youtube.com/watch?v=B17sS1klRxA</p> <p>Please note however that the macros referenced in the video guide have been removed and you should instead follow the Calibration section of this wiki, I do not have the time to maintain the old guided macros, but you can still use the QUICK_START macro to do the pid and input shaper tuning.</p>"},{"location":"btteddy/#factory-reset","title":"Factory Reset","text":"<p>You must do a factory reset only if you have installed Helper Script or Fluidd/Mainsail directly from Creality, otherwise you can safely proceed directly to installation.    If you have setup your printer with stock firmware only it can be quite handy to skip a factory reset so that you can use Switch to Stock</p> <pre><code>wget --no-check-certificate https://raw.githubusercontent.com/pellcorp/creality/main/k1/services/S58factoryreset -O /tmp/S58factoryreset\nchmod +x /tmp/S58factoryreset\n/tmp/S58factoryreset reset\n</code></pre> <p>Danger</p> <p>It is really important you do not close the ssh session until you get this message:</p> <p></p> <p>It can take up to 5 minutes for a factory restart to finish, it is vital you do not power cycle your printer before the stock screen appears. There may be a 3002 error on the screen, this is completely normal.   If you are planning to install Simple AF you can ignore it, if you are trying to go back to stock, power cycle the printer again to clear the error.  </p> <p>Failing to follow this advice can lead to your printer getting bricked and requiring much more involved intervention to recover!</p> <p></p>"},{"location":"btteddy/#clone-the-repo","title":"Clone the Repo","text":"<pre><code>git config --global http.sslVerify false\ngit clone https://github.com/pellcorp/creality.git /usr/data/pellcorp\n</code></pre>"},{"location":"btteddy/#run-the-installer","title":"Run the installer","text":"<p>Note</p> <p>If you have pellcorp-overrides in github but not stored locally, you need to recreate the ~/pellcorp-overrides directory before running the installer.sh!</p> <p>To run the script, you must specify the probe you want to use.</p> <pre><code>/usr/data/pellcorp/installer.sh --install btteddy --mount Mount\n</code></pre> <p>Warning</p> <p>For <code>Mount</code> you must specify the mount option for the mount you have used, if you do not do this the printer will be incorrectly configured for your mount, and bed meshes, x and y limits and related config will be wrong.   Please refer to Mount Options for supported mounts.   </p> <p>If you are using a non-supported mount you should specify a mount option as close to your mount as possible and properly adjust your configuration after installation before trying to perform a bed mesh or Screws Tilt Calculate!</p>"},{"location":"btteddy/#post-installation","title":"Post Installation","text":""},{"location":"btteddy/#mcu-firmware-updates-are-pending","title":"MCU Firmware updates are pending","text":"<p>At the end of the installer process if you get this message:</p> <pre><code>WARNING: MCU Firmware updates are pending you need to power cycle your printer!\n</code></pre> <p>It means that new MCU firmware updates need to be applied and this can only be done by power cycling the printer.  After your printer is power cycled you can verify firmware was updated with the <code>CHECK_FIRMWARE</code> macro from Fluidd or Mainsail, if you see this message:</p> <pre><code>INFO: Your MCU Firmware is up to date!\n</code></pre> <p>Your printer MCU firmware was updated successfully.   If you still see the <code>MCU Firmware updates are pending you need to power cycle your printer!</code> message after a power cycle, check the <code>/tmp/mcu_update.log</code>, you may be asked to provide this file on Discord if you need additional assistance, sometimes an additional power cycle can solve the problem, there is a very short window of time (15 seconds) in which the MCU firmware can be updated, so  there is a chance it will work after an additional power cycle.</p>"},{"location":"btteddy/#verify-usb-key","title":"Verify USB Key","text":"<p>It is important to make sure you have a way to emergency factory reset the printer, if the worst happens.   There is a macro in Simple AF called <code>CHECK_USB_KEY</code> that will wait for you to plug a USB thumb drive (aka USB key) in and tell you if it was able to be successfully mounted.</p> <p>You can find the CHECK_USB_KEY macro in Fluidd or Mainsail, because Fluidd and Mainsail are already installed, you can access Fluidd by opening your browser and connecting using http://X.X.X.X, where X.X.X.X is your ip address that you used to login via ssh to your printer, you can also access Fluidd via http://X.X.X.X:4408 and Mainsail via http://X.X.X.X:4409!</p> <p></p> <p>After running the macro you should see output like the following:</p> <p></p> <ul> <li>If you get the message: <code>INFO - USB Key was recognised and mounted correctly (/tmp/udisk/sda1)</code>, your USB thumb drive (aka USB key) is perfect to use for a factory reset.</li> <li>If you get no message at all before the script ends (after 60 seconds), your USB thumb drive (aka USB key) is defective.   You can check the <code>messages</code> file in the logs section of your UI to get more details about why the usb key could not be mounted!</li> </ul> <p>Tip</p> <p>You should verify your USB thumb drive (aka USB key) often just to make sure you have something if you need to unbrick your printer, simply type <code>CHECK_USB_KEY</code> or hit the button in Fluidd / Mainsail The USB key should be FAT32 formatted and be no larger than 32GB!</p> <p>Note</p> <p>If you have plugged your btt eddy into the front usb port, you are going to have to temporarily remove the btt eddy from the front usb slot and replace it with your USB thumb drive, after you have finished verifying the USB thumb drive can be used in an emergency, you can replace the btt eddy into the front usb slot and restart klipper or power cycle your printer.</p> <p></p> <ul> <li>If you get the message: <code>INFO - USB Key was recognised and mounted correctly (/tmp/udisk/sda1)</code>, your USB thumb drive (aka USB key) is perfect to use for a factory reset.</li> <li>If you get no message at all before the script ends (after 60 seconds), your USB thumb drive (aka USB key) is defective.   You can check the <code>messages</code> file in the logs section of your UI to get more details about why the usb key could not be mounted!</li> </ul>"},{"location":"btteddy/#calibration","title":"Calibration","text":"<p>Warning</p> <p>The following calibration steps are required to setup a new printer:</p> <ul> <li>Drive Current Calibration</li> <li>Mapping Eddy Readings To Nozzle Heights</li> <li>Temperature Compensation Calibration</li> <li>PID Tuning and Input Shaping</li> </ul> <p>Danger</p> <p>It is extremely important that you perform the following calibrations while the btt eddy is cool, if you calibrate the eddy hot, you will experience <code>Error during homing z: Eddy current sensor error</code> errors while homing and performing bed mesh if the btt is significantly cooler than it was while doing initial calibration.   </p>"},{"location":"btteddy/#drive-current-calibration","title":"Drive Current Calibration","text":"<ol> <li>Home XY (<code>G28 X Y</code>)</li> <li>Make sure nozzle is centred on bed</li> <li>Run <code>_SET_KIN_MAX_Z</code> and then use normal controls to move the toolhead so that the bottom of the eddy is approximately 20mm from the bed, please try and be as accurate as possible with this distance, it's better to be slightly closer to the bed than further away.</li> <li>Run <code>BTTEDDY_CALIBRATE_DRIVE_CURRENT</code></li> <li>Run SAVE_CONFIG</li> </ol> <p>Source: https://github.com/bigtreetech/Eddy?tab=readme-ov-file#2-drive-current-calibration</p> <p>Note</p> <p>The auxiliary fan may turn on until the btt eddy temp is less than 40c before starting the actual calibration.  If you are in a hot climate you may need to adjust the <code>btteddy_macro.cfg</code> <code>variable_calibration_max_temp</code> value to something higher than 40c if you can't get the btt eddy under 40c with the aux fan easily.</p>"},{"location":"btteddy/#mapping-eddy-readings-to-nozzle-heights","title":"Mapping Eddy Readings To Nozzle Heights","text":"<ol> <li>Home X and Y (<code>G28 X Y</code>)</li> <li>Make sure nozzle is centred on bed</li> <li>Run <code>BTTEDDY_CURRENT_CALIBRATE</code> Follow the Paper Test Method</li> <li>After clicking Accept, the printer is going to move the bed up and down quite a few times as part of the calibration, do not interrupt it</li> <li>Upon completion <code>SAVE_CONFIG</code></li> </ol> <p>Source: https://github.com/bigtreetech/Eddy?tab=readme-ov-file#3-mapping-eddy-readings-to-nozzle-heights</p> <p>Warning</p> <p>Do not use a metal feeler gauge for this step, it could damage your eddy!!!</p> <p>Note</p> <p>The auxiliary fan may turn on until the btt eddy temp is less than 40c before starting the actual calibration.  If you are in a hot climate you may need to adjust the <code>btteddy_macro.cfg</code> <code>variable_calibration_max_temp</code> value to something higher than 40c if you can't get the btt eddy under 40c with the aux fan easily.</p> <p>Is normal to show the Z position at almost at the max height of the printer even if the nozzle is somewhere in the middle or even close to the bed, this is not a bug, its intentional.   Until this calibration step is completed, the Z axes cannot be homed, so we make the printer pretend the bed is down the bottom of the printer so that you can freely move the bed up to meet the nozzle during the paper test without running into out of range issues.  You however won't be able to move the bed further away from the nozzle more than a few mm.</p> <p></p>"},{"location":"btteddy/#temperature-compensation-calibration","title":"Temperature Compensation Calibration","text":"<ol> <li>Home All (<code>G28</code>)</li> <li>Make sure nozzle is centred on bed</li> <li>Run <code>BTTEDDY_TEMPERATURE_PROBE_CALIBRATE</code> Upon completion <code>SAVE_CONFIG</code></li> </ol> <p>Source: https://github.com/bigtreetech/Eddy?tab=readme-ov-file#5-temperature-compensation-calibration-eddy-usb-only</p> <p>Warning</p> <p>Do not use a metal feeler gauge for this step, it could damage your eddy!!!</p> <p>Tip</p> <p>If you are struggling to get over about 80c, you can end the calibration early with the <code>TEMPERATURE_PROBE_COMPLETE</code> macro, just know that if you end the calibration early and then you try to print really hot and the eddy gets hotter than the hottest temp you calibrated the eddy is going to read the bed wrong and cause issues for homing but especially bed meshes.</p>"},{"location":"btteddy/#pid-tuning-and-input-shaping","title":"Pid Tuning and Input Shaping","text":"<p>At least PID tuning (bed and extruder) and input shaping is required for acceptable printing.  If you try and print after running the installer.sh and a power cycle but before any calibration you will most likely have horrendous quality, the worst you have ever seen on the k1.   After PID tuning and input shaping you should see the same kind of quality as you get with stock k1 + input shaper fix.</p> <p>Note</p> <p>You can use the QUICK_START Macro to complete Bed and Nozzle PID Tuning and Input Shaping Automatically.</p>"},{"location":"btteddy/#pid-tuning","title":"Pid Tuning","text":"<p>Source: Calibrate Pid Settings</p> <p>For example you might run these:</p> <pre><code>PID_CALIBRATE_BED BED_TEMP=65\nPID_CALIBRATE_HOTEND HOTEND_TEMP=230\n</code></pre> <p>Note</p> <p>The <code>PID_CALIBRATE_BED</code> and <code>PID_CALIBRATE_HOTEND</code> macros are located in the <code>useful_macros.cfg</code> file and they have defaults values for BED_TEMP and HOTEND_TEMP so you can just run them by clicking on them if you want that same temperature.</p>"},{"location":"btteddy/#input-shaping","title":"Input Shaping","text":"<p>There is no default configuration for input shaping so it is essentially disabled out of the box.</p> <p>You can use the <code>SHAPER_CALIBRATE</code> macro to run input shaping, just be sure to <code>SAVE CONFIG</code> at the end, to choose the automatically selected shaper config, be aware though that the shaper chosen might be sub-optimal due to a slight difference in vibrations between two options.  So you should probably review the output and potentially choose an alternative if it gives you higher recommended max acceleration for minimal increase in vibration.</p> <p>Input Shaper Auto Calibration</p>"},{"location":"btteddy/#axis-twist-compensation","title":"Axis Twist Compensation","text":"<p>If you are using a rear mount it is highly recommended to perform axis twist compensation, this will affect the quality of your bed mesh, so best to do it before.</p> <p>Tip</p> <p>There is no need to run axis twist compensation if you have mounted the eddy with a side mount that has a 0 y offset!</p> <ol> <li>Home All (<code>G28</code>)</li> <li>Run <code>AXIS_TWIST_COMPENSATION_CALIBRATE</code> The calibration wizard will prompt you to measure the probe Z offset at a few points along the bed    Upon completion <code>SAVE_CONFIG</code></li> </ol> <p>Source: https://www.klipper3d.org/Axis_Twist_Compensation.html</p> <p>Warning</p> <p>Do not use a metal feeler gauge for this step, it could damage your eddy!!!</p>"},{"location":"btteddy/#first-print","title":"First Print","text":"<p>The save baby stepping button in fluidd / mainsail does nothing for btteddy, the z-offset is automatically saved to the variables.cfg, we copied the feature from Helper Script: https://guilouz.github.io/Creality-Helper-Script-Wiki/helper-script/save-z-offset-macros/</p>"},{"location":"btteddy/#bed-mesh","title":"Bed Mesh","text":"<p>Now you can now run your first bed mesh: <code>BED_MESH_CALIBRATE</code></p> <p>Source: https://ballaswag.github.io/blog/creality-k1-btt-eddy-guide/</p> <p>Source: https://github.com/bigtreetech/Eddy</p>"},{"location":"btteddy/#other-calibrations","title":"Other Calibrations","text":"<p>Info</p> <p>The default value for pressure advance is set to <code>0.04</code></p> <p>Refer to Orcaslicer Calibration for more calibrations</p> <p>Refer to the Ellis Print Tuning Guide for more great tuning ideas.</p>"},{"location":"btteddy_faq/","title":"Frequently Asked Questions","text":""},{"location":"btteddy_faq/#how-can-i-skip-waiting-for-btt-eddy-to-be-at-least","title":"How can I skip Waiting for btt eddy to be at least ...?","text":"<p>In the latest version of Simple AF there is a variable in the <code>btteddy_macro.cfg</code> which you can flip to False, so from:</p> <pre><code># if we should wait for eddy to be at calibration temp before homing\nvariable_wait_for_temp: True\n</code></pre> <p>To:</p> <pre><code># if we should wait for eddy to be at calibration temp before homing\nvariable_wait_for_temp: False\n</code></pre> <p>Note</p> <p>Until recently this configuration was in the <code>sensorless.cfg</code> file as <code>variable_btteddy_wait_for_temp: True</code>, its been moved where it belongs in <code>btteddy_macro.cfg</code>!</p>"},{"location":"btteddy_flashing/","title":"BTT Eddy Flashing","text":"<p>Danger</p> <p>THIS IS A RISKY OPERATION YOU CAN BRICK YOUR EDDY</p> <p>Flashing Btt DUO</p> <p>Make sure to switch it to USB Mode first of all!!!</p> <p>It is possible this method will not work for the BTT Duo, especially if it is currently flashed for Can from the factory,  and you may need to resort to the legacy approach documented here</p>"},{"location":"btteddy_flashing/#flashing-on-windows-or-linux-desktop","title":"Flashing on Windows or Linux Desktop","text":""},{"location":"btteddy_flashing/#connecting-in-bootsel-mode","title":"Connecting in BOOTSEL mode","text":"<p>You need to connect your btt eddy to your computer in BOOTSEL mode, you do this by disconnecting the eddy usb or eddy duo, and then push and hold boot button on Eddy (It's next to where the cable plugs in) and at the same time, plug in the cable to your computer.</p> <p>On windows or a Linux Desktop if you successfully connected the eddy in bootsel mode, it will be mounted as a new drive on your computer.</p>"},{"location":"btteddy_flashing/#flashing-btteddyuf2-file","title":"Flashing btteddy.uf2 file","text":"<p>Copy the btteddy.uf2 file across to the btt eddy drive, it should automatically flash the eddy and disconnect for you.</p> <p>Once this is done go ahead and reconnect your eddy to your K1.</p>"},{"location":"btteddy_flashing/#on-printer","title":"On Printer","text":"<p>You can also flash the eddy on your printer (K1, K1C, K1SE, K1M, Ender 3 V3 KE, etc) but you need to be able to disconnect and reconnect it for this to work, there is currently no way to get the eddy into boot mode any other way!</p> <p>So by default when connecting the btt eddy to the K1, <code>lsusb</code> will report:</p> <pre><code>Bus 001 Device 099: ID 1d50:614e OpenMoko, Inc. USB2.0 Hub\n</code></pre> <p>This means it is not in boot mode and you cannot flash any firmware to it.  You need to hold down the boot button and re-connect your btt eddy to your K1, you will know this worked if you type <code>lsusb</code> and see:</p> <pre><code>Bus 001 Device 101: ID 2e8a:0003  USB2.0 Hub\n</code></pre> <p>Verify that the btt eddy has been mounted as a disk drive on the K1 by running <code>mount</code>, you should see a <code>/tmp/udisk/sda1</code> entry:</p> <p></p> <p>Once this has happened you will be able to copy the btteddy.uf2 file to the eddy via this command:</p> <pre><code>wget --no-check-certificate https://raw.githubusercontent.com/pellcorp/klipper/master/fw/K1/btteddy.uf2 -O /tmp/btteddy.uf2\ncp /tmp/btteddy.uf2 /tmp/udisk/sda1/\n</code></pre> <p>If you check <code>lsusb</code> again, it should have switched back to:</p> <pre><code>Bus 001 Device 102: ID 1d50:614e OpenMoko, Inc. USB2.0 Hub\n</code></pre>"},{"location":"btteddy_flashing/#how-do-i-know-it-flashed-correctly","title":"How do I know it flashed correctly?","text":"<p>Unfortunately I know of no way to test this except by plugging it back into the K1, restarting klipper and verifying via the System tab, a correctly flashed eddy will have </p> <p></p>"},{"location":"btteddy_flashing/#migrating-from-k1-mod","title":"Migrating from K1 Mod","text":"<p>The K1 mod has an older version of the btteddy firmware, if you still see this in the System tab, then your flashing failed</p> <p></p>"},{"location":"btteddy_troubleshooting/","title":"Troubleshooting","text":""},{"location":"btteddy_troubleshooting/#error-during-homing-z-eddy-current-sensor-error","title":"Error during homing z: Eddy current sensor error","text":"<p>You might need to adjust your <code>reg_drive_current</code>, for more details: https://github.com/bigtreetech/Eddy?tab=readme-ov-file#sometimes-i-get-error-during-homing-probe-eddy-current-sensor-error</p>"},{"location":"btteddy_troubleshooting/#mcu-protocol-error-mcu-eddy-unknown-command-debug_read","title":"MCU Protocol Error - mcu 'eddy' Unknown command: debug_read","text":"<p>If you get the following error, it means that the eddy is not connected to the printer.   This is either because its physically not connected, the wiring is wrong, the usb subsystem has disconnected the eddy during a restart or the serial id is wrong</p> <p></p> <p>So from ssh run a <code>lsusb</code> and make sure you can see:</p> <p></p> <p>If you cannot see it in <code>lsusb</code>, then it very likely means either the eddy is wired incorrectly, or if was working, it just means that an attempt to restart the eddy failed because the K1 refused to recognise it, there is no recourse except to restart the host via Fluidd / Mainsail (or power cycle the printer)</p> <p>If you can see the eddy in lsusb, then you should try to update the serial (see next)</p>"},{"location":"btteddy_troubleshooting/#manual-btt-eddy-serial-device-configuration","title":"Manual BTT Eddy Serial Device configuration","text":"<p>You can run the following command to fix your serial if you forgot to plug your btt eddy in during the installation or update:</p> <pre><code>~/pellcorp/k1/installer.sh --fix-serial\n</code></pre> <p>Note</p> <p>If you run the above and receive an error like:</p> <pre><code>```\nroot@K1Max-AF34 /root [#] ~/pellcorp/installer.sh --fix-serial\n-sh: /root/pellcorp/installer.sh: not found\n```\n</code></pre> <p>It means you are on an older version of Simple AF and you should instead use the old style commands:</p> <pre><code>```\n/usr/data/pellcorp/k1/installer.sh --fix-serial\n```\n</code></pre>"},{"location":"btteddy_troubleshooting/#eddy-is-not-connected-aborting-homing-z","title":"Eddy is not connected, aborting homing Z","text":"<p>If you see this error when trying to home your printer, it is a clear indication that the eddy was disconnected and you should look for a <code>mcu 'eddy' disconnected</code> error in your klippy.log or gcode console, if the eddy was momentarily disconnected (so if you run <code>lsusb</code> on the printer the eddy shows up), you can simply restart klipper from the services menu in Fluidd or Mainsail, if the eddy completely disappeared you will need to power cycle the printer!</p>"},{"location":"btteddy_wiring/","title":"BTT Eddy Wiring","text":"<p>Note</p> <p>This wiring section applies to K1/K1C/K1SE/K1M printers only</p> <p>Confirm the USB wiring based on this diagram(s) On a K1M you can use the lidar cable either directly by repinning it, or via the pass through lidar port on the toolhead.  However you cannot use the lidar port on the toolhead for K1, K1C or K1SE.   The reason this does not work is because for Lidar on the K1M creality actually routes a completely separate USB cable from the mainboard.</p> <p> </p>"},{"location":"cartographer/","title":"Cartographer","text":""},{"location":"cartographer/#where-can-i-get-help","title":"Where can I get help?","text":"<p>Come on over to the pellcorp discord server, the <code>#simple-af-carto</code> channel has been setup for anyone wanting support for cartographer.</p> <p>https://discord.gg/2uGDzyJ3WX</p>"},{"location":"cartographer/#looking-for-cartotouch","title":"Looking for Cartotouch?","text":"<p>See Cartotouch</p>"},{"location":"cartographer/#upgrading-from-cartotouch","title":"Upgrading from Cartotouch?","text":"<p>Its really easy to update, you can simply do a probe switch like this:</p> <pre><code>~/pellcorp/installer.sh --branch main\n~/pellcorp/installer.sh --update cartographer --mount %CURRENT%\n</code></pre> <p>Then do calibration as normal </p>"},{"location":"cartographer/#thanks","title":"Thanks","text":"<p>Thanks to Richard from https://cartographer3d.com and Zarboz from https://wattskraken.xyz/ for donating Cartographers to the Simple AF project to add support and continue to support the cartographer.</p>"},{"location":"cartographer/#firmware-requirements","title":"Firmware requirements","text":""},{"location":"cartographer/#limits-on-x-and-y-microsteps","title":"Limits on X and Y microsteps","text":"<p>You cannot use more than <code>microsteps: 32</code> for <code>[stepper_x]</code> and <code>[stepper_y]</code>, the MCU cannot handle high microsteps, it puts too much pressure on the mainboard and it will cause stuttering and other reliability issues including random crashes.</p> <p>Note</p> <p>This limit generally does not apply to RPi Series Simple AF</p>"},{"location":"cartographer/#k1-series","title":"K1 Series","text":"<p>This guide assumes you have a K1, K1C, K1SE or K1 Max and you are running stock creality firmware 1.3.3.5 or higher (The firmware 1.3.3.5 is much older than 1.3.3.46 for example), or alternately you can use my prerooted firmware.</p>"},{"location":"cartographer/#ender-5-max","title":"Ender 5 Max","text":"<p>This guide assumes you are running stock Creality firmware 1.2.0.10 or higher on your Ender 5 Max.</p> <p>The stock firmware comes pre-rooted, with the default root password being <code>Creality@2024_Wh_464</code></p> <p>Please note that you will need to change the screen orientation to horizontal, here is a model for that https://www.printables.com/model/1246910-ender-5-max-screen-bracket</p>"},{"location":"cartographer/#ender-3-v3-ke","title":"Ender 3 V3 KE","text":"<p>This guide assumes you have a stock Ender 3 V3 KE with Nebula Pad with Root enabled, when you get to installation below, you should specify the <code>--mount Default</code> to install Simple AF on the KE for Cartographer.</p> <p>Please note that you will need to change the screen orientation to horizontal, here is a model for that https://www.printables.com/model/727362-ender-3-v3-ke-screen-holder-landscape-for-guppyscr, but please do not follow the installation instructions on that page, just print the model and remount your screen only! An alternative model which honestly seems a bit cleaner: https://www.printables.com/model/706657-creality-ender-3-v3-e3v3-se-ke-and-cr-10-se-portra</p>"},{"location":"cartographer/#simple-af-for-rpi","title":"Simple AF for RPi","text":"<p>See Simple AF for RPi</p>"},{"location":"cartographer/#slicer-settings","title":"Slicer Settings","text":"<p>Danger</p> <p>Creality Print won't be able to see your printer after you have installed Simple AF, the only tested slicer we all use is OrcaSlicer, likely if you want to use Creality Print you will need to print via usb.</p> <p>Cura Slicer won't work out of the box for configuring START_PRINT variables as below, you need to change the start print EXTRUDER_TEMP and BED_TEMP to pass in the correct values, but since I don't use Cura Slicer I can't advise on that!</p> <p>If you have used a cartographer with k1-klipper, please note that the <code>PRINT_START</code> macro specified in their docs is not supported by this project.   You must change your Slicer Start Print Machine G-Code (see next)</p> <p>There is an assumption that you are using a slicer like OrcaSlicer and Machine G-code like:</p> <p></p> <p>Machine start G-code</p> <pre><code>M140 S0\nM104 S0\nSTART_PRINT EXTRUDER_TEMP=[nozzle_temperature_initial_layer] BED_TEMP=[bed_temperature_initial_layer_single]\n</code></pre> <p>Machine end G-code</p> <pre><code>END_PRINT\n</code></pre>"},{"location":"cartographer/#custom-bed-mesh-profile","title":"Custom Bed Mesh Profile","text":"<p>If you want to select a specific predefined bed mesh profile (which disables adaptive mesh generation), you can pass in an additional <code>START_PRINT</code> parameter:</p> <p>You can either hard code it to a particular model, like <code>BED_MESH_PROFILE=myprofile</code> or you can specify a profile based on orca slicer variables, such as <code>BED_MESH_PROFILE=\"[curr_bed_type] - [filament_type]\"</code>, but you have to make sure you have all the possible profiles defined for each of the bed type and filament type combinations.</p> <p></p>"},{"location":"cartographer/#probe-installation","title":"Probe Installation","text":"<p>It is strongly recommended to connect your probe to the front USB port initially and use it for a while that way to make sure its stable, before directly wiring it to either the mainboard or making a cable for the lidar port (K1M users only).   If possible avoid destroying the original cable when you are making your lidar or direct mainboard connection as you might need it in the future!</p> <p>Danger</p> <p>If you are not using a side mount you must verify config changes for cartographer.cfg before homing your printer, using Screws Tilt Calculate or doing a bed mesh!  </p> <p>Ignoring these instructions can lead to significant damage to your build plate and/or probe.</p>"},{"location":"cartographer/#mount-options","title":"Mount Options","text":"Mount Printer Carto URL Notes Default K1, K1C, K1M, K1SE V3\u00a0Right\u00a0Angle https://www.printables.com/model/1037606-cartographer-3d-right-angle-k1-series-mount D3vilStock K1, K1C, K1M, K1SE V3\u00a0Flat\u00a0Pack https://www.printables.com/model/684338-k1-k1max-eddy-current-mount-cartographer BootyGantry K1, K1C, K1M, K1SE V3\u00a0Right\u00a0Angle https://github.com/tlace17/K1-Linear-Rail-Gantry/blob/main/STLs/Probe%20Mounts/Rail%20Carriage%20Carto%20Mount.stl May require shimming for correct nozzle offset SkeletorMK7 K1, K1C, K1M, K1SE V3\u00a0Low\u00a0ProfileV4\u00a0Low\u00a0Profile https://www.printables.com/model/833769-the-skeletor-collection-a-creality-k1k1-maxk1c-cooGet it printed: https://mk7.tbkm.xyz/ SkeletorRightAngle K1, K1C, K1M, K1SE All V3 and V4 variants https://www.printables.com/model/1362668-skeletor-mk7-side-mounted-cartographer-integration PurcellV5 K1, K1C, K1M, K1SE V3\u00a0Right\u00a0Angle https://www.printables.com/model/1071493-cartographer-probe-side-mount-options-for-crealityhttps://www.printables.com/model/1239076-creality-k1-cartographer-right-angle-mount This also works with V3 and V4, probably also V8 SimplyHexed Ender 5 Max V3\u00a0Right\u00a0Angle https://www.printables.com/model/1209230-ender-5-max-simply-hexed Requires custom shroud Default Ender 3 V3 SE V3\u00a0Right\u00a0Angle https://www.printables.com/model/732262-ender-3-v3-ke-beaconcartographer-mount Will probably require shimming especially if you ugprade to a k1 hotend Default Ender 3 V3 KE V3\u00a0Right\u00a0Angle https://www.printables.com/model/732262-ender-3-v3-ke-beaconcartographer-mount Might require shimming depending on the hotend / nozzle you use"},{"location":"cartographer/#nozzle-offset","title":"Nozzle Offset","text":"<p>Warning</p> <p>It is vital that you verify the coil to nozzle tip distance is within the valid range of 2.6 to 3mm, you can use this simple tool to verify the range: https://www.printables.com/model/1325363-cartographer-and-beacon-z-offset-goldilocks-tool</p> <p>Just be sure to use digital calipers to verify the print printed with the correct size before relying on it, if you have trouble with  your z not being always entirely accurate consider printing the model on its side.</p>"},{"location":"cartographer/#cartographer-firmware","title":"Cartographer Firmware","text":"<p>Warning</p> <p>For K1 Series (which includes K1, K1C, K1SE, K1 Max, Ender 3 V3 KE and Ender 5 Max) Simple AF you must flash your V3 Probe with <code>CARTOGRAPHER K1 5.0.0</code>:</p> <p></p> <p>For a V4 Probe <code>CARTOGRAPHER V4 6.0.0 Lite</code>:</p> <p></p> <p>For K1 Series (which includes K1, K1C, K1SE, K1 Max, Ender 3 V3 KE and Ender 5 Max) Simple AF there is a guide for V3 Probes and V4 Probes.</p> <p>For Simple AF for RPi, you can use the standard cartographer guide https://docs.cartographer3d.com/cartographer-probe/firmware/firmware-updating/via-katapult/usb-flash#usb-katapult-updating</p> <p>If you are using a Pi3 or less (so CB1, CB2, OPi 3, etc) to run klipper, I strongly recommend using the K1/Lite variants of the cartographer firmware, you can do that  in the firmware script by enabling Advanced Mode and Enabling Creality K Series Firmware.</p>"},{"location":"cartographer/#installation","title":"Installation","text":"<p>Warning</p> <p>The installation section does not apply to Simple AF for RPi, See Simple AF for RPi</p> <p>The installation can only be performed on a printer which has been rooted and ssh granted</p> <p>You need root access, if you are not already root, then follow the excellent Helper Script Enable Root Access instructions.</p> <p>Info</p> <p>If you are switching from cartotouch, you can skip straight to Run the Installer and perform an <code>~/pellcorp/installer.sh --update cartographer --mount %CURRENT%</code> instead of a new installation.</p>"},{"location":"cartographer/#factory-reset","title":"Factory Reset","text":"<p>You must do a factory reset only if you have installed Helper Script or Fluidd/Mainsail directly from Creality, otherwise you can safely proceed directly to installation.    If you have setup your printer with stock firmware only it can be quite handy to skip a factory reset so that you can use Switch to Stock</p> <pre><code>wget --no-check-certificate https://raw.githubusercontent.com/pellcorp/creality/main/k1/services/S58factoryreset -O /tmp/S58factoryreset\nchmod +x /tmp/S58factoryreset\n/tmp/S58factoryreset reset\n</code></pre> <p>Danger</p> <p>It is really important you do not close the ssh session until you get this message:</p> <p></p> <p>It can take up to 5 minutes for a factory restart to finish, it is vital you do not power cycle your printer before the stock screen appears. There may be a 3002 error on the screen, this is completely normal.   If you are planning to install Simple AF you can ignore it, if you are trying to go back to stock, power cycle the printer again to clear the error.  </p> <p>Failing to follow this advice can lead to your printer getting bricked and requiring much more involved intervention to recover!</p> <p></p>"},{"location":"cartographer/#clone-the-repo","title":"Clone the Repo","text":"<pre><code>git config --global http.sslVerify false\ngit clone https://github.com/pellcorp/creality.git /usr/data/pellcorp\n</code></pre>"},{"location":"cartographer/#run-the-installer","title":"Run the installer","text":"<p>Note</p> <p>If you have pellcorp-overrides in github but not stored locally, you need to recreate the ~/pellcorp-overrides directory before running the installer.sh!</p> <p>To run the script, you must use the following command:</p> <pre><code>/usr/data/pellcorp/installer.sh --install cartographer --mount Mount\n</code></pre> <p>Warning</p> <p>For <code>Mount</code> you must specify the mount option for the mount you have used, if you do not do this the printer will be incorrectly configured for your mount, and bed meshes, x and y limits and related config will be wrong.   Please refer to Mount Options for supported mounts.   </p> <p>If you are using a non-supported mount you should specify a mount option as close to your mount as possible and properly adjust your configuration after installation before trying to perform a bed mesh or Screws Tilt Calculate!</p>"},{"location":"cartographer/#post-installation","title":"Post Installation","text":""},{"location":"cartographer/#mcu-firmware-updates-are-pending","title":"MCU Firmware updates are pending","text":"<p>At the end of the installer process if you get this message:</p> <pre><code>WARNING: MCU Firmware updates are pending you need to power cycle your printer!\n</code></pre> <p>It means that new MCU firmware updates need to be applied and this can only be done by power cycling the printer.  After your printer is power cycled you can verify firmware was updated with the <code>CHECK_FIRMWARE</code> macro from Fluidd or Mainsail, if you see this message:</p> <pre><code>INFO: Your MCU Firmware is up to date!\n</code></pre> <p>Your printer MCU firmware was updated successfully.   If you still see the <code>MCU Firmware updates are pending you need to power cycle your printer!</code> message after a power cycle, check the <code>/tmp/mcu_update.log</code>, you may be asked to provide this file on Discord if you need additional assistance, sometimes an additional power cycle can solve the problem, there is a very short window of time (15 seconds) in which the MCU firmware can be updated, so  there is a chance it will work after an additional power cycle.</p>"},{"location":"cartographer/#verify-usb-key","title":"Verify USB Key","text":"<p>It is important to make sure you have a way to emergency factory reset the printer, if the worst happens.   There is a macro in Simple AF called <code>CHECK_USB_KEY</code> that will wait for you to plug a USB thumb drive (aka USB key) in and tell you if it was able to be successfully mounted.</p> <p>You can find the CHECK_USB_KEY macro in Fluidd or Mainsail, because Fluidd and Mainsail are already installed, you can access Fluidd by opening your browser and connecting using http://X.X.X.X, where X.X.X.X is your ip address that you used to login via ssh to your printer, you can also access Fluidd via http://X.X.X.X:4408 and Mainsail via http://X.X.X.X:4409!</p> <p></p> <p>After running the macro you should see output like the following:</p> <p></p> <ul> <li>If you get the message: <code>INFO - USB Key was recognised and mounted correctly (/tmp/udisk/sda1)</code>, your USB thumb drive (aka USB key) is perfect to use for a factory reset.</li> <li>If you get no message at all before the script ends (after 60 seconds), your USB thumb drive (aka USB key) is defective.   You can check the <code>messages</code> file in the logs section of your UI to get more details about why the usb key could not be mounted!</li> </ul> <p>Tip</p> <p>You should verify your USB thumb drive (aka USB key) often just to make sure you have something if you need to unbrick your printer, simply type <code>CHECK_USB_KEY</code> or hit the button in Fluidd / Mainsail The USB key should be FAT32 formatted and be no larger than 32GB!</p> <p>Note</p> <p>If you have plugged your cartographer into the front usb port, you are going to have to temporarily remove the cartographer from the front usb slot and replace it with your USB thumb drive (aka USB key), after you have finished verifying the USB thumb drive (aka USB key) can be used in an emergency, you can replace the cartographer into the front usb slot and restart klipper or power cycle your printer.</p>"},{"location":"cartographer/#calibration","title":"Calibration","text":"<p>If you are switching from cartotouch remove these:</p> <ul> <li><code>[scanner model default]</code></li> <li><code>[scanner]</code></li> </ul> <p>Make sure you remove these:</p> <ul> <li><code>[cartographer scan_model default]</code></li> <li><code>[cartographer touch_model default]</code></li> </ul> <p>Plus because axis twist and bed mesh were generated with a previous model you must remove these as well:</p> <ul> <li><code>[axis_twist_compensation]</code></li> <li><code>[bed_mesh]</code></li> </ul> <p>Warning</p> <p>The following calibration steps are required to setup a new printer:</p> <ul> <li>Scan calibration</li> <li>Touch Calibration</li> </ul>"},{"location":"cartographer/#scan-calibration","title":"Scan calibration","text":"<ol> <li>Run the <code>STOP_CAMERA</code> macro to stop the camera</li> <li>Home X Y (<code>G28 X Y</code>)</li> <li>Heat Nozzle to 150c (<code>M109 S150</code>) so that any filament can be removed from nozzle</li> <li>Run <code>CARTOGRAPHER_SCAN_CALIBRATE</code>    Follow the Paper Test Method Upon completion <code>SAVE_CONFIG</code></li> </ol> <p>Note</p> <p>Is normal to show the Z position at almost at the max height of the printer even if the nozzle is somewhere in the middle or even close to the bed, this is not a bug, its intentional.   Until this calibration step is completed, the Z axes cannot be homed, so we make the printer pretend the bed is down the bottom of the printer so that you can freely move the bed up to meet the nozzle during the paper test without running into out of range issues.  You however won't be able to move the bed further away from the nozzle more than a few mm.</p> <p></p> <p>Source: https://docs.cartographer3d.com/cartographer-probe/installation-and-setup/software-configuration/scan-calibration</p> <p>Warning</p> <p>Do not use a metal feeler gauge for this step, it could damage your cartographer!!!</p> <p>After the save config you have to do the touch calibration.</p>"},{"location":"cartographer/#touch-calibration","title":"Touch Calibration","text":"<p>Danger</p> <p>For this next step, it is really important to be near your printer for this step, because if there is any issue with the printer configuration or your carto probe, its possible the nozzle will dig itself into the bed, so be hovering over that e-stop button!</p> <ol> <li>Home All (<code>G28</code>)</li> <li>Run the <code>STOP_CAMERA</code> macro to stop the camera</li> <li>Heat Nozzle to 150c (<code>M109 S150</code>) so that any filament can be removed from nozzle</li> <li>Run <code>CARTOGRAPHER_TOUCH_CALIBRATE</code> Upon completion <code>SAVE_CONFIG</code></li> </ol> <p>Warning</p> <p>Observe your nozzle to make sure it touches on the bed. If it never touches the bed, refer to https://docs.cartographer3d.com/cartographer-probe/installation-and-setup/software-configuration/touch-calibration#nozzle-never-touches-the-bed   </p> <p>Source: https://docs.cartographer3d.com/cartographer-probe/installation-and-setup/software-configuration/touch-calibration</p>"},{"location":"cartographer/#pid-tuning-and-input-shaping","title":"Pid Tuning and Input Shaping","text":"<p>At least PID tuning (bed and extruder) and input shaping is required for acceptable printing.  If you try and print after running the installer.sh and a power cycle but before any calibration you will most likely have horrendous quality, the worst you have ever seen on the k1.   After PID tuning and input shaping you should see the same kind of quality as you get with stock k1 + input shaper fix.</p> <p>Note</p> <p>You can use the QUICK_START Macro to complete Bed and Nozzle PID Tuning and Input Shaping Automatically.</p>"},{"location":"cartographer/#pid-tuning","title":"Pid Tuning","text":"<p>Source: Calibrate Pid Settings</p> <p>For example you might run these:</p> <pre><code>PID_CALIBRATE_BED BED_TEMP=65\nPID_CALIBRATE_HOTEND HOTEND_TEMP=230\n</code></pre> <p>Note</p> <p>The <code>PID_CALIBRATE_BED</code> and <code>PID_CALIBRATE_HOTEND</code> macros are located in the <code>useful_macros.cfg</code> file and they have defaults values for BED_TEMP and HOTEND_TEMP so you can just run them by clicking on them if you want that same temperature.</p>"},{"location":"cartographer/#input-shaping","title":"Input Shaping","text":"<p>There is no default configuration for input shaping so it is essentially disabled out of the box.</p> <p>You can use the <code>SHAPER_CALIBRATE</code> macro to run input shaping, just be sure to <code>SAVE CONFIG</code> at the end, to choose the automatically selected shaper config, be aware though that the shaper chosen might be sub-optimal due to a slight difference in vibrations between two options.  So you should probably review the output and potentially choose an alternative if it gives you higher recommended max acceleration for minimal increase in vibration.</p> <p>Input Shaper Auto Calibration</p>"},{"location":"cartographer/#axis-twist-compensation","title":"Axis Twist Compensation","text":"<p>Note</p> <p>This is a fancy new feature of the new Cartographer software it does not require any paper!</p> <p>Next it is highly recommended to perform axis twist compensation calibration if you are using a rear mount before doing anything else, this will affect the quality of your bed mesh, so best to do it before.</p> <ol> <li>Home All (<code>G28</code>)</li> <li>Heat Nozzle to 150c (<code>M109 S150</code>) so that any filament can be removed from nozzle</li> <li>Run <code>CARTOGRAPHER_AXIS_TWIST_COMPENSATION</code> Upon completion <code>SAVE_CONFIG</code></li> </ol> <p>Source: https://docs.cartographer3d.com/cartographer-probe/features/axis-twist-compensation</p>"},{"location":"cartographer/#first-print","title":"First Print","text":"<p>You should optimise your <code>cartographer touch_model default</code> <code>z_offset</code> using baby stepping, as documented here: https://docs.cartographer3d.com/cartographer-probe/installation-and-setup/software-configuration/z-offset#babystep-adjusting-z-offset</p> <p>In fluidd the save button after you finish or cancel your print can be a bit hard to find, look for</p> <p></p>"},{"location":"cartographer/#other-calibrations","title":"Other Calibrations","text":"<p>Info</p> <p>The default value for pressure advance is set to <code>0.04</code></p> <p>Refer to Orcaslicer Calibration for more calibrations</p> <p>Refer to the Ellis Print Tuning Guide for more great tuning ideas.</p>"},{"location":"cartographer_V3_flashing/","title":"Cartographer V3 Flashing","text":"<p>Danger</p> <p>THIS IS A RISKY OPERATION YOU CAN BRICK YOUR CARTO</p> <p>Do not follow these instructions unless you have a USB V3 Cartographer !!!!!!</p> <p>Warning</p> <p>You might corrupt the katapult boot loader trying to use a Linux VM or WSL to flash the carto, I strongly recommend a live USB over a VM or WSL!</p>"},{"location":"cartographer_V3_flashing/#verify-your-cable","title":"Verify your Cable","text":"<p>You must make sure that the cable you are using is pinned correctly.  For both flat pack and right angle cartographer the default cable that comes with your carto might not be pinned correctly.</p> <p></p> <p>Warning</p> <p>The right angle and flat pack pin out is different to using a low profile carto, so the image above does not apply to low profile cartographers!</p> <p>You must not use the firmware.cartographer3d.com, it will not flash the proper version of <code>CARTOGRAPHER K1 5.0.0</code> firmware for the K1, K1C, K1SE, K1 Max, Ender 3 V3 KE and Ender 5 Max!</p> <p>The reason this cannot be done on the printer, seems to be some incompatibility with pyserial and MIPS, and issue for this has been opened  https://github.com/Arksine/katapult/issues/137 </p>"},{"location":"cartographer_V3_flashing/#flashing-the-cartographer","title":"Flashing the Cartographer","text":"<p>You will need some kind of linux environment, this can be a Raspberry Pi, desktop Linux or even a Linux Server if you can plug something in via USB.   If you do not have anything like that, you will need to create a Live USB key running Ubuntu 24.04 Desktop edition.</p>"},{"location":"cartographer_V3_flashing/#creating-a-live-usb-key","title":"Creating a Live USB Key","text":"<p>You should create a live USB with Ubuntu 24.04 (25.04 also works) Desktop, make sure the USB is at least 8GB in size!</p> <p>https://ubuntu.com/tutorials/try-ubuntu-before-you-install#1-getting-started</p>"},{"location":"cartographer_V3_flashing/#installation-dependencies","title":"Installation dependencies","text":"<p>On your raspberry pi, linux desktop, linux server or live Ubuntu USB environment you need to run the following commands to install essential packages.</p> <pre><code>sudo apt-get update\nsudo apt-get install virtualenv python3-dev python3-pip python3-setuptools libffi-dev build-essential git dfu-util\n</code></pre>"},{"location":"cartographer_V3_flashing/#clone-klipper-and-cartographer-firmware","title":"Clone Klipper and Cartographer-Firmware","text":"<pre><code>git clone \"https://github.com/Klipper3d/klipper\" $HOME/klipper\ngit clone \"https://github.com/Cartographer3D/cartographer_firmware\" $HOME/cartographer_firmware\n</code></pre> <p>Note</p> <p>If you already have <code>cartographer_firmware</code> cloned locally, make sure you are on latest <code>main</code> like so:</p> <pre><code>cd $HOME/cartographer_firmware\ngit fetch\ngit switch main\ngit reset --hard origin/main\n</code></pre>"},{"location":"cartographer_V3_flashing/#setup-klipper-virtual-env","title":"Setup Klipper Virtual Env","text":"<pre><code>virtualenv --system-site-packages $HOME/klippy-env\n$HOME/klippy-env/bin/pip3 install -r $HOME/klipper/scripts/klippy-requirements.txt\n</code></pre>"},{"location":"cartographer_V3_flashing/#flashing-k1-cartographer-firmware","title":"Flashing K1 Cartographer Firmware","text":"<p>This firmware is provided by Richard from Cartographer3d.com specifically for the K1, K1C, K1SE, K1 Max, Ender 3 V3 KE and Ender 5 Max.   It is critical that you flash your cartographer with this version of the Survey firmware over the official Survey Firmware on K1, K1SE, K1C, K1M, Ender 3 V3 KE and Ender 5 Max to avoid stuttering and instability, especially during bed meshes!</p>"},{"location":"cartographer_V3_flashing/#connect-cartographer-via-usb","title":"Connect Cartographer via USB","text":"<p>Plug the cartographer into your computer and make sure it shows up if you type <code>lsusb</code> you should find an entry something like this:</p> <pre><code>Bus 001 Device 067: ID 1d50:614e OpenMoko, Inc.\n</code></pre>"},{"location":"cartographer_V3_flashing/#enable-bootloader","title":"Enable Bootloader","text":"<pre><code>CARTO_DEV=$(ls /dev/serial/by-id/usb-* | grep \"IDM\\|Cartographer\" | head -1)\ncd $HOME/klipper/scripts\nsudo -E $HOME/klippy-env/bin/python -c \"import flash_usb as u; u.enter_bootloader('$CARTO_DEV')\"\n</code></pre> <p>Warning</p> <p>If you get a message like <code>ls: cannot access '/dev/serial/by-id/usb-*': No such file or directory</code>, it means you forgot the <code>*</code> in the command above, your carto cable is incorrectly pinned or you are using a VM or WSL (against advice) and have not passed through the Cartographer USB Device!</p> <p>You should see a message like:</p> <pre><code>Entering bootloader on /dev/serial/by-id/usb-Cartographer_614e_16000C000F43304253373820-if00\n</code></pre> <p>Note</p> <p>If the carto does not enter bootloader mode, it is possible you forgot to use sudo! If your carto does show up in /dev/serial but won't enter bootloader mode, you will need to fix this with DFU mode</p>"},{"location":"cartographer_V3_flashing/#flashing","title":"Flashing","text":"<pre><code>CATAPULT_DEV=$(ls /dev/serial/by-id/usb-katapult*)\nsudo -E $HOME/klippy-env/bin/python $HOME/klipper/lib/canboot/flash_can.py -f $HOME/cartographer_firmware/firmware/v2-v3/survey/5.0.0/Survey_Cartographer_K1_USB_8kib_offset.bin -d $CATAPULT_DEV\n</code></pre> <p>You should see output like this:</p> <pre><code>Attempting to connect to bootloader\nCanBoot Connected\nProtocol Version: 1.0.0\nBlock Size: 64 bytes\nApplication Start: 0x8002000\nMCU type: stm32f042x6\nFlashing '/home/ubuntu/cartographer_firmware/firmware/v2-v3/survey/5.0.0/Survey_Cartographer_K1_USB_8kib_offset.bin'...\n\n[##################################################]\n\nWrite complete: 22 pages\nVerifying (block count = 338)...\n\n[##################################################]\n\nVerification Complete: SHA = BB45B9575AC57FFF03CA5FE09186DB479E09BF53\nCAN Flash Success\n</code></pre> <p>Note</p> <p>If the carto does not flash, it is possible you forgot to use sudo!</p> <p>Warning</p> <p>If you get a message like <code>ls: cannot access '/dev/serial/by-id/usb-katapult*': No such file or directory</code>, it means you forgot the <code>*</code> in the command above, you are using a VM or WSL (against advice) and have not passed through the <code>katapult stm32f042x6</code> USB Device!</p> <p>If the Cartographer is no longer flashing blue its also possible the katapult bootloader has become corrupted which is actually frighteningly easy to do which is why I generally discourage the use of WSL or VMs!</p> <p>When you reconnect your carto to your printer it should show a version <code>CARTOGRAPHER K1 5.0.0</code>:</p> <p>Source: https://docs.cartographer3d.com/cartographer-probe/firmware/manual-methods/cartographer-with-input-shaper/update-via-katapult-recommended#updating-a-usb-probe-via-katapult</p> <p></p>"},{"location":"cartographer_V3_flashing/#flashing-k1-firmware-via-dfu-mode","title":"Flashing K1 Firmware via DFU Mode","text":"<p>Note</p> <p>This process is applicable for K1, K1C, K1SE, K1 Max, Ender 3 V3 KE and Ender 5 Max!</p> <p>You need to bridge the boot pins before you plug your carto in via USB to your Linux session, make sure <code>lsusb</code> reports it being in DFU mode, it should show</p> <p></p> <p>Source: https://docs.cartographer3d.com/cartographer-probe/firmware/updating-firmware#cartographer-v3-1</p> <p>Then cd to the combined firmware directory </p> <pre><code>cd $HOME/cartographer_firmware/firmware/v2-v3/combined-firmware/5.0.0\n</code></pre> <p>And run dfu-util to write the firmware:</p> <pre><code>sudo dfu-util -R -a 0 -s 0x08000000:leave -D Full_Survey_Cartographer_CrealityK1_USB_5_0_0.bin\n</code></pre> <p></p> <p>Source: https://docs.cartographer3d.com/cartographer-probe/firmware/manual-methods/cartographer-with-input-shaper/update-via-dfu-mode</p>"},{"location":"cartographer_V4_flashing/","title":"Cartographer V4 Flashing","text":"<p>Danger</p> <p>THIS IS A RISKY OPERATION YOU CAN BRICK YOUR CARTO</p> <p>Do not follow these instructions unless you have a USB V4 Cartographer !!!!!!</p> <p>Warning</p> <p>You might corrupt the katapult boot loader trying to use a Linux VM or WSL to flash the carto, I strongly recommend a live USB over a VM or WSL!</p>"},{"location":"cartographer_V4_flashing/#verify-your-cable","title":"Verify your Cable","text":"<p>You must make sure that the cable you are using is pinned correctly.</p> <p></p> <p>Warning</p> <p>The standard pin out maybe different to using a low profile carto, verify the pin out before plugging in your probe!</p> <p>You must not use the firmware.cartographer3d.com, it will not flash the proper version of <code>CARTOGRAPHER V4 6.0.0 Lite</code> firmware for the K1, K1C, K1SE, K1 Max, Ender 3 V3 KE and Ender 5 Max!</p> <p>The reason this cannot be done on the printer, seems to be some incompatibility with pyserial and MIPS, and issue for this has been opened  https://github.com/Arksine/katapult/issues/137 </p>"},{"location":"cartographer_V4_flashing/#flashing-the-cartographer","title":"Flashing the Cartographer","text":"<p>You will need some kind of linux environment, this can be a Raspberry Pi, desktop Linux or even a Linux Server if you can plug something in via USB.   If you do not have anything like that, you will need to create a Live USB key running Ubuntu 24.04 Desktop edition.</p>"},{"location":"cartographer_V4_flashing/#creating-a-live-usb-key","title":"Creating a Live USB Key","text":"<p>You should create a live USB with Ubuntu 24.04 (25.04 also works) Desktop, make sure the USB is at least 8GB in size!</p> <p>https://ubuntu.com/tutorials/try-ubuntu-before-you-install#1-getting-started</p>"},{"location":"cartographer_V4_flashing/#installation-dependencies","title":"Installation dependencies","text":"<p>On your raspberry pi, linux desktop, linux server or live Ubuntu USB environment you need to run the following commands to install essential packages.</p> <pre><code>sudo apt-get update\nsudo apt-get install virtualenv python3-dev python3-pip python3-setuptools libffi-dev build-essential git dfu-util\n</code></pre>"},{"location":"cartographer_V4_flashing/#clone-klipper-and-cartographer-firmware","title":"Clone Klipper and Cartographer-Firmware","text":"<pre><code>git clone \"https://github.com/Klipper3d/klipper\" $HOME/klipper\ngit clone \"https://github.com/Cartographer3D/cartographer_firmware\" $HOME/cartographer_firmware\n</code></pre> <p>Note</p> <p>If you already have <code>cartographer_firmware</code> cloned locally, make sure you are on latest <code>main</code> like so:</p> <pre><code>cd $HOME/cartographer_firmware\ngit fetch\ngit switch main\ngit reset --hard origin/main\n</code></pre>"},{"location":"cartographer_V4_flashing/#setup-klipper-virtual-env","title":"Setup Klipper Virtual Env","text":"<pre><code>virtualenv --system-site-packages $HOME/klippy-env\n$HOME/klippy-env/bin/pip3 install -r $HOME/klipper/scripts/klippy-requirements.txt\n</code></pre>"},{"location":"cartographer_V4_flashing/#flashing-k1-cartographer-firmware","title":"Flashing K1 Cartographer Firmware","text":"<p>This firmware is provided by Richard from Cartographer3d.com specifically for the potato printers like the K1, K1C, K1SE, K1 Max, Ender 3 V3 KE and Ender 5 Max.   It is critical that you flash your cartographer with this version of the Survey firmware over the official Survey Firmware on K1, K1SE, K1C, K1M, Ender 3 V3 KE and Ender 5 Max to avoid stuttering and instability, especially during bed meshes!</p>"},{"location":"cartographer_V4_flashing/#connect-cartographer-via-usb","title":"Connect Cartographer via USB","text":"<p>Plug the cartographer into your computer and make sure it shows up if you type <code>lsusb</code> you should find an entry something like this:</p> <pre><code>Bus 001 Device 067: ID 1d50:614e OpenMoko, Inc.\n</code></pre>"},{"location":"cartographer_V4_flashing/#enable-bootloader","title":"Enable Bootloader","text":"<pre><code>CARTO_DEV=$(ls /dev/serial/by-id/usb-* | grep \"IDM\\|Cartographer\" | head -1)\ncd $HOME/klipper/scripts\nsudo -E $HOME/klippy-env/bin/python -c \"import flash_usb as u; u.enter_bootloader('$CARTO_DEV')\"\n</code></pre> <p>Warning</p> <p>If you get a message like <code>ls: cannot access '/dev/serial/by-id/usb-*': No such file or directory</code>, it means you forgot the <code>*</code> in the command above, your carto cable is incorrectly pinned or you are using a VM or WSL (against advice) and have not passed through the Cartographer USB Device!</p> <p>You should see a message like:</p> <pre><code>Entering bootloader on /dev/serial/by-id/usb-Cartographer_614e_16000C000F43304253373820-if00\n</code></pre> <p>Note</p> <p>If the carto does not enter bootloader mode, it is possible you forgot to use sudo! If your carto does show up in /dev/serial but won't enter bootloader mode, you will need to fix this with DFU mode</p>"},{"location":"cartographer_V4_flashing/#flashing","title":"Flashing","text":"<pre><code>CATAPULT_DEV=$(ls /dev/serial/by-id/usb-katapult*)\nsudo -E $HOME/klippy-env/bin/python $HOME/klipper/lib/canboot/flash_can.py -f $HOME/cartographer_firmware/firmware/v4/firmware/6.0.0/CartographerV4_6.0.0_USB_lite_8kib_offset.bin -d $CATAPULT_DEV\n</code></pre> <p>You should see output like this:</p> <pre><code>/home/jason/klipper/lib/canboot/flash_can.py:589: DeprecationWarning: There is no current event loop\n  loop = asyncio.get_event_loop()\nAttempting to connect to bootloader\nCanBoot Connected\nProtocol Version: 1.1.0\nBlock Size: 64 bytes\nApplication Start: 0x8002000\nMCU type: stm32g431xxv0.0.1-104-gfcb2f84-dirty\nFlashing '/home/jason/cartographer_firmware/firmware/v4/firmware/6.0.0/CartographerV4_6.0.0_USB_lite_8kib_offset.bin'...\n\n[##################################################]\n\nWrite complete: 14 pages\nVerifying (block count = 435)...\n\n[##################################################]\n\nVerification Complete: SHA = FCA6E37F4D9F344E7AF18C7609AEBBCFD6E597E0\nCAN Flash Success\n</code></pre> <p>Note</p> <p>If the carto does not flash, it is possible you forgot to use sudo!</p> <p>Warning</p> <p>If you get a message like <code>ls: cannot access '/dev/serial/by-id/usb-katapult*': No such file or directory</code>, it means you forgot the <code>*</code> in the command above, you are using a VM or WSL (against advice) and have not passed through the <code>katapult stm32f042x6</code> USB Device!</p> <p>If the Cartographer is no longer flashing blue its also possible the katapult bootloader has become corrupted which is actually frighteningly easy to do which is why I generally discourage the use of WSL or VMs!</p> <p>When you reconnect your carto to your printer it should show a version <code>CARTOGRAPHER V4 6.0.0 Lite</code>:</p> <p>Source: https://docs.cartographer3d.com/cartographer-probe/firmware/manual-methods/cartographer-with-input-shaper/update-via-katapult-recommended#updating-a-usb-probe-via-katapult</p> <p></p>"},{"location":"cartographer_V4_flashing/#flashing-k1-firmware-via-dfu-mode","title":"Flashing K1 Firmware via DFU Mode","text":"<p>Note</p> <p>This process is applicable for K1, K1C, K1SE, K1 Max, Ender 3 V3 KE and Ender 5 Max!</p> <p>You need to bridge the boot pins before you plug your carto in via USB to your Linux session, make sure <code>lsusb</code> reports it being in DFU mode, it should show</p> <p></p> <p>Source: https://docs.cartographer3d.com/cartographer-probe/firmware/updating-firmware#cartographer-v4-1</p> <p>Then cd to the combined firmware directory </p> <pre><code>cd $HOME/cartographer_firmware/firmware/v4/combined-firmware/6.0.0\n</code></pre> <p>And run dfu-util to write the firmware:</p> <pre><code>sudo dfu-util -R -a 0 -s 0x08000000:leave -D Katapult_plus_CartographerV4_6.0.0__USB_lite.bin\n</code></pre> <p></p> <p>Source: https://docs.cartographer3d.com/cartographer-probe/firmware/manual-methods/cartographer-with-input-shaper/update-via-dfu-mode</p> <p>Note</p> <p>The error <code>dfu-util: Error during download get_status</code> can be safely ignored, the message <code>File downloaded successfully</code> is what  you are looking for.</p>"},{"location":"cartographer_faq/","title":"Frequently Asked Questions","text":""},{"location":"cartographer_faq/#how-do-i-use-my-cartographer-for-input-shaping","title":"How do I use my cartographer for input shaping?","text":"<p>Note</p> <p>These instructions do not apply to Simple AF for RPi, although it is certainly possible to use the Cartographer as ADXL on non creality printers.</p> <p>This just needs a few changes in <code>printer.cfg</code></p> <p>You need to modify the <code>[adxl345]</code> section</p> <p>Change the <code>cs_pin</code> from <code>nozzle_mcu:PA4</code> to <code>cartographer:PA3</code> (V3 Probe) or <code>cartographer:PA0</code> (V4 Probe)</p> <p>Danger</p> <p>On V4 Cartographer Probe <code>cartographer:PA3</code> is not the right pin, you must use <code>cartographer:PA0</code>!  PA3 on V4 is used for something else, and will cause a potential boot loop of the probe. </p> <p>Note</p> <p>If you are using the cartotouch on Simple AF, replace <code>cartographer:</code> with <code>scanner:</code> in the configuration!</p> <p>Then disable the following settings:</p> <ul> <li><code>spi_speed: 5000000</code></li> <li><code>spi_software_sclk_pin: nozzle_mcu:PA5</code></li> <li><code>spi_software_mosi_pin: nozzle_mcu:PA7</code></li> <li><code>spi_software_miso_pin: nozzle_mcu:PA6</code></li> </ul> <p>And add the following settings:</p> <ul> <li><code>spi_bus: spi1</code></li> <li><code>axes_map: x, y, z</code></li> </ul> <p>So your [adxl345] should look like:</p> <pre><code>[adxl345]\n#cs_pin: nozzle_mcu:PA4\ncs_pin: cartographer:PA3 or cartographer:PA0\nspi_bus: spi1\n#spi_speed: 5000000\naxes_map: x, y, z\n#spi_software_sclk_pin: nozzle_mcu:PA5\n#spi_software_mosi_pin: nozzle_mcu:PA7\n#spi_software_miso_pin: nozzle_mcu:PA6\n</code></pre> <p>I do not know if this is a good idea, I just know it's possible!</p> <p>Source: https://docs.cartographer3d.com/cartographer-probe/installation-and-setup/software-configuration/klipper-setup#configure-klipper</p>"},{"location":"cartographer_troubleshooting/","title":"Troubleshooting","text":"<p>https://docs.cartographer3d.com/cartographer-probe/troubleshooting</p>"},{"location":"cartographer_troubleshooting/#probe-triggered-prior-to-movement","title":"Probe triggered prior to movement","text":"<p>This seems to be reasonably common problem for K1 series users, and a few things have been suggested to try and counteract it, first is to downgrade the firmware on the cartographer to <code>5.0.0 K1</code>, and you might have noticed that this is the version we recommend for  V3 Cartographer users now!  Unfortunately for V4 Cartographer users there is no such option, and we are starting to see this probe  triggered prior to movement issue for them too.</p> <p>If you are still having the problem on 5.0.0 K1 series or have a V4 cartographer, you could try adding an additional configuration option to <code>cartographer.cfg</code> file, specifically <code>retract_distance: 10.0</code>:</p> <pre><code>[cartographer touch]\nmax_samples: 20\nretract_distance: 10.0\n</code></pre> <p>If all else fails, there is always Cartotouch</p> <p>Warning</p> <p>If you get an error saying that <code>retract_distance</code> is not a valid config option, make sure that you have updated the Cartographer plugin to latest via Fluidd or Mainsail software section.</p>"},{"location":"cartographer_troubleshooting/#you-must-flash-the-cartographer-with-k1-specific-firmware","title":"You must flash the cartographer with K1 specific firmware!","text":"<p>This means when you received your cartographer you failed to flash it with the K1 (known as Lite for V4 cartographer) specific firmware required for Simple AF and Cartographer to function without causing lots of performance and stability issues.   Validations were recently added to various macros in Simple AF for the new Cartographer software to abort if the non K1 / Lite specific firmware is not flashed.</p> <p>cartographer firmware</p>"},{"location":"cartographer_troubleshooting/#mcu-cartographer-unknown-command-debug_read","title":"mcu 'cartographer': Unknown command: debug_read","text":"<p>If you get the following error, it means that the cartographer is not connected to the printer.   This is either because its physically not connected, the wiring is wrong, the usb subsystem has disconnected the carto during a restart or the serial id is wrong</p> <p></p> <p>Danger</p> <p>If you are on V4 Cartographer Probe <code>cartographer:PA3</code> is not the right pin, you must use <code>cartographer:PA0</code>!  PA3 on V4 is used for something else, and will cause a potential boot loop of the probe causing the 'Unknown command: debug_read' error</p> <p>So from ssh run a <code>lsusb</code> and make sure you can see:</p> <p></p> <p>If you cannot see it in <code>lsusb</code>, then it very likely means either the carto is wired incorrectly, or if was working, it just means that an attempt to restart the carto failed because the K1 refused to recognise it, there is no recourse except to restart the host via Fluidd / Mainsail (or power cycle the printer)</p> <p>If you can see the carto in lsusb, then you should try to update the serial refer to Manual Cartographer Serial Device configuration</p>"},{"location":"cartographer_troubleshooting/#error-during-probe-mcu-identification-check-connection","title":"Error during probe mcu identification, check connection","text":"<p>If you get the following error, it means that the cartographer is not connected to the printer.   This is either because its physically not connected, the wiring is wrong, the usb subsystem has disconnected the carto during a restart or the serial id is wrong</p> <p></p> <p>So from ssh run a <code>lsusb</code> and make sure you can see:</p> <p></p> <p>If you cannot see it in <code>lsusb</code>, then it very likely means either the carto is wired incorrectly, or if was working, it just means that an attempt to restart the carto failed because the K1 refused to recognise it, there is no recourse except to restart the host via Fluidd / Mainsail (or power cycle the printer)</p> <p>If you can see the carto in lsusb, then you should try to update the serial refer to Manual Cartographer Serial Device configuration</p>"},{"location":"cartographer_troubleshooting/#manual-cartographer-serial-device-configuration","title":"Manual Cartographer Serial Device configuration","text":"<p>You can run the following command to fix your serial if you forgot to plug your cartographer in during the installation or update:</p> <pre><code>~/pellcorp/installer.sh --fix-serial\n</code></pre> <p>Note</p> <p>If you run the above and receive an error like:</p> <pre><code>```\nroot@K1Max-AF34 /root [#] ~/pellcorp/installer.sh --fix-serial\n-sh: /root/pellcorp/installer.sh: not found\n```\n</code></pre> <p>It means you are on an older version of Simple AF and you should instead use the old style commands:</p> <pre><code>```\n/usr/data/pellcorp/k1/installer.sh --fix-serial\n```\n</code></pre>"},{"location":"cartographer_troubleshooting/#cartographer-is-not-connected-aborting-homing-z","title":"Cartographer is not connected, aborting homing Z","text":"<p>If you see this error when trying to home your printer, it is a clear indication that the cartographer was disconnected and you should look for a <code>mcu 'cartographer' disconnected</code> error in your klippy.log or gcode console, if the cartographer was momentarily disconnected (so if you run <code>lsusb</code> on the printer the cartographer shows up), you can simply restart klipper from the services menu in Fluidd or Mainsail, if the cartographer completely disappeared you will need to power cycle the printer!</p>"},{"location":"cartographer_wiring/","title":"Cartographer Wiring","text":"<p>Note</p> <p>This wiring section applies to K1/K1C/K1SE/K1M printers only</p> <p>On a K1M you can use the lidar cable either directly by repinning it, or via the pass through lidar port on the toolhead.  However you cannot use the lidar port on the toolhead for K1, K1C or K1SE.   The reason this does not work is because for Lidar on the K1M creality actually routes a completely separate USB cable from the mainboard.</p> <p></p>"},{"location":"cartotouch/","title":"Cartotouch","text":""},{"location":"cartotouch/#where-can-i-get-help","title":"Where can I get help?","text":"<p>Come on over to the pellcorp discord server, the <code>#simple-af-carto</code> channel has been setup for anyone wanting support for cartographer.</p> <p>https://discord.gg/2uGDzyJ3WX</p>"},{"location":"cartotouch/#thanks","title":"Thanks","text":"<p>Thanks to Richard from https://cartographer3d.com and Zarboz from https://wattskraken.xyz/ for donating Cartographers to the Simple AF project to add support and continue to support the cartographer.</p>"},{"location":"cartotouch/#downgrading-from-cartographer","title":"Downgrading from Cartographer?","text":"<p>Its really easy to update, you can simply do a probe switch like this:</p> <pre><code>~/pellcorp/installer.sh --update cartotouch --mount %CURRENT%\n</code></pre> <p>Then do calibration as normal</p>"},{"location":"cartotouch/#firmware-requirements","title":"Firmware requirements","text":""},{"location":"cartotouch/#limits-on-x-and-y-microsteps","title":"Limits on X and Y microsteps","text":"<p>You cannot use more than <code>microsteps: 32</code> for <code>[stepper_x]</code> and <code>[stepper_y]</code>, the MCU cannot handle high microsteps, it puts too much pressure on the mainboard and it will cause stuttering and other reliability issues including random crashes.</p> <p>Note</p> <p>This limit generally does not apply to RPi Series Simple AF</p>"},{"location":"cartotouch/#k1-series","title":"K1 Series","text":"<p>This guide assumes you have a K1, K1C, K1SE or K1 Max and you are running stock creality firmware 1.3.3.5 or higher (The firmware 1.3.3.5 is much older than 1.3.3.46 for example), or alternately you can use my prerooted firmware.</p>"},{"location":"cartotouch/#ender-5-max","title":"Ender 5 Max","text":"<p>This guide assumes you are running stock Creality firmware 1.2.0.10 or higher on your Ender 5 Max.</p> <p>The stock firmware comes pre-rooted, with the default root password being <code>Creality@2024_Wh_464</code></p> <p>Please note that you will need to change the screen orientation to horizontal, here is a model for that https://www.printables.com/model/1246910-ender-5-max-screen-bracket</p>"},{"location":"cartotouch/#ender-3-v3-ke","title":"Ender 3 V3 KE","text":"<p>This guide assumes you have a stock Ender 3 V3 KE with Nebula Pad with Root enabled, when you get to installation below, you should specify the <code>--mount Default</code> to install Simple AF on the KE for Cartographer.</p> <p>Please note that you will need to change the screen orientation to horizontal, here is a model for that https://www.printables.com/model/727362-ender-3-v3-ke-screen-holder-landscape-for-guppyscr, but please do not follow the installation instructions on that page, just print the model and remount your screen only! An alternative model which honestly seems a bit cleaner: https://www.printables.com/model/706657-creality-ender-3-v3-e3v3-se-ke-and-cr-10-se-portra</p>"},{"location":"cartotouch/#simple-af-for-rpi","title":"Simple AF for RPi","text":"<p>See Simple AF for RPi</p>"},{"location":"cartotouch/#slicer-settings","title":"Slicer Settings","text":"<p>Danger</p> <p>Creality Print won't be able to see your printer after you have installed Simple AF, the only tested slicer we all use is OrcaSlicer, likely if you want to use Creality Print you will need to print via usb.</p> <p>Cura Slicer won't work out of the box for configuring START_PRINT variables as below, you need to change the start print EXTRUDER_TEMP and BED_TEMP to pass in the correct values, but since I don't use Cura Slicer I can't advise on that!</p> <p>If you have used a cartographer with k1-klipper, please note that the <code>PRINT_START</code> macro specified in their docs is not supported by this project.   You must change your Slicer Start Print Machine G-Code (see next)</p> <p>There is an assumption that you are using a slicer like OrcaSlicer and Machine G-code like:</p> <p></p> <p>Machine start G-code</p> <pre><code>M140 S0\nM104 S0\nSTART_PRINT EXTRUDER_TEMP=[nozzle_temperature_initial_layer] BED_TEMP=[bed_temperature_initial_layer_single]\n</code></pre> <p>Machine end G-code</p> <pre><code>END_PRINT\n</code></pre>"},{"location":"cartotouch/#custom-bed-mesh-profile","title":"Custom Bed Mesh Profile","text":"<p>If you want to select a specific predefined bed mesh profile (which disables adaptive mesh generation), you can pass in an additional <code>START_PRINT</code> parameter:</p> <p>You can either hard code it to a particular model, like <code>BED_MESH_PROFILE=myprofile</code> or you can specify a profile based on orca slicer variables, such as <code>BED_MESH_PROFILE=\"[curr_bed_type] - [filament_type]\"</code>, but you have to make sure you have all the possible profiles defined for each of the bed type and filament type combinations.</p> <p></p>"},{"location":"cartotouch/#probe-installation","title":"Probe Installation","text":"<p>It is strongly recommended to connect your probe to the front USB port initially and use it for a while that way to make sure its stable, before directly wiring it to either the mainboard or making a cable for the lidar port (K1M users only).   If possible avoid destroying the original cable when you are making your lidar or direct mainboard connection as you might need it in the future!</p> <p>Danger</p> <p>If you are not using a side mount you must verify config changes for cartotouch.cfg before homing your printer, using Screws Tilt Calculate or doing a bed mesh!  </p> <p>Ignoring these instructions can lead to significant damage to your build plate and/or probe.</p>"},{"location":"cartotouch/#mount-options","title":"Mount Options","text":"Mount Printer Carto URL Notes Default K1, K1C, K1M, K1SE V3\u00a0Right\u00a0Angle https://www.printables.com/model/1037606-cartographer-3d-right-angle-k1-series-mount D3vilStock K1, K1C, K1M, K1SE V3\u00a0Flat\u00a0Pack https://www.printables.com/model/684338-k1-k1max-eddy-current-mount-cartographer BootyGantry K1, K1C, K1M, K1SE V3\u00a0Right\u00a0Angle https://github.com/tlace17/K1-Linear-Rail-Gantry/blob/main/STLs/Probe%20Mounts/Rail%20Carriage%20Carto%20Mount.stl May require shimming for correct nozzle offset SkeletorMK7 K1, K1C, K1M, K1SE V3\u00a0Low\u00a0ProfileV4\u00a0Low\u00a0Profile https://www.printables.com/model/833769-the-skeletor-collection-a-creality-k1k1-maxk1c-cooGet it printed: https://mk7.tbkm.xyz/ SkeletorRightAngle K1, K1C, K1M, K1SE All V3 and V4 variants https://www.printables.com/model/1362668-skeletor-mk7-side-mounted-cartographer-integration PurcellV5 K1, K1C, K1M, K1SE V3\u00a0Right\u00a0Angle https://www.printables.com/model/1071493-cartographer-probe-side-mount-options-for-crealityhttps://www.printables.com/model/1239076-creality-k1-cartographer-right-angle-mount This also works with V3 and V4, probably also V8 SimplyHexed Ender 5 Max V3\u00a0Right\u00a0Angle https://www.printables.com/model/1209230-ender-5-max-simply-hexed Requires custom shroud Default Ender 3 V3 SE V3\u00a0Right\u00a0Angle https://www.printables.com/model/732262-ender-3-v3-ke-beaconcartographer-mount Will probably require shimming especially if you ugprade to a k1 hotend Default Ender 3 V3 KE V3\u00a0Right\u00a0Angle https://www.printables.com/model/732262-ender-3-v3-ke-beaconcartographer-mount Might require shimming depending on the hotend / nozzle you use"},{"location":"cartotouch/#nozzle-offset","title":"Nozzle Offset","text":"<p>Warning</p> <p>It is vital that you verify the coil to nozzle tip distance is within the valid range of 2.6 to 3mm, you can use this simple tool to verify the range: https://www.printables.com/model/1325363-cartographer-and-beacon-z-offset-goldilocks-tool</p> <p>Just be sure to use digital calipers to verify the print printed with the correct size before relying on it, if you have trouble with  your z not being always entirely accurate consider printing the model on its side.</p>"},{"location":"cartotouch/#cartographer-firmware","title":"Cartographer Firmware","text":"<p>Warning</p> <p>For K1 Series (which includes K1, K1C, K1SE, K1 Max, Ender 3 V3 KE and Ender 5 Max) Simple AF you must flash your V3 Probe with <code>CARTOGRAPHER K1 5.0.0</code>:</p> <p></p> <p>For a V4 Probe <code>CARTOGRAPHER V4 6.0.0 Lite</code>:</p> <p></p> <p>For K1 Series (which includes K1, K1C, K1SE, K1 Max, Ender 3 V3 KE and Ender 5 Max) Simple AF there is a guide for V3 Probes and V4 Probes.</p> <p>For Simple AF for RPi, you can use the standard cartographer guide https://docs.cartographer3d.com/cartographer-probe/firmware/firmware-updating/via-katapult/usb-flash#usb-katapult-updating</p> <p>If you are using a Pi3 or less (so CB1, CB2, OPi 3, etc) to run klipper, I strongly recommend using the K1/Lite variants of the cartographer firmware, you can do that  in the firmware script by enabling Advanced Mode and Enabling Creality K Series Firmware.</p>"},{"location":"cartotouch/#installation","title":"Installation","text":"<p>Warning</p> <p>The installation section does not apply to Simple AF for RPi, See Simple AF for RPi</p> <p>The installation can only be performed on a printer which has been rooted and ssh granted</p> <p>You need root access, if you are not already root, then follow the excellent Helper Script Enable Root Access instructions.</p> <p>Tip</p> <p>ZeroDotCmd (aka Zero on discord) has provided an excellent Cartographer installation video, you can find it https://www.youtube.com/watch?v=GuxMITM9o4I</p> <p>Please note however that the macros referenced in the video guide have been removed and you should instead follow the Calibration section of this wiki, I do not have the time to maintain the old guided macros, but you can still use the QUICK_START macro to do the pid and input shaper tuning.</p>"},{"location":"cartotouch/#factory-reset","title":"Factory Reset","text":"<p>You must do a factory reset only if you have installed Helper Script or Fluidd/Mainsail directly from Creality, otherwise you can safely proceed directly to installation.    If you have setup your printer with stock firmware only it can be quite handy to skip a factory reset so that you can use Switch to Stock</p> <pre><code>wget --no-check-certificate https://raw.githubusercontent.com/pellcorp/creality/main/k1/services/S58factoryreset -O /tmp/S58factoryreset\nchmod +x /tmp/S58factoryreset\n/tmp/S58factoryreset reset\n</code></pre> <p>Danger</p> <p>It is really important you do not close the ssh session until you get this message:</p> <p></p> <p>It can take up to 5 minutes for a factory restart to finish, it is vital you do not power cycle your printer before the stock screen appears. There may be a 3002 error on the screen, this is completely normal.   If you are planning to install Simple AF you can ignore it, if you are trying to go back to stock, power cycle the printer again to clear the error.  </p> <p>Failing to follow this advice can lead to your printer getting bricked and requiring much more involved intervention to recover!</p> <p></p>"},{"location":"cartotouch/#clone-the-repo","title":"Clone the Repo","text":"<pre><code>git config --global http.sslVerify false\ngit clone https://github.com/pellcorp/creality.git /usr/data/pellcorp\n</code></pre>"},{"location":"cartotouch/#run-the-installer","title":"Run the installer","text":"<p>Note</p> <p>If you have pellcorp-overrides in github but not stored locally, you need to recreate the ~/pellcorp-overrides directory before running the installer.sh!</p> <p>To run the script, you must use the following command:</p> <pre><code>/usr/data/pellcorp/installer.sh --install cartotouch --mount Mount\n</code></pre> <p>Warning</p> <p>For <code>Mount</code> you must specify the mount option for the mount you have used, if you do not do this the printer will be incorrectly configured for your mount, and bed meshes, x and y limits and related config will be wrong.   Please refer to Mount Options for supported mounts.   </p> <p>If you are using a non-supported mount you should specify a mount option as close to your mount as possible and properly adjust your configuration after installation before trying to perform a bed mesh or Screws Tilt Calculate!</p>"},{"location":"cartotouch/#post-installation","title":"Post Installation","text":""},{"location":"cartotouch/#mcu-firmware-updates-are-pending","title":"MCU Firmware updates are pending","text":"<p>At the end of the installer process if you get this message:</p> <pre><code>WARNING: MCU Firmware updates are pending you need to power cycle your printer!\n</code></pre> <p>It means that new MCU firmware updates need to be applied and this can only be done by power cycling the printer.  After your printer is power cycled you can verify firmware was updated with the <code>CHECK_FIRMWARE</code> macro from Fluidd or Mainsail, if you see this message:</p> <pre><code>INFO: Your MCU Firmware is up to date!\n</code></pre> <p>Your printer MCU firmware was updated successfully.   If you still see the <code>MCU Firmware updates are pending you need to power cycle your printer!</code> message after a power cycle, check the <code>/tmp/mcu_update.log</code>, you may be asked to provide this file on Discord if you need additional assistance, sometimes an additional power cycle can solve the problem, there is a very short window of time (15 seconds) in which the MCU firmware can be updated, so  there is a chance it will work after an additional power cycle.</p>"},{"location":"cartotouch/#verify-usb-key","title":"Verify USB Key","text":"<p>It is important to make sure you have a way to emergency factory reset the printer, if the worst happens.   There is a macro in Simple AF called <code>CHECK_USB_KEY</code> that will wait for you to plug a USB thumb drive (aka USB key) in and tell you if it was able to be successfully mounted.</p> <p>You can find the CHECK_USB_KEY macro in Fluidd or Mainsail, because Fluidd and Mainsail are already installed, you can access Fluidd by opening your browser and connecting using http://X.X.X.X, where X.X.X.X is your ip address that you used to login via ssh to your printer, you can also access Fluidd via http://X.X.X.X:4408 and Mainsail via http://X.X.X.X:4409!</p> <p></p> <p>After running the macro you should see output like the following:</p> <p></p> <ul> <li>If you get the message: <code>INFO - USB Key was recognised and mounted correctly (/tmp/udisk/sda1)</code>, your USB thumb drive (aka USB key) is perfect to use for a factory reset.</li> <li>If you get no message at all before the script ends (after 60 seconds), your USB thumb drive (aka USB key) is defective.   You can check the <code>messages</code> file in the logs section of your UI to get more details about why the usb key could not be mounted!</li> </ul> <p>Tip</p> <p>You should verify your USB thumb drive (aka USB key) often just to make sure you have something if you need to unbrick your printer, simply type <code>CHECK_USB_KEY</code> or hit the button in Fluidd / Mainsail The USB key should be FAT32 formatted and be no larger than 32GB!</p> <p>Note</p> <p>If you have plugged your cartographer into the front usb port, you are going to have to temporarily remove the cartographer from the front usb slot and replace it with your USB thumb drive (aka USB key), after you have finished verifying the USB thumb drive (aka USB key) can be used in an emergency, you can replace the cartographer into the front usb slot and restart klipper or power cycle your printer.</p>"},{"location":"cartotouch/#calibration","title":"Calibration","text":"<p>Warning</p> <p>The following calibration steps are required to setup a new printer:</p> <ul> <li>Enable Touch Mode</li> <li>Manual Cartographer Calibrate</li> <li>Cartographer Threshold Scan</li> <li>Cartographer Touch Calibration</li> <li>PID Tuning and Input Shaping</li> </ul> <p>Note</p> <p>If you are running calibration for a printer that has previously been calibrated, the following SAVE_CONFIG sections must be removed from the bottom of the printer.cfg (if they exist) before redoing these calibrations:</p> <ul> <li><code>[scanner model default]</code></li> <li><code>[scanner]</code></li> <li><code>[axis_twist_compensation]</code></li> <li><code>[bed_mesh]</code></li> </ul>"},{"location":"cartotouch/#enable-touch-mode","title":"Enable Touch Mode","text":"<p>To be able to set up the printer for cartographer with touch mode for printing you need to make sure the mode is set to touch.</p> <ol> <li>Run <code>PROBE_SWITCH MODE=touch</code> Upon completion <code>SAVE_CONFIG</code></li> </ol> <p>Source: https://docs.cartographer3d.com/original-plugin/installation/calibration#initial-calibration</p>"},{"location":"cartotouch/#manual-cartographer-calibrate","title":"Manual Cartographer Calibrate","text":"<ol> <li>Run the <code>STOP_CAMERA</code> macro to stop the camera</li> <li>Home X Y (<code>G28 X Y</code>)</li> <li>Heat Nozzle to 150c (<code>M109 S150</code>) so that any filament can be removed from nozzle</li> <li>Run <code>CARTOGRAPHER_CALIBRATE METHOD=manual</code> Follow the Paper Test Method Upon completion <code>SAVE_CONFIG</code></li> </ol> <p>Note</p> <p>Is normal to show the Z position at almost at the max height of the printer even if the nozzle is somewhere in the middle or even close to the bed, this is not a bug, its intentional.   Until this calibration step is completed, the Z axes cannot be homed, so we make the printer pretend the bed is down the bottom of the printer so that you can freely move the bed up to meet the nozzle during the paper test without running into out of range issues.  You however won't be able to move the bed further away from the nozzle more than a few mm.</p> <p></p> <p>Warning</p> <p>Do not use a metal feeler gauge for this step, it could damage your cartographer!!!</p> <p>Source: https://docs.cartographer3d.com/original-plugin/settings-and-commands#cartographer_calibrate</p> <p>After the save config you have to do the cartographer threshold scan (see next)</p>"},{"location":"cartotouch/#cartographer-threshold-scan","title":"Cartographer Threshold Scan","text":"<p>Danger</p> <p>For this next step, it is really important to be near your printer for this step, because if there is any issue with the printer configuration or your carto probe, its possible the nozzle will dig itself into the bed, so be hovering over that e-stop button!</p> <ol> <li>Run the <code>STOP_CAMERA</code> macro to stop the camera</li> <li>Home All (<code>G28</code>)</li> <li>Heat Nozzle to 150c (<code>M109 S150</code>) so that any filament can be removed from nozzle</li> <li>Run <code>CARTOGRAPHER_THRESHOLD_SCAN SPEED=2 MIN=1000 MAX=5000</code> Upon completion <code>SAVE_CONFIG</code></li> </ol> <p>After the save config you have to do the touch calibration.</p> <p>Source: https://docs.cartographer3d.com/original-plugin/settings-and-commands#cartographer_threshold_scan</p>"},{"location":"cartotouch/#cartographer-touch-calibration","title":"Cartographer Touch Calibration","text":"<p>Danger</p> <p>For this next step, it is really important to be near your printer for this step, because if there is any issue with the printer configuration or your carto probe, its possible the nozzle will dig itself into the bed, so be hovering over that e-stop button!</p> <ol> <li>Run the <code>STOP_CAMERA</code> macro to stop the camera</li> <li>Home All (<code>G28</code>)</li> <li>Heat Nozzle to 150c (<code>M109 S150</code>) so that any filament can be removed from nozzle</li> <li>Run <code>CARTOGRAPHER_CALIBRATE</code> Upon completion <code>SAVE_CONFIG</code></li> </ol> <p>Tip</p> <p>If this fails after 3 tries, you should check to make sure there is not filament stuck to the bottom of your nozzle!</p> <p>Source: https://docs.cartographer3d.com/original-plugin/installation/calibration#setting-up-touch</p>"},{"location":"cartotouch/#pid-tuning-and-input-shaping","title":"Pid Tuning and Input Shaping","text":"<p>At least PID tuning (bed and extruder) and input shaping is required for acceptable printing.  If you try and print after running the installer.sh and a power cycle but before any calibration you will most likely have horrendous quality, the worst you have ever seen on the k1.   After PID tuning and input shaping you should see the same kind of quality as you get with stock k1 + input shaper fix.</p> <p>Note</p> <p>You can use the QUICK_START Macro to complete Bed and Nozzle PID Tuning and Input Shaping Automatically.</p>"},{"location":"cartotouch/#pid-tuning","title":"Pid Tuning","text":"<p>Source: Calibrate Pid Settings</p> <p>For example you might run these:</p> <pre><code>PID_CALIBRATE_BED BED_TEMP=65\nPID_CALIBRATE_HOTEND HOTEND_TEMP=230\n</code></pre> <p>Note</p> <p>The <code>PID_CALIBRATE_BED</code> and <code>PID_CALIBRATE_HOTEND</code> macros are located in the <code>useful_macros.cfg</code> file and they have defaults values for BED_TEMP and HOTEND_TEMP so you can just run them by clicking on them if you want that same temperature.</p>"},{"location":"cartotouch/#input-shaping","title":"Input Shaping","text":"<p>There is no default configuration for input shaping so it is essentially disabled out of the box.</p> <p>You can use the <code>SHAPER_CALIBRATE</code> macro to run input shaping, just be sure to <code>SAVE CONFIG</code> at the end, to choose the automatically selected shaper config, be aware though that the shaper chosen might be sub-optimal due to a slight difference in vibrations between two options.  So you should probably review the output and potentially choose an alternative if it gives you higher recommended max acceleration for minimal increase in vibration.</p> <p>Input Shaper Auto Calibration</p>"},{"location":"cartotouch/#axis-twist-compensation","title":"Axis Twist Compensation","text":"<p>Next it is highly recommended to perform axis twist compensation calibration if you are using a rear mount before doing anything else, this will affect the quality of your bed mesh, so best to do it before.</p> <ol> <li>Home All (<code>G28</code>)</li> <li>Run <code>AXIS_TWIST_COMPENSATION_CALIBRATE</code> The calibration wizard will prompt you to measure the probe Z offset at a few points along the bed    Upon completion <code>SAVE_CONFIG</code></li> </ol> <p>Warning</p> <p>Do not use a metal feeler gauge for this step, it could damage your cartographer!!!</p> <p>Source: https://www.klipper3d.org/Axis_Twist_Compensation.html</p>"},{"location":"cartotouch/#first-print","title":"First Print","text":"<p>You should optimise your <code>scanner_touch_z_offset</code> using baby stepping, as documented here: https://docs.cartographer3d.com/original-plugin/installation/first-print</p> <p>In fluidd the save button after you finish or cancel your print can be a bit hard to find, look for</p> <p></p>"},{"location":"cartotouch/#other-calibrations","title":"Other Calibrations","text":"<p>Info</p> <p>The default value for pressure advance is set to <code>0.04</code></p> <p>Refer to Orcaslicer Calibration for more calibrations</p> <p>Refer to the Ellis Print Tuning Guide for more great tuning ideas.</p>"},{"location":"cartotouch/#scan-only-mode","title":"Scan Only Mode","text":"<p>Some cartographer users choose to use scan only instead of touch and that is easy enough to do, you can setup for scan immediately after installation, no need to do the 3 step calibration as for touch!</p> <p>Danger</p> <p>It is vital you are aware of the limitations of scan mode especially on the K1 series where temp calibration is not  an option.    If you print different bed and/or nozzle temp materials you must save a separate model per material and even with a single material the cartographer will return a different z-offset when hot than when cold, I strongly recommend against using scan mode on Simple AF, its actually likely to lead to bed damage unless you know exactly what you are doing!</p> <p>You can run the following:</p> <ol> <li>Run <code>PROBE_SWITCH MODE=scan</code> Upon completion <code>SAVE_CONFIG</code></li> </ol> <p>It is strongly recommended to disable the camera for this calibration step, just use the <code>STOP_CAMERA</code> macro to do this.</p> <ol> <li>Run the <code>STOP_CAMERA</code> macro to stop the camera</li> <li>Home X Y (<code>G28 X Y</code>)</li> <li>Heat Nozzle to 150c (<code>M109 S150</code>) so that any filament can be removed from nozzle</li> <li>Make sure nozzle is centred on bed</li> <li>Run <code>CARTOGRAPHER_CALIBRATE METHOD=manual</code>    Follow the Paper Test Method Upon completion <code>SAVE_CONFIG</code></li> </ol> <p>Warning</p> <p>Do not use a metal feeler gauge for this step, it could damage your cartographer!!!</p> <p>You can then use the CARTOGRAPHER_MODEL parameter to start print from your slicer to select different filament profiles, this is required if you print with different filaments and/or use different bed aurfaces.</p>"},{"location":"cartotouch/#cartographer-model","title":"Cartographer Model","text":"<p>If you want to select a particular cartographer model other than the default you can pass in an additional <code>START_PRINT</code> parameter:</p> <p></p> <p>You can either hard code it to a particular model, like <code>CARTOGRAPHER_MODEL=mymodel</code> or you can specify a model based on orca slicer variables, such as <code>CARTOGRAPHER_MODEL=\"[curr_bed_type] - [filament_type]\"</code>, but you have to make sure you have all the possible models defined for each of the bed type and filament type combinations.</p>"},{"location":"config_overrides/","title":"Config Overrides","text":"<p>The <code>pellcorp-overrides</code> directory stores custom cfg and conf files as well as customisations you have made to some of the core config files such as printer.cfg.  </p> <p>The following core config files can have overrides saved for them: </p> <ul> <li>printer.cfg</li> <li>sensorless.cfg</li> <li>cartotouch.cfg</li> <li>cartographer.cfg</li> <li>cartographer.conf</li> <li>btteddy.cfg</li> <li>btteddy_macro.cfg</li> <li>beacon.conf</li> <li>beacon.cfg</li> <li>eddyng.cfg</li> <li>klicky.cfg</li> <li>klicky_macro.cfg</li> <li>KAMP_Settings.cfg</li> <li>moonraker.conf</li> <li>start_end.cfg</li> <li>fan_control.cfg</li> <li>internal_macros.cfg</li> <li>useful_macros.cfg</li> <li>grumpyscreen.ini</li> </ul>"},{"location":"config_overrides/#restrictions","title":"Restrictions","text":"<ul> <li>No support is provided to edit <code>gcode_macro</code> or <code>homing_override</code> section <code>gcode</code> values in any config files</li> <li>You can modify <code>variable_</code> variables in gcode macros, but not the gcode macros themselves</li> <li>You can modify existing values in existing sections</li> <li>You can only add or delete values from existing sections in printer.cfg, fan_control.cfg, grumpyscreen.ini and moonraker.conf, all other files these changes will be ignored.</li> <li>You can only add or delete sections in printer.cfg, fan_control.cfg, moonraker.conf and grumpyscreen.ini, all other files these changes will be ignored.</li> </ul> <p>Tip</p> <p>You should run the CONFIG_OVERRIDES macro every time you make any changes to either your own custom cfg or conf files, or make changes to any core config files.</p> <p>Note</p> <p>The first step in both a <code>~/pellcorp/installer.sh --update</code> or <code>~/pellcorp/installer.sh  --reinstall</code> is to backup your config-overrides, so that they can be reapplied, but they will be lost if you do a factory reset.</p>"},{"location":"config_overrides/#git-backups-for-configuration-overrides","title":"Git Backups for Configuration Overrides","text":"<p>If the pellcorp-overrides directory is a git repo, calling the CONFIG_OVERRIDES or <code>~/pellcorp/tools/config-overrides.sh</code> will generate a new git commit and push it to origin if any files are changed.</p>"},{"location":"config_overrides/#create-repository","title":"Create repository","text":"<p>Create a new <code>pellcorp-overrides</code> repository on your github account:</p> <p></p> <p>Info</p> <p>You don't actually have to call it pellcorp-overrides, you can call it whatever you want, but it should be a repository dedicated to just doing backups for this project.</p> <p>Warning</p> <p>Set your new repository to be private unless you want to share settings with everyone else, or potentially sensitive information in the moonraker.conf, notifier.conf, etc.  Be really careful with using github keys in moonraker.conf update manager too, as these will be version controlled.   If possible put all your secrets in moonraker.secrets which is not saved to version control.</p>"},{"location":"config_overrides/#create-a-personal-access-token","title":"Create a personal access token","text":"<p>Click here to create a fine grained personal access token.  Create a finegrained token and limit its access to just your <code>pellcorp-overrides</code> repository.   Make sure that Contents read and write access.</p> <p></p> <p>Make sure you limit it to just the new repository you created:</p> <p></p> <p>Source: https://guilouz.github.io/Creality-Helper-Script-Wiki/helper-script/git-backup/</p>"},{"location":"config_overrides/#create-local-repo","title":"Create Local Repo","text":"<p>You will need 3 pieces of information for this process to succeed:</p> <ol> <li>Your github username</li> <li>Your email address</li> <li>The github token you just created</li> </ol> <p>Ssh into your k1 and run the following:</p> <pre><code>export GITHUB_USERNAME=myusername\nexport EMAIL_ADDRESS=me@somewhere.com\nexport GITHUB_TOKEN=\"The token I just created\"\nexport GITHUB_REPO=pellcorp-overrides\nexport GITHUB_BRANCH=main\n/usr/data/pellcorp/tools/config-overrides.sh --repo\n</code></pre> <p>Note</p> <p>The <code>GITHUB_BRANCH</code> is optional, if its not specified it will use <code>main</code> as the branch.</p> <p>On Simple AF for RPI you can use <code>~/pellcorp/tools/config-overrides.sh --repo</code></p> <p>If you want to setup the repository locally ignoring any local files in the <code>pellcorp-overrides</code> directory, you can use the <code>--clean-repo</code> argument, instead of the <code>--repo</code> argument, which will rebase the local changes on top of the repo.</p> <p>Note</p> <p>For K1 Series (including Ender 5 Max), the pellcorp-overrides is located at /usr/data/pellcorp-overrides, but there is a soft link created to /root, so you scripts and the wiki will often refer to pellcorp-overrides by the shorthand of <code>~/pellcorp-overrides</code></p> <p>The <code>moonraker.secrets</code> file is not versioned controlled.</p>"},{"location":"config_overrides/#troubleshooting","title":"Troubleshooting","text":""},{"location":"config_overrides/#support-for-password-authentication-was-removed-on-august-13-2021","title":"Support for password authentication was removed on August 13, 2021","text":"<p>This most likely means your personal access token is misconfigured, deleted, or expired</p>"},{"location":"configure_wifi/","title":"Configure Wifi via USB","text":"<p>A recently added feature allows configuring a new wifi ap via a USB Stick, you copy a <code>wpa_supplicant.conf</code> to a FAT32 formatted USB stick and plug it into the front of your printer and power cycle the printer, the printer will notice the file, copy it over to the printer and restart wifi, by the time GrumpyScreen appears your wifi ap should have been switched.</p> <p>Note</p> <p>This feature is not yet available for Simple AF for RPi!</p> <p>Danger</p> <p>If you leave the USB Stick in the printer with a <code>wpa_supplicant.conf</code> on it, the printer is going to be copying that file across and restarting WIFI every time the printer is power cycled, this is not good for the printer, so delete the wpa_supplicant.conf from the stick after the printer has switched the wifi AP over.</p> <p>The format of the file must be precisely what the printer is looking for:</p> <pre><code>ctrl_interface=/var/run/wpa_supplicant\nupdate_config=1\ncountry=GB\n\nnetwork={\n    ssid=\"THE-WIFI-SSID\"\n    psk=\"TheWifiPassword\"\n    priority=1\n}\n</code></pre> <p>For example if your wifi ssid is <code>MyWifiIsCool</code> and your Wifi AP Password is <code>Ab1123AX$@&amp;*</code>, your wpa_supplicant.conf file might looke like:</p> <pre><code>ctrl_interface=/var/run/wpa_supplicant\nupdate_config=1\ncountry=GB\n\nnetwork={\n    ssid=\"MyWifiIsCool\"\n    psk=\"Ab1123AX$@&amp;*\"\n    priority=1\n}\n</code></pre> <p>Note</p> <p>Be sure to set your country code appropriately, the default is GB for some reason.</p>"},{"location":"custom_hooks/","title":"Custom Hooks","text":"<p>Within Simple AF if you want to call a custom gcode macro you can with hooks, the following custom gcode macro hooks are supported and more can be added as needed:</p> <ul> <li>_SAF_HOMING_START - at start of homing</li> <li>_SAF_HOMING_END - at end of homing</li> <li>_SAF_START_PRINT_BEFORE_G28 - Before G28 is called in START_PRINT</li> <li>_SAF_START_PRINT_AFTER_G28 - After G28 is called in START_PRINT</li> <li>_SAF_START_PRINT_BEFORE_BED_MESH - Before bed mesh calibrate is called in START_PRINT</li> <li>_SAF_START_PRINT_AFTER_BED_MESH - After bed mesh calibrate is called in START_PRINT</li> <li>_SAF_NOZZLE_WIPE - A nozzle wipe macro that can be defined for eddyny, beacon, cartographer and cartotouch only, will be called before bed mesh for eddny and beacon, and after bed mesh for cartographer and cartotouch</li> <li>_SAF_LINE_PURGE - A custom line purge macro which will be used instead of built in LINE_PURGE</li> <li>_SAF_SMART_PARK - A custom smart park macro which will be used instead of built in SMART_PARK</li> <li>_SAF_BED_MESH_START - Start of bed mesh calibrate</li> <li>_SAF_BED_MESH_END - End of bed mesh calibrate</li> <li>_SAF_ON_FILAMENT_RUNOUT - When filament runout is triggered</li> <li>_SAF_ON_CANCEL - When cancel print is triggered</li> <li>_SAF_START_PRINT_START - Very start of START_PRINT</li> <li>_SAF_START_PRINT_BEFORE_LINE_PURGE - Just before Line Purge in start print</li> <li>_SAF_START_PRINT_END - Very end of START_PRINT</li> <li>_SAF_END_PRINT_START - Very start of END_PRINT</li> <li>_SAF_END_PRINT_END - Very end of END_PRINT</li> <li>_SAF_HEATING_NOZZLE_START - At start of M109 macro</li> <li>_SAF_HEATING_NOZZLE_END - At start of M109 macro</li> <li>_SAF_HEATING_BED_START - At start of M190 macro</li> <li>_SAF_HEATING_BED_END - At end of M190 macro</li> </ul> <p>So the way this works is you define your own custom config file (make sure it has a <code>.cfg</code> file extension), and add it to printer.cfg like so:</p> <pre><code>[include MyCustomMacros.cfg]\n</code></pre> <p>Note</p> <p>It does not need to be called <code>MyCustomMacros.cfg</code>, you can call it whatever you like, but it must end with <code>.cfg</code> and it must be saved directly in the config directory, not a sub-directory!</p> <p>Your config file should implement as many of the above macros as you want to, you do not need to implement them all, so for example if you wanted to do something after G28 in START_PRINT, you file might look like:</p> <pre><code>[gcode_macro _SAF_START_PRINT_AFTER_G28]\ngcode:\n   RESPOND TYPE=command MSG='I am getting called after G28'\n</code></pre>"},{"location":"custom_hooks/#knomi-support","title":"Knomi Support","text":"<p>A prime use case for this would be knomi support, which currently might look like this:</p> <pre><code>[gcode_macro _KNOMI_STATUS]\nvariable_homing: False\nvariable_probing: False\nvariable_qgling: False\nvariable_heating_nozzle: False\nvariable_heating_bed: False\ngcode:\n\n\n[gcode_macro _SAF_HEATING_NOZZLE_START]\ngcode:\n  SET_GCODE_VARIABLE MACRO=_KNOMI_STATUS VARIABLE=heating_nozzle VALUE=True\n\n\n[gcode_macro _SAF_HEATING_NOZZLE_END]\ngcode:\n  SET_GCODE_VARIABLE MACRO=_KNOMI_STATUS VARIABLE=heating_nozzle VALUE=False\n\n\n[gcode_macro _SAF_HEATING_BED_START]\ngcode:\n  SET_GCODE_VARIABLE MACRO=_KNOMI_STATUS VARIABLE=heating_bed VALUE=True\n\n\n[gcode_macro _SAF_HEATING_BED_END]\ngcode:\n  SET_GCODE_VARIABLE MACRO=_KNOMI_STATUS VARIABLE=heating_bed VALUE=False\n\n\n[gcode_macro _SAF_BED_MESH_START]\ngcode:\n  SET_GCODE_VARIABLE MACRO=_KNOMI_STATUS VARIABLE=probing VALUE=True\n\n\n[gcode_macro _SAF_BED_MESH_END]\ngcode:\n  SET_GCODE_VARIABLE MACRO=_KNOMI_STATUS VARIABLE=probing VALUE=False\n\n\n[gcode_macro _SAF_HOMING_START]\ngcode:\n  SET_GCODE_VARIABLE MACRO=_KNOMI_STATUS VARIABLE=homing VALUE=True\n\n\n[gcode_macro _SAF_HOMING_END]\ngcode:\n  SET_GCODE_VARIABLE MACRO=_KNOMI_STATUS VARIABLE=homing VALUE=False\n</code></pre>"},{"location":"eddyng/","title":"Eddy NG","text":"<p>Warning</p> <p>This feature is under active development from vvuk over at https://github.com/vvuk/eddy-ng/, so there are likely to be gotchas and issues, please bare that in mind.</p>"},{"location":"eddyng/#where-can-i-get-help","title":"Where can I get help?","text":"<p>Come on over to the pellcorp discord server, the <code>#simple-af-btteddy</code> channel has been setup for anyone wanting support for btt eddy.</p> <p>https://discord.gg/2uGDzyJ3WX</p>"},{"location":"eddyng/#eddy-ng-project-support","title":"eddy-ng project support","text":"<p>https://github.com/vvuk/eddy-ng/wiki#questions-discussion-help</p>"},{"location":"eddyng/#firmware-requirements","title":"Firmware requirements","text":""},{"location":"eddyng/#limits-on-x-and-y-microsteps","title":"Limits on X and Y microsteps","text":"<p>You cannot use more than <code>microsteps: 32</code> for <code>[stepper_x]</code> and <code>[stepper_y]</code>, the MCU cannot handle high microsteps, it puts too much pressure on the mainboard and it will cause stuttering and other reliability issues including random crashes.</p> <p>Note</p> <p>This limit generally does not apply to RPi Series Simple AF</p>"},{"location":"eddyng/#k1-series","title":"K1 Series","text":"<p>This guide assumes you have a K1, K1C, K1SE or K1 Max and you are running stock creality firmware 1.3.3.5 or higher (The firmware 1.3.3.5 is much older than 1.3.3.46 for example), or alternately you can use my prerooted firmware.</p>"},{"location":"eddyng/#ender-5-max","title":"Ender 5 Max","text":"<p>This probe is currently not supported on Ender 5 Max</p>"},{"location":"eddyng/#ender-3-v3-ke","title":"Ender 3 V3 KE","text":"<p>There is experimental untested support for a Default mount on the Ender 3 V3 KE.</p>"},{"location":"eddyng/#simple-af-for-rpi","title":"Simple AF for RPi","text":"<p>See Simple AF for RPi</p>"},{"location":"eddyng/#slicer-settings","title":"Slicer Settings","text":"<p>Danger</p> <p>Creality Print won't be able to see your printer after you have installed Simple AF, the only tested slicer we all use is OrcaSlicer, likely if you want to use Creality Print you will need to print via usb.</p> <p>Cura Slicer won't work out of the box for configuring START_PRINT variables as below, you need to change the start print EXTRUDER_TEMP and BED_TEMP to pass in the correct values, but since I don't use Cura Slicer I can't advise on that!</p> <p>There is an assumption that you are using a slicer like OrcaSlicer and Machine G-code like:</p> <p></p> <p>Machine start G-code <pre><code>M140 S0\nM104 S0\nSTART_PRINT EXTRUDER_TEMP=[nozzle_temperature_initial_layer] BED_TEMP=[bed_temperature_initial_layer_single]\n</code></pre></p> <p>Machine end G-code <pre><code>END_PRINT\n</code></pre></p>"},{"location":"eddyng/#custom-bed-mesh-profile","title":"Custom Bed Mesh Profile","text":"<p>If you want to select a specific predefined bed mesh profile (which disables adaptive mesh generation), you can pass in an additional <code>START_PRINT</code> parameter:</p> <p>You can either hard code it to a particular model, like <code>BED_MESH_PROFILE=myprofile</code> or you can specify a profile based on orca slicer variables, such as <code>BED_MESH_PROFILE=\"[curr_bed_type] - [filament_type]\"</code>, but you have to make sure you have all the possible profiles defined for each of the bed type and filament type combinations.</p> <p></p>"},{"location":"eddyng/#probe-installation","title":"Probe Installation","text":"<p>It is strongly recommended to connect your probe to the front USB port initially and use it for a while that way to make sure its stable, before directly wiring it to either the mainboard or making a cable for the lidar port (K1M users only).   If possible avoid destroying the original cable when you are making your lidar or direct mainboard connection as you might need it in the future!</p> <p>Danger</p> <p>If you are not using a side mount you must verify config changes for eddyng.cfg before homing your printer, using Screws Tilt Calculate or doing a bed mesh!  </p> <p>Ignoring these instructions can lead to significant damage to your build plate and/or probe.</p>"},{"location":"eddyng/#mount-options","title":"Mount Options","text":"Mount Printer URL Notes Default K1, K1C, K1M, K1SE https://www.printables.com/model/1012524-btteddy-creality-k1-k1c-k1-max-mounthttps://www.printables.com/model/1212731-btt-eddy_ng-mount-for-creality-k1-series Pellcorp K1, K1C, K1M, K1SE https://www.printables.com/model/965667-wip-k1-btt-eddy-rear-mount-v4 Slam K1, K1C, K1M, K1SE https://www.printables.com/model/1195575-btt-eddy-mount-for-k1c Default Ender 3 V3 SE https://www.printables.com/model/1202031-ender-3-v3-se-k1-hotend-btt-eddy-mount Default Ender 3 KE https://www.printables.com/model/1002777-cr-touch-to-btt-eddy-adapter-bracket This probe and mount has not been tested on a KE running Simple AF, experimental"},{"location":"eddyng/#nozzle-offset","title":"Nozzle Offset","text":"<p>Warning</p> <p>Regardless of the mount, you should verify the btt eddy coil is at least 3mm away from the nozzle tip, its better to be further away than closer. This is not the difference of the bottom of the case to the nozzle, the case is about 1.2mm thick, so this means you want the bottom of the case to be at least 2mm offset,  its probably a good idea to look into mounts which do not use a case or a modified case with no bottom.</p> <p>You can try this tool https://www.printables.com/model/1277844-btt-eddy-and-eddy-ng-setup-helpers</p>"},{"location":"eddyng/#btt-eddy-firmware","title":"BTT Eddy Firmware","text":"<p>Warning</p> <p>It is assumed that you have flashed your eddy with the firmware from https://github.com/pellcorp/klipper/blob/master/fw/K1/btteddy.uf2 before starting the installation!!!</p> <p>For K1 Series Simple AF there is a guide</p> <p>For Simple AF for RPi, you can follow this guide https://github.com/bigtreetech/Eddy?tab=readme-ov-file#compiling-firmware.   But make sure you are not trying to use any fork of klipper than pellcorp/klipper-rpi!  You can also skip this compilation step and just copy  the <code>~/klipper/fw/k1/btteddy.uf2</code> file to the Eddy after putting it into boot mode.</p>"},{"location":"eddyng/#installation","title":"Installation","text":"<p>Warning</p> <p>The installation section does not apply to Simple AF for RPi, See Simple AF for RPi</p> <p>The installation can only be performed on a printer which has been rooted and ssh granted</p> <p>You need root access, if you are not already root, then follow the excellent Helper Script Enable Root Access instructions.</p>"},{"location":"eddyng/#factory-reset","title":"Factory Reset","text":"<p>You must do a factory reset only if you have installed Helper Script or Fluidd/Mainsail directly from Creality, otherwise you can safely proceed directly to installation.    If you have setup your printer with stock firmware only it can be quite handy to skip a factory reset so that you can use Switch to Stock</p> <pre><code>wget --no-check-certificate https://raw.githubusercontent.com/pellcorp/creality/main/k1/services/S58factoryreset -O /tmp/S58factoryreset\nchmod +x /tmp/S58factoryreset\n/tmp/S58factoryreset reset\n</code></pre> <p>Danger</p> <p>It is really important you do not close the ssh session until you get this message:</p> <p></p> <p>It can take up to 5 minutes for a factory restart to finish, it is vital you do not power cycle your printer before the stock screen appears. There may be a 3002 error on the screen, this is completely normal.   If you are planning to install Simple AF you can ignore it, if you are trying to go back to stock, power cycle the printer again to clear the error.  </p> <p>Failing to follow this advice can lead to your printer getting bricked and requiring much more involved intervention to recover!</p> <p></p>"},{"location":"eddyng/#clone-the-repo","title":"Clone the Repo","text":"<pre><code>git config --global http.sslVerify false\ngit clone https://github.com/pellcorp/creality.git /usr/data/pellcorp\n</code></pre>"},{"location":"eddyng/#run-the-installer","title":"Run the installer","text":"<p>Note</p> <p>If you have pellcorp-overrides in github but not stored locally, you need to recreate the ~/pellcorp-overrides directory before running the installer.sh!</p> <p>To run the script, you must specify the probe you want to use.</p> <pre><code>/usr/data/pellcorp/installer.sh --install eddyng --mount Mount\n</code></pre> <p>Warning</p> <p>For <code>Mount</code> you must specify the mount option for the mount you have used, if you do not do this the printer will be incorrectly configured for your mount, and bed meshes, x and y limits and related config will be wrong.   Please refer to Mount Options for supported mounts.   </p> <p>If you are using a non-supported mount you should specify a mount option as close to your mount as possible and properly adjust your configuration after installation before trying to perform a bed mesh or Screws Tilt Calculate!</p>"},{"location":"eddyng/#post-installation","title":"Post Installation","text":""},{"location":"eddyng/#mcu-firmware-updates-are-pending","title":"MCU Firmware updates are pending","text":"<p>At the end of the installer process if you get this message:</p> <pre><code>WARNING: MCU Firmware updates are pending you need to power cycle your printer!\n</code></pre> <p>It means that new MCU firmware updates need to be applied and this can only be done by power cycling the printer.  After your printer is power cycled you can verify firmware was updated with the <code>CHECK_FIRMWARE</code> macro from Fluidd or Mainsail, if you see this message:</p> <pre><code>INFO: Your MCU Firmware is up to date!\n</code></pre> <p>Your printer MCU firmware was updated successfully.   If you still see the <code>MCU Firmware updates are pending you need to power cycle your printer!</code> message after a power cycle, check the <code>/tmp/mcu_update.log</code>, you may be asked to provide this file on Discord if you need additional assistance, sometimes an additional power cycle can solve the problem, there is a very short window of time (15 seconds) in which the MCU firmware can be updated, so  there is a chance it will work after an additional power cycle.</p>"},{"location":"eddyng/#verify-usb-key","title":"Verify USB Key","text":"<p>It is important to make sure you have a way to emergency factory reset the printer, if the worst happens.   There is a macro in Simple AF called <code>CHECK_USB_KEY</code> that will wait for you to plug a USB thumb drive (aka USB key) in and tell you if it was able to be successfully mounted.</p> <p>You can find the CHECK_USB_KEY macro in Fluidd or Mainsail, because Fluidd and Mainsail are already installed, you can access Fluidd by opening your browser and connecting using http://X.X.X.X, where X.X.X.X is your ip address that you used to login via ssh to your printer, you can also access Fluidd via http://X.X.X.X:4408 and Mainsail via http://X.X.X.X:4409!</p> <p></p> <p>After running the macro you should see output like the following:</p> <p></p> <ul> <li>If you get the message: <code>INFO - USB Key was recognised and mounted correctly (/tmp/udisk/sda1)</code>, your USB thumb drive (aka USB key) is perfect to use for a factory reset.</li> <li>If you get no message at all before the script ends (after 60 seconds), your USB thumb drive (aka USB key) is defective.   You can check the <code>messages</code> file in the logs section of your UI to get more details about why the usb key could not be mounted!</li> </ul> <p>Tip</p> <p>You should verify your USB thumb drive (aka USB key) often just to make sure you have something if you need to unbrick your printer, simply type <code>CHECK_USB_KEY</code> or hit the button in Fluidd / Mainsail The USB key should be FAT32 formatted and be no larger than 32GB!</p> <p>Note</p> <p>If you have plugged your btt eddy into the front usb port, you are going to have to temporarily remove the btt eddy from the front usb slot and replace it with your USB thumb drive, after you have finished verifying the USB thumb drive can be used in an emergency, you can replace the btt eddy into the front usb slot and restart klipper or power cycle your printer.</p>"},{"location":"eddyng/#calibration","title":"Calibration","text":"<p>Warning</p> <p>The following calibration steps are required to setup a new printer:</p> <ul> <li>Probe Eddy NG Setup</li> <li>PID Tuning and Input Shaping</li> </ul>"},{"location":"eddyng/#probe-eddy-ng-setup","title":"Probe Eddy NG Setup","text":"<ol> <li>Run <code>_SET_KIN_MAX_Z</code> and then use normal controls to move the toolhead so that the nozzle is only a few mm above the bed surface</li> <li>Run the <code>STOP_CAMERA</code> macro to stop the camera</li> <li>Run <code>PROBE_EDDY_NG_SETUP</code>, Follow the Paper Test Method Upon completion <code>SAVE_CONFIG</code></li> </ol> <p>Warning</p> <p>Do not use a metal feeler gauge for this step, it could damage your eddy!!!</p> <p>Note</p> <p>Is normal to show the Z position at almost at the max height of the printer even if the nozzle is somewhere in the middle or even close to the bed, this is not a bug, its intentional.   Until this calibration step is completed, the Z axes cannot be homed, so we make the printer pretend the bed is down the bottom of the printer so that you can freely move the bed up to meet the nozzle during the paper test without running into out of range issues.  You however won't be able to move the bed further away from the nozzle more than a few mm.</p> <p></p> <p>Source: https://github.com/vvuk/eddy-ng/wiki#calibration</p> <p>Warning</p> <p>If you get errors when it comes to tapping as part of printing you may need to increase the tap drive current</p>"},{"location":"eddyng/#pid-tuning-and-input-shaping","title":"Pid Tuning and Input Shaping","text":"<p>At least PID tuning (bed and extruder) and input shaping is required for acceptable printing.  If you try and print after running the installer.sh and a power cycle but before any calibration you will most likely have horrendous quality, the worst you have ever seen on the k1.   After PID tuning and input shaping you should see the same kind of quality as you get with stock k1 + input shaper fix.</p> <p>Note</p> <p>You can use the QUICK_START Macro to complete Bed and Nozzle PID Tuning and Input Shaping Automatically.</p>"},{"location":"eddyng/#pid-tuning","title":"Pid Tuning","text":"<p>Source: Calibrate Pid Settings</p> <p>For example you might run these:</p> <pre><code>PID_CALIBRATE_BED BED_TEMP=65\nPID_CALIBRATE_HOTEND HOTEND_TEMP=230\n</code></pre> <p>Note</p> <p>The <code>PID_CALIBRATE_BED</code> and <code>PID_CALIBRATE_HOTEND</code> macros are located in the <code>useful_macros.cfg</code> file and they have defaults values for BED_TEMP and HOTEND_TEMP so you can just run them by clicking on them if you want that same temperature.</p>"},{"location":"eddyng/#input-shaping","title":"Input Shaping","text":"<p>There is no default configuration for input shaping so it is essentially disabled out of the box.</p> <p>You can use the <code>SHAPER_CALIBRATE</code> macro to run input shaping, just be sure to <code>SAVE CONFIG</code> at the end, to choose the automatically selected shaper config, be aware though that the shaper chosen might be sub-optimal due to a slight difference in vibrations between two options.  So you should probably review the output and potentially choose an alternative if it gives you higher recommended max acceleration for minimal increase in vibration.</p> <p>Input Shaper Auto Calibration</p>"},{"location":"eddyng/#axis-twist-compensation","title":"Axis Twist Compensation","text":"<p>If you are using a rear mount it is highly recommended to perform axis twist compensation, this will affect the quality of your bed mesh, so best to do it before.</p> <p>Tip</p> <p>There is no need to run axis twist compensation if you have mounted the eddy with a side mount that has a 0 y offset!</p> <ol> <li>Home All (<code>G28</code>)</li> <li>Run <code>AXIS_TWIST_COMPENSATION_CALIBRATE</code> The calibration wizard will prompt you to measure the probe Z offset at a few points along the bed    Upon completion <code>SAVE_CONFIG</code></li> </ol> <p>Source: https://www.klipper3d.org/Axis_Twist_Compensation.html</p>"},{"location":"eddyng/#first-print","title":"First Print","text":"<p>You should optimise your probe z offset using baby stepping.</p> <p>In fluidd the save button after you finish or cancel your print can be a bit hard to find, look for</p> <p></p>"},{"location":"eddyng/#other-calibrations","title":"Other Calibrations","text":"<p>Info</p> <p>The default value for pressure advance is set to <code>0.04</code></p> <p>Refer to Orcaslicer Calibration for more calibrations</p> <p>Refer to the Ellis Print Tuning Guide for more great tuning ideas.</p>"},{"location":"eddyng_troubleshooting/","title":"Troubleshooting","text":""},{"location":"eddyng_troubleshooting/#tap-failed-with-z-error-during-homing-probe","title":"Tap failed with Z: Error during homing probe","text":"<p>Sometimes the drive current for homing will work but for tap it breaks, you can calibrate another drive current and manually configure it for tap, I recommend incrementing one from homing value, so for instance of tap and homing setup have 16 as drive current, calibrate 17 as well and you can manually modify the configuration afterwards:</p> <pre><code>PROBE_EDDY_NG_CALIBRATE DRIVE_CURRENT=17\n</code></pre> <p>You can then modify the <code>#*# tap_drive_current = 16</code> to be <code>#*# tap_drive_current = 17</code> and save and restart again</p> <p>I am hopeful further work on this from the eddyng project might make this manual adjustment unnecessary!</p>"},{"location":"eddyng_troubleshooting/#mcu-protocol-error-mcu-eddy-unknown-command-debug_read","title":"MCU Protocol Error - mcu 'eddy' Unknown command: debug_read","text":"<p>If you get the following error, it means that the eddy is not connected to the printer.   This is either because its physically not connected, the wiring is wrong, the usb subsystem has disconnected the eddy during a restart or the serial id is wrong</p> <p></p> <p>So from ssh run a <code>lsusb</code> and make sure you can see:</p> <p></p> <p>If you cannot see it in <code>lsusb</code>, then it very likely means either the eddy is wired incorrectly, or if was working, it just means that an attempt to restart the eddy failed because the K1 refused to recognise it, there is no recourse except to restart the host via Fluidd / Mainsail (or power cycle the printer)</p> <p>If you can see the eddy in lsusb, then you should try to update the serial (see next)</p>"},{"location":"eddyng_troubleshooting/#manual-eddyng-serial-device-configuration","title":"Manual EddyNG Serial Device configuration","text":"<p>You can run the following command to fix your serial if you forgot to plug your btt eddy in during the installation or update:</p> <pre><code>/usr/data/pellcorp/installer.sh --fix-serial\n</code></pre> <p>Note</p> <p>If you run the above and receive an error like:</p> <pre><code>```\nroot@K1Max-AF34 /root [#] ~/pellcorp/installer.sh --fix-serial\n-sh: /root/pellcorp/installer.sh: not found\n```\n</code></pre> <p>It means you are on an older version of Simple AF and you should instead use the old style commands:</p> <pre><code>```\n/usr/data/pellcorp/k1/installer.sh --fix-serial\n```\n</code></pre>"},{"location":"emergency_factory_reset/","title":"Emergency Factory Reset","text":"<p>If the worst happens, and you somehow get locked out, perhaps for whatever reason the dropbear ssh session does not start or wifi config gets all screwy, it is still possible to trigger an emergency factory reset via USB or GrumpyScreen.</p>"},{"location":"emergency_factory_reset/#configure-wifi","title":"Configure Wifi","text":"<p>If your only problem is that you cannot get wifi to work and for whatever reason GrumpyScreen is not behaving you can brute force a new set of WIFI credentials via Configure Wifi via USB, although currently this only works for K1 Series!</p>"},{"location":"emergency_factory_reset/#via-grumpyscreen","title":"Via Grumpyscreen","text":"<p>Click the <code>Factory Reset</code> button from the Tools menu of GrumpyScreen.</p> <p>Danger</p> <p>It is vital you do not power cycle your printer before the stock screen appears. There may be a 3002 error on the screen, this is completely normal.   If you are planning to install Simple AF you can ignore it, if you are trying to go back to stock, power cycle the printer again to clear the error.  </p> <p>Failing to follow this advice can lead to your printer getting bricked and requiring much more involved intervention to recover!</p> <p></p> <p></p>"},{"location":"emergency_factory_reset/#via-usb","title":"Via USB","text":"<p>It is very easy, you just need to create a empty file called <code>emergency_factory_reset</code> on a USB key and make sure the USB key is plugged in, then power cycle the printer, this will initiate a factory reset.</p> <p>Tip</p> <p>If you are having trouble creating a file like this in windows, the easiest way is to download the emergency_factory_reset.zip and extract it onto your usb thumb drive.</p> <p>Info</p> <p>This factory reset method will rename the <code>emergency_factory_reset</code> to <code>emergency_factory_reset.old</code> to avoid a boot loop, so if you need to use this method again you will need to rename the file.</p> <p>This factory reset method will not remove the special service file <code>/etc/init.d/S58factoryreset</code> from the k1, so if you need it you can redo a factory reset even before reinstalling.</p> <p>This method does not reset wifi or root access</p> <p>Danger</p> <p>It is vital you do not power cycle your printer before the stock screen appears. There may be a 3002 error on the screen, this is completely normal.   If you are planning to install Simple AF you can ignore it, if you are trying to go back to stock, power cycle the printer again to clear the error.  </p> <p>Failing to follow this advice can lead to your printer getting bricked and requiring much more involved intervention to recover!</p> <p></p>"},{"location":"faq/","title":"Frequently Asked Questions","text":""},{"location":"faq/#can-i-use-simple-af-with-my-default-probe-load-cells","title":"Can I use Simple AF with my default probe / Load Cells?","text":"<p>There are no plans to support load cells in simple af.  The author (garethky) of the load cells code getting merged into Klipper has stated very clearly that the hardware on the K1 (specifically the bed mcu) is not sufficient to properly support the load cells (Creality cut corners with the load cells chip).  In addition because there is no scipy in the klippy python virtual environment the experience even if we somehow got it working would be suboptimal.   </p> <p>As a result of this I have abandoned any plans to support load cells as part of Simple AF for K1 series.   There is a fork of Simple AF which supports load  cells.  We have no affiliation with this project and thus cannot offer any support for using it.   In addition the fork is now 800+ commits diverged from this project and thus more recent features, fixes, etc would not be available.</p> <p>If you are interested check out https://github.com/Sekilsgs2/creality_pellcorp</p> <p>Note</p> <p>This does not mean you should remove your load cells, in fact if you get into trouble with Simple AF (for instance a probe mount gets damaged), you might  want to switch to stock and you will need the load cells hardware to do that!</p>"},{"location":"faq/#how-do-i-integrate-a-nozzle-wipe","title":"How do I integrate a Nozzle Wipe?","text":"<p>Information has been moved to Nozzle Wipe Custom Hook</p>"},{"location":"faq/#how-do-i-switch-from-btteddy-to-eddyng","title":"How do I switch from btteddy to eddyng?","text":"<p>Switching Probes</p>"},{"location":"faq/#how-do-i-switch-from-btteddy-to-cartographer","title":"How do I switch from btteddy to cartographer?","text":"<p>Switching Probes</p>"},{"location":"faq/#how-do-i-add-my-own-macros-to-simple-af","title":"How do I add my own macros to Simple AF?","text":"<p>So you cannot modify or add new macros to Simple AF cfg files, they will be erased the next time you update, what you should do instead is add your own .cfg files with your macros.</p> <p>So create a new file in the config directory, if you create the file in the config directory, Simple AF will back it up for you to the pellcorp-overrides directory where it can be automatically added to your github and will survive a factory reset.</p> <p>So first step is create a new file in the config directory via fluidd or mainsail, I am going to call my file <code>example.cfg</code></p> <p>Then just add <code>[include example.cfg]</code> to <code>printer.cfg</code>, just put it at the end of all the existing includes, save and restart and your macro should appear in the list of macro buttons.</p> <p>Note</p> <p>Its worth noting cfg in sub-directories will not be automatically backed up so best to keep them all in the main config directory.</p>"},{"location":"faq/#why-cant-i-use-force-move","title":"Why can't I use force move?","text":"<p>We disable FORCE_MOVE by default because it works on the stepper level so for multi-z users it would create havoc, and also force move does not work so well for moving x and y either, so its really not that useful. SET_KINEMATIC_POSITION is a much better choice as once you activate this you can use the normal movement buttons in fluidd and mainsail.</p> <p>So if you need to move your nozzle up from being on the bed you should run:</p> <pre><code>SET_KINEMATIC_POSITION Z=0\n</code></pre> <p>This tells the printer to pretend that the nozzle is at zero, so this allows you to move the bed down the the max height of z</p> <p>If you want move to your bed up to the nozzle you should instead do something like:</p> <pre><code>SET_KINEMATIC_POSITION Z=200\n</code></pre> <p>The reason why you cannot choose Z=0 for this scenario is you are telling the printer its at 0 z and the min position for z is -5, so this would only allow you to move the bed down 5mm, so you need to fake the printer into setting the bed to sufficient height to allow you to move it down sufficiently.</p> <p>If you were to set <code>SET_KINEMATIC_POSITION Z=100</code>, but your bed is already at the bottom of the printer there is no way to bring the bed up to meet the nozzle because it will exceed minimum position after moving 105mm.</p> <p>If you wish to restore access to force move set the <code>variable_disable_force_move: True</code> to False in <code>sensorless.cfg</code> and save and restart.</p> <p>Note</p> <p>You can use the hidden <code>_SET_KIN_MAX_Z</code> macro to set kinematic distance to allow the full range of z height, this macro is normally used for calibration to allow users to move their Cartographer, Beacon or Eddy close to the bed before calibration, but its useful for many situations.</p>"},{"location":"faq/#how-do-i-replace-line_purge-with-a-custom-line-purge","title":"How do I replace Line_Purge with a custom line purge?","text":"<p>Create a new macros file, call it something like <code>CustomMacros.cfg</code> (it matters not what its called, just as long as it is not the name of an existing file), and create your own <code>_SAF_LINE_PURGE</code> macro.</p> <p>Third step is to add a new include to <code>printer.cfg</code> for your new custom config file, and your <code>_SAF_LINE_PURGE</code> macro will be called now instead of the KAMP one.</p> <p>The reason this is recommended over just commenting out <code>LINE_PURGE</code> in <code>start_end.cfg</code> and adding your own macro call, is everything I have described above will survive an Update and even a factory reset because config overrides supports removing the <code>Line_Purge.cfg</code> include, adding a new include to <code>printer.cfg</code> and backing up your custom files. </p> <p>For more information Custom Hooks</p>"},{"location":"faq/#how-do-i-integrate-knomi","title":"How do I integrate Knomi?","text":"<p>Knomi Support</p>"},{"location":"faq/#how-can-i-change-mcu-fan-from-always-on","title":"How can I change MCU fan from always on?","text":"<p>By default Simple AF configures the main MCU fan to always be on to avoid overheating the MCU, you can instead restore it to only come on when the steppers or heaters are activated by a few tweaks to fan_control.cfg.</p> <p>So disable this:</p> <pre><code>[static_digital_output mcu_fan_always_on]\npins:PB2\n</code></pre> <p>Enable this:</p> <pre><code>[controller_fan mcu]\npin: PB2\ntachometer_pin: ^PC6\nheater: extruder, heater_bed\nstepper: stepper_x, stepper_y, stepper_z\nidle_timeout: 90\n</code></pre> <p>You also have the option of making the MCU fan purely temp based, however there is a risk if the temp sensor on the MCU is a bit dodgy the fan might not startup early enough to avoid damage or weird behaviour from the MCU and other components, I strongly recommend leaving the MCU fan to always be on</p> <p>But if you want to, something like this might work:</p> <p>So disable this:</p> <pre><code>[static_digital_output mcu_fan_always_on]\npins:PB2\n</code></pre> <p>And add this config:</p> <pre><code># thanks to Habitural from discord\n[temperature_fan _mcu_fan]\npin: PB2\nkick_start_time: 0.8\noff_below: 0.1\n#max_power 1.0\nsensor_type: temperature_mcu\ncontrol: pid\nmin_temp: 0\nmax_temp: 80\npid_kp: 1.0\npid_ki: 0.5\npid_kd: 2.0\nmin_speed: 0.1\nmax_speed: 0.8\ntarget_temp: 38\n</code></pre> <p>You may need to add <code>ADC_TEMPERATURE</code> to the <code>[duplicate_pin_override]</code> section if using this last option.</p> <p>Note config overrides should retain these config changes as long as you do them in the fan_control.cfg file (special handling for that file allows adding and removing whole sections)</p>"},{"location":"faq/#how-do-i-get-the-printer-to-lower-the-bed-at-the-end-of-a-print","title":"How do I get the printer to lower the bed at the end of a print?","text":"<p>This is just a configuration change to the <code>start_end.cfg</code> <code>_CLIENT_VARIABLE</code> <code>variable_custom_park_dz</code> value, you change the value from 25.0 to 50.0 or whatever you want.   If you print a really tall print the bed will be lowered as much room as there is left without exceeding the stepper_z max_position.</p>"},{"location":"faq/#how-do-i-switch-default-ui-from-fluidd-to-mainsail-and-back","title":"How do I switch default UI from fluidd to mainsail and back?","text":"<p>To switch to mainsail:</p> <pre><code>~/pellcorp/tools/switch-default-ui.sh mainsail\n</code></pre> <p>To switch back to fluidd:</p> <pre><code>~/pellcorp/tools/switch-default-ui.sh fluidd\n</code></pre> <p>This change will survive updating Simple AF, but will not be retained for a reinstall or a factory reset. </p> <p>Note</p> <p>If you run the above and receive an error like:</p> <pre><code>```\nroot@K1Max-AF34 /root [#] ~/pellcorp/tools/switch-default-ui.sh mainsail\n-sh: /root/pellcorp/tools/switch-default-ui.sh: not found\n```\n</code></pre> <p>It means you are on an older version of Simple AF and you should instead use the old style commands:</p> <pre><code>```\n/usr/data/pellcorp/k1/installer.sh --branch main\n~/pellcorp/tools/switch-default-ui.sh mainsail\n```\n</code></pre>"},{"location":"faq/#how-do-i-change-the-hostname","title":"How do I change the hostname?","text":"<p>You can update the /etc/hostname with the new hostname from ssh like this:</p> <pre><code>echo \"myhostname\" &gt; /etc/hostname\n</code></pre> <p>Next time you power cycle your printer, the hostname should be updated</p>"},{"location":"faq/#how-to-install-happy-hare-on-simple-af","title":"How to install Happy Hare on Simple AF?","text":"<p>Note</p> <p>This does not apply to Simple AF for RPi</p> <p>The default installer needs to be executed with some different arguments</p> <p>So first of all clone the repo:</p> <pre><code>git clone https://github.com/moggieuk/Happy-Hare.git /usr/data/Happy-Hare\n</code></pre> <p>Then run the installer:</p> <pre><code>cd /usr/data/Happy-Hare\n./install.sh -k /usr/data/klipper -c /usr/data/printer_data/config -z -m /usr/data/moonraker\nsystemctl restart moonraker\nsystemctl restart klipper\n</code></pre>"},{"location":"faq/#how-do-i-enable-moonraker-timelapses","title":"How do I enable moonraker timelapses?","text":"<p>Enable Moonraker Timelapse</p>"},{"location":"faq/#where-can-i-find-stock-configuration-files","title":"Where can I find stock configuration files?","text":"<p>So Guilouz who created Helper Script hosts the latest version of the K1 / K1M / K1C firmware on his website, you can find the stock config files in his repo: https://github.com/Guilouz/Creality-K1-Extracted-Firmwares/tree/main/Firmware/usr/share/klipper/config</p> <p>I am also starting to collect some squashfs (decrypted) for various firmware as well at https://github.com/pellcorp/downloads/tree/main/creality/firmware</p>"},{"location":"faq/#how-do-i-setup-remote-access-and-ai-failure-detection","title":"How do I setup remote access and AI failure detection?","text":"<p>Octoeverywhere Companion</p>"},{"location":"faq/#how-to-read-belt-shaper-graphs","title":"How to read belt shaper graphs?","text":"<p>Take a look at this video recommended by @EAZY https://www.youtube.com/watch?v=zfnWsBOt3_8</p>"},{"location":"faq/#how-can-i-make-sure-my-bed-is-level-trammed","title":"How can I make sure my bed is level / trammed?","text":"<p>ZeroDotCmd created a great video on the subject of teeth skipping with a few options for how to do it https://youtu.be/S2d_9Ysz-Q8</p> <p>Note this is not about bed mesh, this video is just about getting your bed level enough for bed mesh to be effective.</p>"},{"location":"faq/#how-to-enable-github-backups-for-my-configuration","title":"How to enable Github backups for my configuration?","text":"<p>Backup Config Overrides</p>"},{"location":"faq/#how-can-i-wait-for-chamber-temp","title":"How can I wait for chamber temp?","text":"<p>Orca Slicer has the ability to define a chamber target temp per filament and if you want Simple AF to wait on that chamber temp before actually trying to print we can with a bit of work in both Orca Slicer and Simple AF via Custom hooks.</p> <p>Step 1 - Define per filament any requirement for a chamber temp, look Print chamber temperature for:</p> <p></p> <p>Set a value in celcius, but do NOT check the Activate temperature control checkbox.</p> <p>Step 2 - Add <code>CHAMBER_TEMP={chamber_temperature[0]}</code> to Machine Gcode Start Print:</p> <p></p> <p>Step 3 - Define a <code>_SAF_START_PRINT_BEFORE_LINE_PURGE</code> custom hook, something like this would work:</p> <pre><code>[gcode_macro _SAF_START_PRINT_BEFORE_LINE_PURGE]\ngcode:\n    {% set CHAMBER_TEMP=params.CHAMBER_TEMP|default(0)|float %}\n    {% if CHAMBER_TEMP &gt; 0 %}\n        RESPOND TYPE=command MSG=\"Waiting chamber to reach {CHAMBER_TEMP}c ...\"\n        TEMPERATURE_WAIT SENSOR=\"temperature_sensor chamber_temp\" MINIMUM={CHAMBER_TEMP}\n        RESPOND TYPE=command MSG=\"Chamber target temperature reached: {CHAMBER_TEMP}\u00b0C\"\n    {% endif %}\n</code></pre>"},{"location":"faq/#how-can-i-set-a-chamber-fan-target-temp-from-my-slicer","title":"How can I set a chamber fan target temp from my slicer?","text":"<p>There is no way to pass in a parameter to start print for this, but there is a really easy workaround and you can even set the target per filament.   The target being the temp at which the fan gets activated.</p> <p>So per filament in Orca Slicer find the Print chamber temperature and set a value in celcius, but do NOT check the Activate temperature control checkbox.</p> <p></p> <p>Then in your Machine start Gcode above START_PRINT add this line (before the START_PRINT line):</p> <pre><code>M141 S{chamber_temperature[0]}\n</code></pre> <p>The M141 macro provided by Simple AF (derived from Helper Script) sets the target of the chamber fan via this macro.</p> <p> </p>"},{"location":"faq/#how-do-i-cleanup-all-those-backup-printer-config-files","title":"How do I cleanup all those backup printer config files?","text":"<p>Note</p> <p>This does not apply to Simple AF for RPi</p> <p>Simple AF runs a cleanup every time the printer starts it does the following:</p> <ul> <li>Deletes all log files older than 7 days (excluding moonraker.log, klippy.log and guppyscreen.log), if all log files are older than 7 days, it will leave the the newest old file intact</li> <li>Deletes all backup tar.gz files older than 7 days, if all backup .tar.gz files are older than 7 days, it will leave the newest intact</li> <li>If there is less than 1GB of space left on /usr/data it will remove all gcode files older than 7 days</li> </ul> <p>You can also run this script manually via the hidden macro _CLEANUP_FILES</p>"},{"location":"faq/#what-is-bed-warp-stabilisation-and-why-is-it-good","title":"What is bed warp stabilisation and why is it good?","text":"<p>An excellent video from need it make if for why heat soaking is absolutely vital for optimal bed mesh https://youtu.be/8PEsPLDxt-c</p> <p>In Simple AF out of the box when you start a print a period of bed warp stabilisation is performed.   The default macro will wait 8 seconds for every degree of target bed temp.</p> <p>This is also often referred to as heat soak and it allows the heated bed to settle into its final state before performing the bed mesh.</p> <p>You can disable it before a print by toggling the bed warp stabilisation toggle, which you can find in the fans and outputs section of your UI.</p> <p>In Fluidd its here:</p> <p></p> <p>In Mainsail its here: </p> <p></p> <p>You can disable it permanently by changing the <code>start_end.cfg</code> <code>[output_pin Bed_Warp_Stabilisation]</code> value to 0.</p> <p>You can also modify the following configuration in <code>_START_END_PARAMS</code>:</p> <ul> <li><code>variable_bed_warp_wait_multiplier</code>  - So this value is how many seconds per degree of final bed target temp.</li> <li><code>variable_bed_warp_fraction_wait</code> - If the bed temp is at least 75% of target we will do partial heat soak, if it's less than 75% will heat soak then entire target amount.</li> <li><code>variable_bed_warp_wait_interval</code> - This is how long the macro will sleep between notifications</li> </ul> <p>Warning</p> <p>Please note at the end of a print the heater of the bed will remain heated until the printer times out in a hour.</p> <p>If you want to use bed warp stabilisation but not keep the heater on at end, you can change the <code>start_end.cfg</code> <code>_START_END_PARAMS</code> <code>variable_end_print_keep_bed_heated</code> to <code>False</code>!</p> <p>For some probes like the eddy (so for <code>btteddy</code> or <code>eddyng</code>) sitting just above the heated bed for an extended period of time can cause it to be excessively heated, there is a <code>start_end.cfg</code> property <code>variable_start_print_bed_heating_move_bed_distance</code> which can be set to something like <code>100</code> to position the toolhead much further away from the bed while the bed heats, the default value of 20mm might not be sufficient for your use case.</p>"},{"location":"faq/#how-do-i-use-my-cartographer-for-input-shaping","title":"How do I use my cartographer for input shaping?","text":"<p>Cartographer Input Shaper</p>"},{"location":"faq/#how-can-i-downgrade-from-cfs-firmware","title":"How can I downgrade from CFS Firmware?","text":"<p>Creality added logic to prevent downgrading to older version of firmware, but its super easy to work around this, we just need to download an older <code>local_ota_update.sh file</code>, I have saved the 1.3.3.46 version of the script to my downloads repo to make it easier to get.</p> <p>So first of all go and grab the version of the older K1 firmware you want from https://www.creality.com/pages/download-k1-flagship, save it to a USB key, and stick it into the front of your printer!</p> <p>Now login via ssh to your printer</p> <p>From the ssh command line on your printer download the older <code>local_ota_update.sh</code> script like so:</p> <pre><code>wget https://raw.githubusercontent.com/Guilouz/Creality-K1-Extracted-Firmwares/refs/heads/main/Firmware/etc/ota_bin/local_ota_update.sh -O - &gt; /usr/data/local_ota_update.sh\nchmod 777 /usr/data/local_ota_update.sh\n</code></pre> <p>Now you can flash new firmware with this script without the version downgrade logic getting in the way:</p> <pre><code>/usr/data/local_ota_update.sh /tmp/udisk/sda1/CR4CU220812S11_ota_img_V1.3.3.46.img\n</code></pre> <p>You should wait until you see lines like the following especially <code>ota update ok</code>:</p> <pre><code>rootfs.squashfs read ok, now quit\nota: data processed: 99% 127696896 132233080\nrootfs update done\nstart update rtos\nzero.bin read ok, now quit\nota: data processed: 100% 452408 132233080\nrtos update done\nota update ok\n256+0 records in\n256+0 records out\nota: stoped success\n</code></pre> <p>Then you can logout of your ssh session and power cycle your printer.   It is a good idea to factory reset your printer just to be sure all remnants of the CFS abomination has been excised!</p> <p>Note</p> <p>If you get the error <code>-sh: /usr/data/local_ota_update.sh: Permission denied</code>, you forgot to do <code>chmod 777 /usr/data/local_ota_update.sh</code></p> <p>If you get the error <code>/tmp/udisk/sda1/CR4CU220812S11_ota_img_V1.3.3.46.img Not a file</code> it means either you did not download the latest img or else for some reason the usb key was mounted to somewhere different than <code>/tmp/udisk/sda1/</code></p> <p>You can check which directory the usb was mounted with the following command:</p> <pre><code>mount | grep 'sda'\n</code></pre> <p>For example for my USB key its not mounted to <code>/tmp/udisk/sda1</code>, instead its mounted to <code>/tmp/udisk/sda</code>:</p> <p></p> <p>So I would need to specify instead: </p> <pre><code>/usr/data/local_ota_update.sh /tmp/udisk/sda/CR4CU220812S11_ota_img_V1.3.3.46.img\n</code></pre>"},{"location":"faq/#how-can-i-prevent-a-print-starting-or-resuming-if-there-is-no-filament-present","title":"How can I prevent a print starting or resuming if there is no filament present?","text":"<p>A new feature has just been merged to Simple AF to support this, but you will need a normal filament sensor switch, update to latest Simple AF and enable a setting after installation.</p> <p>You need to update to latest Simple AF:</p> <pre><code>~/pellcorp/installer.sh --branch main\n~/pellcorp/installer.sh --update\n</code></pre> <p>Note</p> <p>If you run the above and receive an error like:</p> <pre><code>```\nroot@K1Max-AF34 /root [#] ~/pellcorp/installer.sh --branch main\n-sh: /root/pellcorp/installer.sh: not found\n```\n</code></pre> <p>It means you are on an older version of Simple AF and you should instead use the old style commands:</p> <pre><code>```\n/usr/data/pellcorp/k1/installer.sh --branch main\n~/pellcorp/installer.sh --update\n```\n</code></pre> <p>Then open the <code>start_end.cfg</code>, find the <code>variable_runout_sensor</code> in the <code>_CLIENT_VARIABLE</code> section and set it to match your filament runout sensor, like so:</p> <pre><code>variable_runout_sensor: \"filament_switch_sensor filament_sensor\"\n</code></pre> <p>Tip</p> <p>The runout sensor you specify in the <code>variable_runout_sensor</code> configuration must match exactly your configuration, so for instance if you switch to a toolhead sensor you might have configured it as <code>[filament_switch_sensor toolhead_sensor]</code> in which case you must change the configuration to <code>variable_runout_sensor: \"filament_switch_sensor toolhead_sensor\"</code> </p> <p>Save and Restart</p> <p>Then when you try to start a print without filament you will get a message like:</p> <p></p>"},{"location":"faq/#how-can-i-switch-to-a-toolhead-filament-runout-sensor","title":"How can I switch to a toolhead filament runout sensor?","text":"<p>So if you are using the DXC extruder, Creality CFS Extruder, or even the Henlor Mod for the stock Extruder, you want to switch from using the runout sensor bolted to the printer case and use the extruder runout sensor on the toolhead, its really easy, its literally just a single config change in your printer.cfg.</p> <p>So find the <code>[filament_switch_sensor filament_sensor]</code> and change:</p> <p>From: <code>switch_pin: !PC15</code></p> <p>To: <code>switch_pin: !nozzle_mcu:PA10</code></p> <p>It should look something like this (there may be <code>event_delay</code> and <code>pause_delay</code> which should be left alone):</p> <pre><code>[filament_switch_sensor filament_sensor]\npause_on_runout: false\nswitch_pin: !nozzle_mcu:PA10\nrunout_gcode: _ON_FILAMENT_RUNOUT\n</code></pre> <p>Save and Restart and enjoy!</p> <p>Danger</p> <p>Do not define two filament_switch_sensor that both _ON_FILAMENT_RUNOUT for <code>runout_gcode</code>, the installer will  remove the <code>[filament_switch_sensor filament_sensor_2]</code>, do not restore this config!</p> <p>Please also note that on more recent versions of Simple AF the <code>pause_on_runout</code> value is set to false, because we trigger <code>PAUSE</code> from the _ON_FILAMENT_RUNOUT macro now to avoid phantom triggers of pause when changing filament!</p>"},{"location":"faq/#what-is-axis-twist","title":"What is Axis Twist?","text":"<p>So ZeroDotCmd has done some great videos on this topic https://www.youtube.com/watch?v=O_U8t5Ap0Ik and https://www.youtube.com/watch?v=1KVTRDim1lk</p> <p>More details here: https://www.klipper3d.org/Axis_Twist_Compensation.html</p>"},{"location":"faq/#how-do-i-get-the-bed-to-cooldown-after-a-print-finishes","title":"How do I get the bed to cooldown after a print finishes?","text":"<p>So by default with Bed Warp stabilisation enabled, the bed will stay warm after a print for up to 1 hour (this can be changed too btw), if you do not want the bed to stay warm after a print you can either toggle the bed warp stabililation toggle in fluidd or mainsail before END_PRINT runs or you can modify the  <code>start_end.cfg</code> <code>variable_end_print_cool_down</code> and change it to <code>False</code>, so it should then look like:</p> <pre><code>variable_end_print_cool_down: False\n</code></pre>"},{"location":"faq/#can-i-have-more-than-one-camera-on-simple-af","title":"Can I have more than one camera on Simple AF","text":"<p>For Simple AF for RPi yes thats fine and you can do that via crowsnest, but for K1 Series (which includes K1, K1M, K1SE, K1C, Ender 5 Max and Ender 3 V3 KE), that is not possible, for more information see Additional Camera</p>"},{"location":"faq/#get-fluidd-to-restart-klipper-for-save-and-restart","title":"Get Fluidd to restart Klipper for Save and Restart","text":"<p>Fluidd actually has a feature to switch from asking Klipper to restart itself to getting Moonraker to restart the Klipper service itself, this can be a useful change to make because in my experience restarting klipper results in less disconnections of eddy probes like Cartographer, Beacon or Eddy and takes about the same amount of time.</p> <p></p>"},{"location":"faq/#how-can-i-configure-the-timezone","title":"How can I configure the timezone","text":"<p>The <code>/etc/init.d/S58factoryreset</code> has recently been updated not to delete the <code>/etc/localtime</code>, so you can configure it once and it should survive any number of factory resets, following the excellent guide here:</p> <p>https://guilouz.github.io/Creality-Helper-Script-Wiki/firmwares/change-date-and-time/</p>"},{"location":"grumpyscreen/","title":"GrumpyScreen","text":"<p>GrumpyScreen is our fork of the wonderful GuppyScreen from ballaswag that we have continually refined and enhanced to be tightly integrated with Simple AF, although it's also possible to run this on Helper Script too.</p> <p>The source for GrumpyScreen can be found at https://github.com/pellcorp/grumpyscreen</p>"},{"location":"grumpyscreen/#configuration","title":"Configuration","text":"<p>Recently we migrated to a klipper style config file which you can edit directly from the config directory in fluidd or mainsail, look for the file <code>grumpyscreen.ini</code>, now that its a flat file, config overrides will be fully supported for retaining all your customisations including custom fans, leds, monitored sensors etc.</p>"},{"location":"grumpyscreen/#grumpyscreen-factory-reset","title":"Grumpyscreen Factory Reset","text":"<p>See Factory Reset</p>"},{"location":"grumpyscreen/#grumpyscreen-for-helper-script","title":"GrumpyScreen for Helper Script","text":"<p>I have added experimental support for installing GrumpyScreen onto Helper Script printers, currently only K1, K1C, K1SE and K1M are supported.</p> <p>First of all clone the Simple AF repo:</p> <pre><code>git clone https://github.com/pellcorp/creality.git /usr/data/pellcorp\n</code></pre> <p>Then run the helperscript grumpyscreen installer:</p> <pre><code>/usr/data/pellcorp/helperscript/install-grumpyscreen.sh\n</code></pre> <p>Note</p> <p>GrumpyScreen requires two macros _GUPPYSCREEN_EXTRUDE and _GUPPYSCREEN_EXTRUDE.  As part of the installation, a <code>grumpy-macros.cfg</code> with these macros is copied into <code>/usr/data/printer_data/config/GuppyScreen/</code>, so the macros should have been imported by the existing <code>[include GuppyScreen/*.cfg]</code>  include added by Helper Script.</p> <p>The installer will replace the existing guppyscreen binary and configuration file, you can update GrumpyScreen via the screen only, the Helper Script <code>GUPPY_UPDATE</code>  macro has been removed as it breaks grumpyscreen.</p> <p>Like for Simple AF, the installer will copy the <code>guppyscreen.ini</code> to the config directory so you can customise it and restart GrumpyScreen for changes to be applied. </p> <p>If you want to revert to normal guppyscreen just uninstall and reinstall from Helper Script, I do not provide a script to do this automatically!</p> <p>Please note that GrumpyScreen is a vastly simplified version of Guppyscreen:</p> <ul> <li>No Gcode execution</li> <li>No Belts &amp; Shake</li> <li>No Input Shaper</li> <li>No Bed Mesh</li> <li>No TMC Metrics</li> <li>No Tuning (other than during a print)</li> <li>No Limits</li> <li>No Power Devices (wtf that is)</li> </ul> <p>We focus on polishing a subset of features and we added some additional ones:</p> <ul> <li>Factory Reset</li> <li>E-Stop on more screens</li> <li>Setting chamber temp targets</li> </ul> <p>The Belt Shaper calibration macros from GuppyScreen remain and can be executed from fluidd or mainsail</p>"},{"location":"klicky/","title":"Klicky","text":""},{"location":"klicky/#where-can-i-get-help","title":"Where can I get help?","text":"<p>Danger</p> <p>Getting the klicky setup correctly takes time and patience to ensure you do not damage your printer or the klicky, also when doing operations like homing and bed meshes and the like you should never leave your printer unattended in case docking or attaching fails for some reason.</p> <p>Come on over to the pellcorp discord server, here is the invite, the <code>#simple-af-klicky</code> channel has been setup for anyone wanting support for klicky.</p> <p>https://discord.gg/2uGDzyJ3WX</p>"},{"location":"klicky/#firmware-requirements","title":"Firmware requirements","text":""},{"location":"klicky/#limits-on-x-and-y-microsteps","title":"Limits on X and Y microsteps","text":"<p>You cannot use more than <code>microsteps: 64</code> for <code>[stepper_x]</code> and <code>[stepper_y]</code>, the MCU cannot handle high microsteps, it puts too much pressure on the mainboard and it will cause stuttering and other reliability issues including random crashes.</p> <p>Note</p> <p>This limit generally does not apply to RPi Series Simple AF</p>"},{"location":"klicky/#k1-series","title":"K1 Series","text":"<p>This guide assumes you have a K1, K1C, K1SE or K1 Max and you are running stock creality firmware 1.3.3.5 or higher (The firmware 1.3.3.5 is much older than 1.3.3.46 for example), or alternately you can use my prerooted firmware.</p>"},{"location":"klicky/#ender-5-max","title":"Ender 5 Max","text":"<p>This probe is currently not supported on Ender 5 Max</p>"},{"location":"klicky/#ender-3-v3-ke","title":"Ender 3 V3 KE","text":"<p>This probe is currently not supported on Ender 3 V3 KE</p>"},{"location":"klicky/#simple-af-for-rpi","title":"Simple AF for RPi","text":"<p>See Simple AF for RPi</p>"},{"location":"klicky/#slicer-settings","title":"Slicer Settings","text":"<p>Danger</p> <p>Creality Print won't be able to see your printer after you have installed Simple AF, the only tested slicer we all use is OrcaSlicer, likely if you want to use Creality Print you will need to print via usb.</p> <p>Cura Slicer won't work out of the box for configuring START_PRINT variables as below, you need to change the start print EXTRUDER_TEMP and BED_TEMP to pass in the correct values, but since I don't use Cura Slicer I can't advise on that!</p> <p>There is an assumption that you are using a slicer like OrcaSlicer and Machine G-code like:</p> <p></p> <p>Machine start G-code <pre><code>M140 S0\nM104 S0\nSTART_PRINT EXTRUDER_TEMP=[nozzle_temperature_initial_layer] BED_TEMP=[bed_temperature_initial_layer_single]\n</code></pre></p> <p>Machine end G-code <pre><code>END_PRINT\n</code></pre></p>"},{"location":"klicky/#custom-bed-mesh-profile","title":"Custom Bed Mesh Profile","text":"<p>If you want to select a specific predefined bed mesh profile (which disables adaptive mesh generation), you can pass in an additional <code>START_PRINT</code> parameter:</p> <p>You can either hard code it to a particular model, like <code>BED_MESH_PROFILE=myprofile</code> or you can specify a profile based on orca slicer variables, such as <code>BED_MESH_PROFILE=\"[curr_bed_type] - [filament_type]\"</code>, but you have to make sure you have all the possible profiles defined for each of the bed type and filament type combinations.</p> <p></p>"},{"location":"klicky/#probe-installation","title":"Probe Installation","text":"<p>All probe mount options assume you have purchased a PCB Klicky:</p> <ul> <li>https://www.aliexpress.com/item/1005005023158174.html</li> </ul>"},{"location":"klicky/#mount-options","title":"Mount Options","text":""},{"location":"klicky/#default","title":"Default","text":"<p>Warning</p> <p>This klicky dock is for the stock gantry only, it is highly unlikely to work with any other gantry, the dock would need to be remixed for that!</p> <p>The models can be downloaded from https://www.printables.com/model/1170906-klicky-pcb-probe-for-creality-k1, but the instructions for wiring and the macros are not relevant and the wiring shown is a bit misleading, so just the models from printables nothing else.   Don't forget the 1mm spacer on the toolhead otherwise the klicky does not properly line up when attached.</p> <p>This mount should work for K1/K1C/K1SE and K1M, but only K1 and K1M variants have actually been tested.</p>"},{"location":"klicky/#installation","title":"Installation","text":"<p>Warning</p> <p>The installation section does not apply to Simple AF for RPi, See Simple AF for RPi</p> <p>The installation can only be performed on a printer which has been rooted and ssh granted</p> <p>You need root access, if you are not already root, then follow the excellent Helper Script Enable Root Access instructions.</p>"},{"location":"klicky/#factory-reset","title":"Factory Reset","text":"<p>You must do a factory reset only if you have installed Helper Script or Fluidd/Mainsail directly from Creality, otherwise you can safely proceed directly to installation.    If you have setup your printer with stock firmware only it can be quite handy to skip a factory reset so that you can use Switch to Stock</p> <pre><code>wget --no-check-certificate https://raw.githubusercontent.com/pellcorp/creality/main/k1/services/S58factoryreset -O /tmp/S58factoryreset\nchmod +x /tmp/S58factoryreset\n/tmp/S58factoryreset reset\n</code></pre> <p>Danger</p> <p>It is really important you do not close the ssh session until you get this message:</p> <p></p> <p>It can take up to 5 minutes for a factory restart to finish, it is vital you do not power cycle your printer before the stock screen appears. There may be a 3002 error on the screen, this is completely normal.   If you are planning to install Simple AF you can ignore it, if you are trying to go back to stock, power cycle the printer again to clear the error.  </p> <p>Failing to follow this advice can lead to your printer getting bricked and requiring much more involved intervention to recover!</p> <p></p>"},{"location":"klicky/#clone-the-repo","title":"Clone the Repo","text":"<pre><code>git config --global http.sslVerify false\ngit clone https://github.com/pellcorp/creality.git /usr/data/pellcorp\n</code></pre>"},{"location":"klicky/#run-the-installer","title":"Run the installer","text":"<p>Note</p> <p>If you have pellcorp-overrides in github but not stored locally, you need to recreate the ~/pellcorp-overrides directory before running the installer.sh!</p> <p>To run the script, you must specify the probe you want to use.</p> <pre><code>/usr/data/pellcorp/installer.sh --install klicky --mount Mount\n</code></pre> <p>Warning</p> <p>For <code>Mount</code> you must specify the mount option for the mount you have used, if you do not do this the printer will be incorrectly configured for your mount and dock location, and bed meshes, x and y limits and related config will be wrong.   Please refer to Mount Options for supported mounts.   </p> <p>If you are using a non-supported mount you should specify a mount option as close to your mount as possible and properly adjust your configuration after installation before trying to perform a bed mesh or Screws Tilt Calculate!</p>"},{"location":"klicky/#post-installation","title":"Post Installation","text":""},{"location":"klicky/#mcu-firmware-updates-are-pending","title":"MCU Firmware updates are pending","text":"<p>At the end of the installer process if you get this message:</p> <pre><code>WARNING: MCU Firmware updates are pending you need to power cycle your printer!\n</code></pre> <p>It means that new MCU firmware updates need to be applied and this can only be done by power cycling the printer.  After your printer is power cycled you can verify firmware was updated with the <code>CHECK_FIRMWARE</code> macro from Fluidd or Mainsail, if you see this message:</p> <pre><code>INFO: Your MCU Firmware is up to date!\n</code></pre> <p>Your printer MCU firmware was updated successfully.   If you still see the <code>MCU Firmware updates are pending you need to power cycle your printer!</code> message after a power cycle, check the <code>/tmp/mcu_update.log</code>, you may be asked to provide this file on Discord if you need additional assistance, sometimes an additional power cycle can solve the problem, there is a very short window of time (15 seconds) in which the MCU firmware can be updated, so  there is a chance it will work after an additional power cycle.</p>"},{"location":"klicky/#verify-usb-key","title":"Verify USB Key","text":"<p>It is important to make sure you have a way to emergency factory reset the printer, if the worst happens.   There is a macro in Simple AF called <code>CHECK_USB_KEY</code> that will wait for you to plug a USB thumb drive (aka USB key) in and tell you if it was able to be successfully mounted.</p> <p>You can find the CHECK_USB_KEY macro in Fluidd or Mainsail, because Fluidd and Mainsail are already installed, you can access Fluidd by opening your browser and connecting using http://X.X.X.X, where X.X.X.X is your ip address that you used to login via ssh to your printer, you can also access Fluidd via http://X.X.X.X:4408 and Mainsail via http://X.X.X.X:4409!</p> <p></p> <p>After running the macro you should see output like the following:</p> <p></p> <ul> <li>If you get the message: <code>INFO - USB Key was recognised and mounted correctly (/tmp/udisk/sda1)</code>, your USB thumb drive (aka USB key) is perfect to use for a factory reset.</li> <li>If you get no message at all before the script ends (after 60 seconds), your USB thumb drive (aka USB key) is defective.   You can check the <code>messages</code> file in the logs section of your UI to get more details about why the usb key could not be mounted!</li> </ul> <p>Tip</p> <p>You should verify your USB thumb drive (aka USB key) often just to make sure you have something if you need to unbrick your printer, simply type <code>CHECK_USB_KEY</code> or hit the button in Fluidd / Mainsail The USB key should be FAT32 formatted and be no larger than 32GB!</p>"},{"location":"klicky/#docking","title":"Docking","text":"<p>Getting docking working if you are not using the <code>Default</code> mount or you have positioned the dock somewhere other than the rear left stepper motor is left as an exercise for each user. Out of the box automatic docking is disabled for a new installation of Simple AF, you should verify the dock coordinates in the <code>klicky_macro.cfg</code> are correct, and you can then flip the <code>variable_auto_docking</code> to <code>True</code>, save and restart and klicky will auto attach and dock for homing, bed meshing and start print.</p>"},{"location":"klicky/#verifying-probe","title":"Verifying Probe","text":"<p>It's really important to verify that the klicky actually will work as an endstop for homing, so initiate homing and then use your finger to activate the microswitch on the bottom of the klicky and make sure homing stops, if it does not stop you need to immediately use the e-stop button in your UI or Grumpyscreen or hit that power button </p>"},{"location":"klicky/#timer-too-close-and-microsteps","title":"Timer too close and microsteps","text":"<p>For microprobe, etc you cannot use more than <code>microsteps: 64</code>.</p>"},{"location":"klicky/#calibration","title":"Calibration","text":"<p>Warning</p> <p>The following calibration steps are required to setup a new printer:</p> <ul> <li>Probe Calibrate</li> <li>PID Tuning and Input Shaping</li> </ul>"},{"location":"klicky/#probe-calibrate","title":"Probe Calibrate","text":"<ol> <li>Home All (<code>G28</code>)</li> <li>Make sure nozzle is centred on bed</li> <li>Run <code>PROBE_CALIBRATE</code></li> <li>Manually remove klicky probe and put it into the dock</li> <li>Follow the Paper Test Method Upon completion <code>SAVE_CONFIG</code></li> </ol>"},{"location":"klicky/#pid-tuning-and-input-shaping","title":"Pid Tuning and Input Shaping","text":"<p>At least PID tuning (bed and extruder) and input shaping is required for acceptable printing.  If you try and print after running the installer.sh and a power cycle but before any calibration you will most likely have horrendous quality, the worst you have ever seen on the k1.   After PID tuning and input shaping you should see the same kind of quality as you get with stock k1 + input shaper fix.</p> <p>Note</p> <p>You can use the QUICK_START Macro to complete Bed and Nozzle PID Tuning and Input Shaping Automatically.</p>"},{"location":"klicky/#pid-tuning","title":"Pid Tuning","text":"<p>Source: Calibrate Pid Settings</p> <p>For example you might run these:</p> <pre><code>PID_CALIBRATE_BED BED_TEMP=65\nPID_CALIBRATE_HOTEND HOTEND_TEMP=230\n</code></pre> <p>Note</p> <p>The <code>PID_CALIBRATE_BED</code> and <code>PID_CALIBRATE_HOTEND</code> macros are located in the <code>useful_macros.cfg</code> file and they have defaults values for BED_TEMP and HOTEND_TEMP so you can just run them by clicking on them if you want that same temperature.</p>"},{"location":"klicky/#input-shaping","title":"Input Shaping","text":"<p>There is no default configuration for input shaping so it is essentially disabled out of the box.</p> <p>You can use the <code>SHAPER_CALIBRATE</code> macro to run input shaping, just be sure to <code>SAVE CONFIG</code> at the end, to choose the automatically selected shaper config, be aware though that the shaper chosen might be sub-optimal due to a slight difference in vibrations between two options.  So you should probably review the output and potentially choose an alternative if it gives you higher recommended max acceleration for minimal increase in vibration.</p> <p>Input Shaper Auto Calibration</p>"},{"location":"klicky/#axis-twist-compensation","title":"Axis Twist Compensation","text":"<p>It is highly recommended to perform axis twist compensation, this will affect the quality of your bed mesh, so best to do it before.</p> <p>Tip</p> <p>There is no need to run axis twist compensation if you have mounted the eddy with a side mount that has a 0 y offset!</p> <ol> <li>Home All (<code>G28</code>)</li> <li>Run <code>AXIS_TWIST_COMPENSATION_CALIBRATE</code> The calibration wizard will prompt you to measure the probe Z offset at a few points along the bed    Upon completion <code>SAVE_CONFIG</code></li> </ol> <p>Source: https://www.klipper3d.org/Axis_Twist_Compensation.html</p>"},{"location":"klicky/#first-print","title":"First Print","text":"<p>You should optimise your probe z offset using baby stepping.</p> <p>In fluidd the save button after you finish or cancel your print can be a bit hard to find, look for</p> <p></p>"},{"location":"klicky/#other-calibrations","title":"Other Calibrations","text":"<p>Info</p> <p>The default value for pressure advance is set to <code>0.04</code></p> <p>Refer to Orcaslicer Calibration for more calibrations</p> <p>Refer to the Ellis Print Tuning Guide for more great tuning ideas.</p>"},{"location":"klicky_wiring/","title":"Klicky Wiring","text":"<p>Note</p> <p>This wiring section applies to K1/K1C/K1SE/K1M printers only</p> <p>You will need to make a cable from the nozzle touch port to the 3 pin port on the klicky.</p> <p>The TOUCH port on the Nozzle MCU board mates with a male 5-pin Molex Picoblade connector. Some sellers may call the connector \"Micro JST SH 1.25\" but that is incorrect.</p> <p>You could repin a CR-Touch cable (used for connecting bltouch / microprobe) with the 3 pin connector provided with the PCB Klicky, or make your own cable.</p> <p>The Creality cable for their CR Touch probe is a good option although you will need to remove 2 of the wires for a neat connection</p> <ul> <li>https://www.aliexpress.us/item/1005004960067376.html</li> <li>https://www.amazon.com/dp/B0BKPFY24M/</li> </ul> <p>You want to use the 3 top wires on the nozzle mcu TOUCH port.   Connect to TOUCH port on the nozzle MCU, it is accessible from the side left (LIDAR) side of the printhead and only the external cover of the printhead has to be removed.</p> <p></p> <p></p> <p>The wiring looks like this:</p> <p></p>"},{"location":"legacy_btteddy_flashing/","title":"Legacy BTT Eddy Flashing","text":"<p>Danger</p> <p>THIS IS A RISKY OPERATION YOU CAN BRICK YOUR EDDY</p>"},{"location":"legacy_btteddy_flashing/#creating-a-live-usb-key","title":"Creating a Live USB Key","text":"<p>If you do not have a Raspberry PI or an Linux Desktop or Server machine, you can create a live USB and boot into that, the following instructions work fine on a Usb Key, just make sure the USB is at least 8GB in size to allow for installing the packages we need and cloning klipper.</p> <p>https://ubuntu.com/tutorials/try-ubuntu-before-you-install#1-getting-started</p>"},{"location":"legacy_btteddy_flashing/#install-some-deps-on-ubuntu","title":"Install some deps on Ubuntu","text":"<pre><code>sudo apt-get update\nsudo apt-get install -y build-essential git libusb-1.0.0-dev pkg-config\n</code></pre>"},{"location":"legacy_btteddy_flashing/#flashing","title":"Flashing","text":""},{"location":"legacy_btteddy_flashing/#connecting-in-bootsel-mode","title":"Connecting in BOOTSEL mode","text":"<p>You need to connect your btt eddy to your computer in BOOTSEL mode, you do this by disconnecting the eddy usb, and then push and hold boot button on Eddy (It's next to where the cable plugs in) and at the same time, plug in the cable to your computer.</p> <p>You know its correct if you run an <code>lsusb</code> and see: </p>"},{"location":"legacy_btteddy_flashing/#flashing-btteddyuf2-file","title":"Flashing btteddy.uf2 file","text":"<p>First of all you need klipper:</p> <pre><code>git clone https://github.com/pellcorp/klipper.git\n</code></pre> <p>Then we need to build the rp2040_flash flasher: <pre><code>cd klipper/lib/rp2040_flash\nmake\ncd -\n</code></pre></p> <p>Note</p> <p>If make fails you forgot to install <code>build-essential</code> package:</p> <pre><code>sudo apt-get install -y build-essential\n</code></pre> <p>Then try the make again</p> <p>Then we need to do the actual flashing:</p> <pre><code>cd klipper\nsudo python3 ./scripts/flash_usb.py -t rp2040 -d 2e8a:0003 fw/K1/btteddy.uf2\n</code></pre> <p>Note</p> <p>We are not compiling new firmware, just flashing the firmware I have already prepared.</p>"},{"location":"m600_support/","title":"M600 Manual Filament Change","text":"<p>Simple AF has support for manual filament changes.</p> <p>In Orca Slicer once you have sliced the model, switch to the preview pane and choose the layer that you want to add the filament change to, it should be the layer before you want to switch colours, then right click and choose Add Custom G-code:</p> <p></p> <p>Add <code>M600</code> to this dialog and click OK:</p> <p></p> <p>And then reslice the file, then you can send it to print!</p> <p>Note</p> <p>This functionality is very likely to conflict with the filament sensor <code>insert_gcode</code> to auto load filament if you have a CFS or DXC extruder, in that case you probably should use PAUSE instead of M600!   I would welcome PRs to Simple AF that allow auto load to work with the built in M600 support, one day I might even add it myself as I have a CFS extruder!</p>"},{"location":"m600_support/#custom-hooks","title":"Custom Hooks","text":"<p>If the default load, unload and purge more support is not suitable for you, you can implement custom hooks to create your own macros.</p> <p>The custom hooks are:</p> <ul> <li><code>_SAF_FC_LOAD_FILAMENT</code></li> <li><code>_SAF_FC_UNLOAD_FILAMENT</code></li> <li><code>_SAF_FC_PURGE_MORE</code></li> </ul>"},{"location":"m600_support/#legacy-support","title":"Legacy Support","text":"<p>To use the macros that Simple AF used to have, you can do that with custom hooks:</p> <pre><code>[gcode_macro _SAF_FC_UNLOAD_FILAMENT]\ngcode:\n    M109 S{printer['gcode_macro RESUME'].last_extruder_temp.temp|int}\n    RESPOND TYPE=command MSG=\"Unloading filament...\"\n\n    # Turn on cooling fan to help with temperature drop\n    #M106 S255\n    M83\n\n    #### K1* Unicorn Nozzle/Heatbreak/Extruder Geometry:\n    ## pipe - heatbreak - pipe - nozzle\n    ## 23.6 - 10.5      - 3    - 28.3 - total 65.4mm\n    ### Positions:\n    ## E-28.3 = unloaded from nozzle/heater\n    ## E-36.55 = unloaded from nozzle/hb until middle of heatbreak\n    ## E-42.3 = unloaded from nozzle and hb = between heatbreak and extruder drive gears, hand pullable with lever opened\n    ## E-77.5 = unloaded from nozzle, hb and extruder = beyond extruder drive gears, hand pullable with lever closed\n\n    #### CHCB-OTC on K1* Nozzle/Heatbreak/Extruder Geometry:\n    ## pipe - heatbreak - pipe - nozzle\n    ## (23.5 - 10.5      - 3    - 28.5 - total 65.5mm\n    ### Positions:\n    ## E-28.5 = unloaded from nozzle/heater\n    ## E-36.75 = unloaded from nozzle/hb until middle of heatbreak\n    ## E-42.5 = unloaded from nozzle and hb = between heatbreak and extruder drive gears, hand pullable with lever opened\n    ## E-77.5 = unloaded from nozzle, hb and extruder = beyond extruder drive gears, hand pullable with lever closed\n\n    M104 S{printer['gcode_macro RESUME'].last_extruder_temp.temp|int - 30}     # Start cooling (don't wait)\n    G4 P5000                       # Wait for initial cooldown\n    G1 E30 F180                    # initially purge larger due to nozzle length\n    G1 E-12 F600                   # Medium retract -12\n    G4 P1000                       # Wait\n    G1 E4 F120                     # Small extrude -8\n    G1 E-18 F1400                  # Fast retract -26\n    G4 P500                        # Wait\n    G1 E2 F90                      # Tiny extrude -24\n    G1 E-24 F2200                  # Very fast retract -48\n    G1 E-50 F2800                  # Final snap retract -98\n\n    M400\n\n    #M106 P0 S0\n    #M106 P2 S0\n\n    # turn off extruder to help it avoid overheating\n    SET_STEPPER_ENABLE STEPPER=extruder ENABLE=0\n    BEEP\n    # we lowered by -30\u00b0 before. restore already here to avoid heating at _LOAD_FILAMENT later\n    M104 S{printer['gcode_macro RESUME'].last_extruder_temp.temp|int}\n\n[gcode_macro _SAF_FC_LOAD_FILAMENT]\ngcode:\n  M109 S{printer['gcode_macro RESUME'].last_extruder_temp.temp|int}\n  RESPOND TYPE=command MSG=\"Loading filament...\"\n  M83\n  G1 E100 F180\n  _CLIENT_RETRACT\n  M400\n  # turn off extruder to help it avoid overheating\n  SET_STEPPER_ENABLE STEPPER=extruder ENABLE=0\n  BEEP\n\n[gcode_macro _SAF_FC_PURGE_MORE]\ngcode:\n  M109 S{printer['gcode_macro RESUME'].last_extruder_temp.temp|int}\n  RESPOND TYPE=command MSG=\"Purging filament...\"\n  M83\n  G1 E10 F180\n  _CLIENT_RETRACT\n  M400\n  # turn off extruder to help it avoid overheating\n  SET_STEPPER_ENABLE STEPPER=extruder ENABLE=0\n  BEEP\n</code></pre>"},{"location":"microprobe/","title":"Microprobe","text":""},{"location":"microprobe/#where-can-i-get-help","title":"Where can I get help?","text":"<p>Come on over to the pellcorp discord server, the <code>#simple-af-microprobe</code> channel has been setup for anyone wanting support for microprobe.</p> <p>https://discord.gg/2uGDzyJ3WX</p>"},{"location":"microprobe/#firmware-requirements","title":"Firmware requirements","text":""},{"location":"microprobe/#limits-on-x-and-y-microsteps","title":"Limits on X and Y microsteps","text":"<p>You cannot use more than <code>microsteps: 64</code> for <code>[stepper_x]</code> and <code>[stepper_y]</code>, the MCU cannot handle high microsteps, it puts too much pressure on the mainboard and it will cause stuttering and other reliability issues including random crashes.</p> <p>Note</p> <p>This limit generally does not apply to RPi Series Simple AF</p>"},{"location":"microprobe/#k1-series","title":"K1 Series","text":"<p>This guide assumes you have a K1, K1C, K1SE or K1 Max and you are running stock creality firmware 1.3.3.5 or higher (The firmware 1.3.3.5 is much older than 1.3.3.46 for example), or alternately you can use my prerooted firmware.</p>"},{"location":"microprobe/#ender-5-max","title":"Ender 5 Max","text":"<p>This probe is currently not supported on Ender 5 Max</p>"},{"location":"microprobe/#ender-3-v3-ke","title":"Ender 3 V3 KE","text":"<p>This guide assumes you have a stock Ender 3 V3 KE with Nebula Pad with Root enabled, when you get to installation below, you should specify the <code>--mount Default</code> to install Simple AF on the KE for Cartographer.</p> <p>Please note that you will need to change the screen orientation to horizontal, here is a model for that https://www.printables.com/model/727362-ender-3-v3-ke-screen-holder-landscape-for-guppyscr, but please do not follow the installation instructions on that page, just print the model and remount your screen only!</p>"},{"location":"microprobe/#simple-af-for-rpi","title":"Simple AF for RPi","text":"<p>See Simple AF for RPi</p>"},{"location":"microprobe/#slicer-settings","title":"Slicer Settings","text":"<p>Danger</p> <p>Creality Print won't be able to see your printer after you have installed Simple AF, the only tested slicer we all use is OrcaSlicer, likely if you want to use Creality Print you will need to print via usb.</p> <p>Cura Slicer won't work out of the box for configuring START_PRINT variables as below, you need to change the start print EXTRUDER_TEMP and BED_TEMP to pass in the correct values, but since I don't use Cura Slicer I can't advise on that!</p> <p>There is an assumption that you are using a slicer like OrcaSlicer and Machine G-code like:</p> <p></p> <p>Machine start G-code <pre><code>M140 S0\nM104 S0\nSTART_PRINT EXTRUDER_TEMP=[nozzle_temperature_initial_layer] BED_TEMP=[bed_temperature_initial_layer_single]\n</code></pre></p> <p>Machine end G-code <pre><code>END_PRINT\n</code></pre></p>"},{"location":"microprobe/#custom-bed-mesh-profile","title":"Custom Bed Mesh Profile","text":"<p>If you want to select a specific predefined bed mesh profile (which disables adaptive mesh generation), you can pass in an additional <code>START_PRINT</code> parameter:</p> <p>You can either hard code it to a particular model, like <code>BED_MESH_PROFILE=myprofile</code> or you can specify a profile based on orca slicer variables, such as <code>BED_MESH_PROFILE=\"[curr_bed_type] - [filament_type]\"</code>, but you have to make sure you have all the possible profiles defined for each of the bed type and filament type combinations.</p> <p></p> <p></p>"},{"location":"microprobe/#probe-installation","title":"Probe Installation","text":"<p>Danger</p> <p>If you are not using a side mount you must verify config changes for microprobe.cfg before homing your printer, using Screws Tilt Calculate or doing a bed mesh!  </p> <p>Ignoring these instructions can lead to significant damage to your build plate and/or probe.</p>"},{"location":"microprobe/#mount-options","title":"Mount Options","text":"Mount Printer URL Notes Default K1, K1C, K1M, K1SE https://www.printables.com/model/867527-k1-biqu-microprobe-mount-remix BootyGantry K1, K1C, K1M, K1SE https://github.com/tlace17/K1-Linear-Rail-Gantry/blob/main/STLs/Probe%20Mounts/Rail%20Carriage%20Microprobe%20Mount.stl Default Ender 3 K3 KE https://www.printables.com/model/1024825-biqu-btt-microprobe-to-crtouch-adapter Experimental and untested as yet <p>Important: All mount options assume a V2 microprobe is being used, after the installation you may need to modify <code>microprobe.cfg</code> to  switch the pin config:</p> <pre><code>#pin: ^nozzle_mcu: PA9  # MicroProbe V1 users should use this line to trigger on high\npin: ^!nozzle_mcu: PA9  # MicroProbe V2 users should use this line to trigger on low\n</code></pre>"},{"location":"microprobe/#installation","title":"Installation","text":"<p>Warning</p> <p>The installation section does not apply to Simple AF for RPi, See Simple AF for RPi</p> <p>The installation can only be performed on a printer which has been rooted and ssh granted</p> <p>You need root access, if you are not already root, then follow the excellent Helper Script Enable Root Access instructions.</p>"},{"location":"microprobe/#factory-reset","title":"Factory Reset","text":"<p>You must do a factory reset only if you have installed Helper Script or Fluidd/Mainsail directly from Creality, otherwise you can safely proceed directly to installation.    If you have setup your printer with stock firmware only it can be quite handy to skip a factory reset so that you can use Switch to Stock</p> <pre><code>wget --no-check-certificate https://raw.githubusercontent.com/pellcorp/creality/main/k1/services/S58factoryreset -O /tmp/S58factoryreset\nchmod +x /tmp/S58factoryreset\n/tmp/S58factoryreset reset\n</code></pre> <p>Danger</p> <p>It is really important you do not close the ssh session until you get this message:</p> <p></p> <p>It can take up to 5 minutes for a factory restart to finish, it is vital you do not power cycle your printer before the stock screen appears. There may be a 3002 error on the screen, this is completely normal.   If you are planning to install Simple AF you can ignore it, if you are trying to go back to stock, power cycle the printer again to clear the error.  </p> <p>Failing to follow this advice can lead to your printer getting bricked and requiring much more involved intervention to recover!</p> <p></p>"},{"location":"microprobe/#clone-the-repo","title":"Clone the Repo","text":"<pre><code>git config --global http.sslVerify false\ngit clone https://github.com/pellcorp/creality.git /usr/data/pellcorp\n</code></pre>"},{"location":"microprobe/#run-the-installer","title":"Run the installer","text":"<p>Note</p> <p>If you have pellcorp-overrides in github but not stored locally, you need to recreate the ~/pellcorp-overrides directory before running the installer.sh!</p> <p>To run the script, you must specify the probe you want to use.</p> <pre><code>/usr/data/pellcorp/installer.sh --install microprobe --mount Mount\n</code></pre> <p>Warning</p> <p>For <code>Mount</code> you must specify the mount option for the mount you have used, if you do not do this the printer will be incorrectly configured for your mount, and bed meshes, x and y limits and related config will be wrong.   Please refer to Mount Options for supported mounts.   </p> <p>If you are using a non-supported mount you should specify a mount option as close to your mount as possible and properly adjust your configuration after installation before trying to perform a bed mesh or Screws Tilt Calculate!</p>"},{"location":"microprobe/#post-installation","title":"Post Installation","text":""},{"location":"microprobe/#v1-probe-changes","title":"V1 Probe Changes","text":"<p>The default microprobe.cfg assumes a V2 microprobe a post install change to <code>[probe]</code> section of <code>printer.cfg</code> will be required for a V1.  Have a look at the printer.cfg after the install has finished and have a look at the commented V1 pin config.</p>"},{"location":"microprobe/#mcu-firmware-updates-are-pending","title":"MCU Firmware updates are pending","text":"<p>At the end of the installer process if you get this message:</p> <pre><code>WARNING: MCU Firmware updates are pending you need to power cycle your printer!\n</code></pre> <p>It means that new MCU firmware updates need to be applied and this can only be done by power cycling the printer.  After your printer is power cycled you can verify firmware was updated with the <code>CHECK_FIRMWARE</code> macro from Fluidd or Mainsail, if you see this message:</p> <pre><code>INFO: Your MCU Firmware is up to date!\n</code></pre> <p>Your printer MCU firmware was updated successfully.   If you still see the <code>MCU Firmware updates are pending you need to power cycle your printer!</code> message after a power cycle, check the <code>/tmp/mcu_update.log</code>, you may be asked to provide this file on Discord if you need additional assistance, sometimes an additional power cycle can solve the problem, there is a very short window of time (15 seconds) in which the MCU firmware can be updated, so  there is a chance it will work after an additional power cycle.</p>"},{"location":"microprobe/#verify-usb-key","title":"Verify USB Key","text":"<p>It is important to make sure you have a way to emergency factory reset the printer, if the worst happens.   There is a macro in Simple AF called <code>CHECK_USB_KEY</code> that will wait for you to plug a USB thumb drive (aka USB key) in and tell you if it was able to be successfully mounted.</p> <p>You can find the CHECK_USB_KEY macro in Fluidd or Mainsail, because Fluidd and Mainsail are already installed, you can access Fluidd by opening your browser and connecting using http://X.X.X.X, where X.X.X.X is your ip address that you used to login via ssh to your printer, you can also access Fluidd via http://X.X.X.X:4408 and Mainsail via http://X.X.X.X:4409!</p> <p></p> <p>After running the macro you should see output like the following:</p> <p></p> <ul> <li>If you get the message: <code>INFO - USB Key was recognised and mounted correctly (/tmp/udisk/sda1)</code>, your USB thumb drive (aka USB key) is perfect to use for a factory reset.</li> <li>If you get no message at all before the script ends (after 60 seconds), your USB thumb drive (aka USB key) is defective.   You can check the <code>messages</code> file in the logs section of your UI to get more details about why the usb key could not be mounted!</li> </ul> <p>Tip</p> <p>You should verify your USB thumb drive (aka USB key) often just to make sure you have something if you need to unbrick your printer, simply type <code>CHECK_USB_KEY</code> or hit the button in Fluidd / Mainsail The USB key should be FAT32 formatted and be no larger than 32GB!</p>"},{"location":"microprobe/#calibration","title":"Calibration","text":"<p>Warning</p> <p>The following calibration steps are required to setup a new printer:</p> <ul> <li>Probe Calibrate</li> <li>PID Tuning and Input Shaping</li> </ul>"},{"location":"microprobe/#probe-calibrate","title":"Probe Calibrate","text":"<p>For the microprobe it is extremely important to do the PROBE_CALIBRATE step to configure your z-offset, regardless of what model you have used to mount the probe!</p> <p></p> <ol> <li>Home All (<code>G28</code>)</li> <li>Run <code>PROBE_CALIBRATE</code></li> <li>Follow the Paper Test Method Upon completion <code>SAVE_CONFIG</code></li> </ol> <p>Note</p> <p>The default z-offset for Microprobe is 0, so your prints won't stick without doing this step.</p>"},{"location":"microprobe/#pid-tuning-and-input-shaping","title":"Pid Tuning and Input Shaping","text":"<p>At least PID tuning (bed and extruder) and input shaping is required for acceptable printing.  If you try and print after running the installer.sh and a power cycle but before any calibration you will most likely have horrendous quality, the worst you have ever seen on the k1.   After PID tuning and input shaping you should see the same kind of quality as you get with stock k1 + input shaper fix.</p> <p>Note</p> <p>You can use the QUICK_START Macro to complete Bed and Nozzle PID Tuning and Input Shaping Automatically.</p>"},{"location":"microprobe/#pid-tuning","title":"Pid Tuning","text":"<p>Source: Calibrate Pid Settings</p> <p>For example you might run these:</p> <pre><code>PID_CALIBRATE_BED BED_TEMP=65\nPID_CALIBRATE_HOTEND HOTEND_TEMP=230\n</code></pre> <p>Note</p> <p>The <code>PID_CALIBRATE_BED</code> and <code>PID_CALIBRATE_HOTEND</code> macros are located in the <code>useful_macros.cfg</code> file and they have defaults values for BED_TEMP and HOTEND_TEMP so you can just run them by clicking on them if you want that same temperature.</p>"},{"location":"microprobe/#input-shaping","title":"Input Shaping","text":"<p>There is no default configuration for input shaping so it is essentially disabled out of the box.</p> <p>You can use the <code>SHAPER_CALIBRATE</code> macro to run input shaping, just be sure to <code>SAVE CONFIG</code> at the end, to choose the automatically selected shaper config, be aware though that the shaper chosen might be sub-optimal due to a slight difference in vibrations between two options.  So you should probably review the output and potentially choose an alternative if it gives you higher recommended max acceleration for minimal increase in vibration.</p> <p>Input Shaper Auto Calibration</p>"},{"location":"microprobe/#probing-speed","title":"Probing speed","text":"<p>On a K1/Max a faster lift_speed may counter the backlash on the Z-axis belts. Going too fast is likely making the bed bounce back in the opposite direction. Find the best speeds for probing by varying the probe_speed and lift_speed parameters. BIQU Microprobe is an optical probe and as a rule slow probe_speed will give better results. Start with probe_speed=1 and vary the lift_speed values to find the optimal lift_speed first.</p> <pre><code>PROBE_ACCURACY probe_speed=1 lift_speed=15\n</code></pre> <p>In this case, lift_speed of 15mm/s seems optimal.</p> <p></p> <p>After determining the optimal lift_speed, different probe_speed values can be tested until the sweet spot is found. Here 1.0mm/s works most reliably, however, the slow speed will make the meshing process take longer.</p> <p></p> <p>Credit to Ales Omahen (@Havoc on discord) for this section</p>"},{"location":"microprobe/#axis-twist-compensation","title":"Axis Twist Compensation","text":"<p>If you are using a rear mount it is highly recommended to perform axis twist compensation, this will affect the quality of your bed mesh, so best to do it before.</p> <p>Tip</p> <p>There is no need to run axis twist compensation if you have mounted the eddy with a side mount that has a 0 y offset!</p> <ol> <li>Home All (<code>G28</code>)</li> <li>Run <code>AXIS_TWIST_COMPENSATION_CALIBRATE</code> The calibration wizard will prompt you to measure the probe Z offset at a few points along the bed    Upon completion <code>SAVE_CONFIG</code></li> </ol> <p>Source: https://www.klipper3d.org/Axis_Twist_Compensation.html</p>"},{"location":"microprobe/#first-print","title":"First Print","text":"<p>You should optimise your probe z offset using baby stepping.</p> <p>In fluidd the save button after you finish or cancel your print can be a bit hard to find, look for</p> <p></p>"},{"location":"microprobe/#other-calibrations","title":"Other Calibrations","text":"<p>Info</p> <p>The default value for pressure advance is set to <code>0.04</code></p> <p>Refer to Orcaslicer Calibration for more calibrations</p> <p>Refer to the Ellis Print Tuning Guide for more great tuning ideas.</p>"},{"location":"microprobe_wiring/","title":"Microprobe Wiring","text":"<p>Note</p> <p>This wiring section applies to K1/K1C/K1SE/K1M printers only</p> <p>The probe and the TOUCH port on the Nozzle MCU board both mate with a 5-pin Molex Picoblade connector. A 5-pin cable is needed to connect the probe to the TOUCH port.</p> <p>Some sellers may call the connector \"Micro JST SH 1.25\" but that is incorrect. Several premade cables are compatible. Most notably the Creality cable for their CR Touch probe:</p> <ul> <li>https://www.aliexpress.us/item/1005004960067376.html</li> <li>https://www.amazon.com/dp/B0BKPFY24M/</li> </ul> <p></p> <p></p> <p>Connect to TOUCH port on the nozzle MCU. it is accessible from the side left (LIDAR) side of the printhead and only the external cover of the printhead has to be removed.</p> <p></p> <p></p>"},{"location":"misc/","title":"Misc","text":""},{"location":"misc/#octoeverywhere-companion","title":"OctoEverywhere Companion","text":"<p>See OctoEverywhere Companion</p>"},{"location":"misc/#mobileraker-companion","title":"Mobileraker companion","text":"<p>See Mobileraker Companion</p>"},{"location":"misc/#switch-to-stock","title":"Switch to Stock","text":"<p>See Switch to Stock</p>"},{"location":"misc/#moonraker-timelapse","title":"Moonraker Timelapse","text":"<p>See Moonraker Timelapse</p>"},{"location":"misc/#spoolman","title":"Spoolman","text":"<p>See Spoolman</p>"},{"location":"misc/#emergency-factory-reset","title":"Emergency Factory Reset","text":"<p>See Emergency factory Reset</p>"},{"location":"misc/#configure-wifi-via-usb-stick","title":"Configure Wifi via USB Stick","text":"<p>See Configure Wifi via USB</p>"},{"location":"misc/#support-zip","title":"Support ZIP","text":"<p>See Support</p>"},{"location":"mobileraker_companion/","title":"Mobileraker Companion","text":"<p>Mobileraker works as a simple UI for Klipper on the phone. Connect it to an existing moonraker installation and control the printer.</p> <p>You must not setup Mobileraker on a K1 series machine (which includes Ender 3 V3 KE, NebulaPad and Ender 5 Max) because it will overwhelm the processor and cause serious stability issues.</p> <p>Instead install the Mobileraker Companion on another device on the same network as the printer.</p> <p>Note</p> <p>It's probably fine to setup Mobileraker on the same host as Simple AF if using Simple AF for RPi series.</p> <p>https://github.com/Clon1998/mobileraker_companion?tab=readme-ov-file#standalone-installation</p>"},{"location":"moonraker_timelapse/","title":"Moonraker Timelapse","text":"<p>Moonraker timelapse is installed but not enabled by default.  To enable it there are a few steps, you need to add the following include to printer.cfg:</p> <pre><code>[include timelapse.cfg]\n</code></pre> <p>And uncomment the <code>[include timelapse.conf]</code> in moonraker.conf, you will need to restart moonraker and klipper after this, you can do that via the fluidd or mainsail services section.</p> <p>If you see these messages:</p> <p><pre><code> 15:14:24  // Unknown command:\"_SET_TIMELAPSE_SETUP\"\n15:14:24  // Unknown command:\"HYPERLAPSE\"\n</code></pre> It means you have not as yet properly restarted moonraker and/or klipper.    If in doubt just power cycle your machine.</p>"},{"location":"moonraker_timelapse/#custom-parking-position","title":"Custom Parking Position","text":"<p>You might run into issues with the default <code>back_right</code> parking position.  A user has reported that the toolhead collides with the rear motor, a remedy for this is to modify the <code>[timelapse]</code> section in <code>timelapse.conf</code> to enable custom parking and set the X and Y coordinates to match what is in the <code>start_end.cfg</code> for <code>variable_custom_park_x</code> and <code>variable_custom_park_y</code>.</p> <p>Change the <code>parkpos: back_right</code> to be <code>parkpos: custom</code>, so the <code>timelapse.conf</code> changes might look like:</p> <pre><code>parkpos: custom\npark_custom_pos_x: 296\npark_custom_pos_y: 296\n</code></pre>"},{"location":"moonraker_timelapse/#timelapse-camera-config","title":"Timelapse Camera config","text":"<p>Info</p> <p>Because the single webcam is controlled via moonraker with the webcam.conf file, the Timelapse camera dropdown menu won't let you choose a camera, this is expected.</p> <p></p>"},{"location":"moonraker_timelapse/#slicer-changes","title":"Slicer Changes","text":"<p>https://github.com/mainsail-crew/moonraker-timelapse/blob/main/docs/configuration.md#prusa-slicer--super-slicer</p>"},{"location":"nozzle_wipe/","title":"Nozzle Wipe Support","text":"<p>Danger</p> <p>It can be dangerous to use a rear mounted nozzle wiper with a rear mounted probe, there is a strong likelihood of destroying the probe or damaging the printer!</p> <p>Simple AF does not package any predefined nozzle wipers but we do provide a _SAF_NOZZLE_WIPE custom hook for that, and the <code>_SAF_NOZZLE_WIPE</code> will be passed the <code>EXTRUDER_TEMP</code> parameter from START_PRINT to give you a bit more flexibility for implementing your nozzle wiper macros.</p> <p>So for instance you could use the <code>EXTRUDER_TEMP</code> in the <code>_SAF_NOZZLE_WIPE</code> macro like this:</p> <pre><code>[gcode_macro _SAF_NOZZLE_WIPE]\ngcode:\n    {% set EXTRUDER_TEMP=params.EXTRUDER_TEMP|float %}\n\n    # lower the temp to something where nozzle does not ooze to do your thing\n    M109 S150\n\n    # then set the nozzle temp\n    M104 S{EXTRUDER_TEMP}\n</code></pre> <p>This might be useful for instance if you need to adjust the nozzle temp as part of your macro but then set it to the target temp, although in that case it actually would probably be better to get the existing target temp at the start of your <code>_SAF_NOZZLE_WIPE</code> in a different way:</p> <pre><code>[gcode_macro _SAF_NOZZLE_WIPE]\ngcode:\n    {% set target_nozzle_temp = printer[printer.toolhead.extruder].target %}\n\n    # Do the nozzle wipe thing here whatever it is\n\n    # then restore the previous nozzle temp\n    M109 S{target_nozzle_temp}\n</code></pre>"},{"location":"nozzle_wipe/#nozzle-wipe-options","title":"Nozzle Wipe Options","text":"<p>The following are the nozzle wipe macros I am aware of, I provide absolutely no guarantees about them!</p> <p>Config overrides should save and restore these additional .cfg for you automatically, just make sure its saved directly to the config/ directory and not a sub-directory and you should be good to go!</p>"},{"location":"nozzle_wipe/#purcell-nozzle-wipe","title":"Purcell Nozzle Wipe","text":"<p>You can find the advanced_nozzle_cleaner.cfg file at https://www.printables.com/model/1023575-advanced-nozzle-wiper-for-creality-k1-series, and upload it to your config directory.</p> <p>Make sure its included after <code>[include start_end.cfg]</code> in <code>printer.cfg</code></p> <p>Then make a few changes to <code>advanced_nozzle_cleaner.cfg</code>:</p> <p>Warning</p> <p>You must replace any <code>M106 P0</code> references with just <code>M106</code> as <code>P0</code> is not supported to reference the part fan.  In order to mitigate performance issues that were causing klipper to crash with a move queue overflow we had to migrate from <code>[fan_generic part]</code> to <code>[fan]</code> for the part fan.   M106 P argument still works for chamber and auxiliary like before.</p> <p>You need to disable this:</p> <pre><code>#[gcode_macro CX_NOZZLE_CLEAR]\n#rename_existing: _CX_NOZZLE_CLEAR\n#gcode:\n#  WIPE_NOZZLE\n</code></pre> <p>Add this:</p> <pre><code>[gcode_macro _SAF_NOZZLE_WIPE]\ngcode:\n    # make the nozzle wipe be a good citizen and restore the target temp afterwards\n    {% set target_nozzle_temp = printer[printer.toolhead.extruder].target %}\n\n    WIPE_NOZZLE\n\n    # then restore the previous nozzle temp\n    M109 S{target_nozzle_temp}\n</code></pre>"},{"location":"nozzle_wipe/#calin-nozzle-wipe","title":"Calin Nozzle Wipe","text":"<p>For Calin solution it's all on the website: https://makerworld.com/en/models/1547901-creality-k1-max-silicone-nozzle-wiper</p> <p>Calin has updated the docs for their macro to correctly use M106 macro so no changes should be required beyond what is documented on that makerworld site.</p>"},{"location":"octoeverywhere_companion/","title":"OctoEverywhere Companion","text":"<p>OctoEverywhere is a 3D printing community project that enables free remote access, AI print failure detection, notifications, and more. </p> <p>You must not setup OctoEverywhere on a K1 series machine (which includes Ender 3 V3 KE, NebulaPad and Ender 5 Max) because it will overwhelm the processor and cause serious stability issues.  </p> <p>Instead install the OctoEverywhere Companion on another device on the same network as the printer.</p> <p>Note</p> <p>It's probably fine to setup Octoeverywhere on the same host as Simple AF if using Simple AF for RPi series.</p> <p>Learn More: https://octoeverywhere.com/companion</p>"},{"location":"octoeverywhere_companion/#how-do-i-control-octoeverywhere","title":"How do I control OctoEverywhere?","text":"<p>OctoEverywhere Companion is controlled by systemd, and each printer is a separate service, so you can see them here:</p> <pre><code>$ systemctl list-units octo* --all\nUNIT                               LOAD   ACTIVE SUB     DESCRIPTION                 \noctoeverywhere-companion-2.service loaded active running OctoEverywhere For Moonraker\noctoeverywhere-companion.service   loaded active running OctoEverywhere For Moonraker\n</code></pre> <p>To check status:</p> <pre><code>systemctl status octoeverywhere-companion.service\n</code></pre> <p>To start it:</p> <pre><code>sudo systemctl start octoeverywhere-companion.service\n</code></pre> <p>To make it start on boot:</p> <pre><code>sudo systemctl enable octoeverywhere-companion.service\n</code></pre> <p>The configuration for each instance of the service is in a separate directory in your home directory, so in my case I have two of them:</p> <pre><code>~/.octoeverywhere-companion/\n~/.octoeverywhere-companion-2/\n</code></pre> <p>And you can find a octoeverywhere.conf in each directory and you can change the IP address in that config file and restart the service:</p> <pre><code>sudo systemctl restart octoeverywhere-companion\n</code></pre>"},{"location":"rpi/","title":"SimpleAF for RPi","text":"<p>Simple AF for RPI can be installed on pretty much any debian based (rasbian, dietpi, opi debian server, etc) Rpi like SBC, which also includes CM like the CM4, CM5 and CB range from BTT as well as your standard Raspberry Pis, Orange Pis, etc.</p>"},{"location":"rpi/#installation","title":"Installation","text":"<p>Refer to Supported OS</p>"},{"location":"rpi/#cloning-repo","title":"Cloning repo","text":"<p>The following commands should be executed to get the repo locally:</p> <pre><code>sudo apt-get update\nsudo apt-get install -y git\ngit clone https://github.com/pellcorp/creality.git ~/pellcorp\n</code></pre>"},{"location":"rpi/#installing","title":"Installing","text":"<p>The installation command is very similar to K1 series:</p> <pre><code>~/pellcorp/installer.sh --install --printer &lt;ThePrinter&gt; --probe &lt;TheProbe&gt; [--mount &lt;TheMount&gt;]\n</code></pre> <ul> <li>Where <code>--printer &lt;ThePrinter&gt;</code> is a predefined, downloaded or downloadable printer definition</li> <li>Where <code>--mount &lt;TheMount&gt;</code> is only required for some predefined printer definitions</li> <li>Where <code>&lt;TheProbe&gt;</code> is one of cartographer, cartotouch, beacon, bltouch, microprobe, klicky, btteddy, eddyng</li> </ul>"},{"location":"rpi/#predefined-printer","title":"Predefined Printer","text":"<p>You need to figure out what kind of mainboard you have because that will dictate whether you can  use a predefined printer cfg file  or you need to provide your own.  The easiest way to find out what predefined printers are available is to run the command:</p> <pre><code>~/pellcorp/installer.sh --install --printer\n</code></pre> <p></p> <p>Note</p> <p>For the <code>--printer</code> argument specify the ID of the printer so for instance <code>--printer creality-ender3-v3-se</code></p>"},{"location":"rpi/#downloaded-or-downloadable-printer-definition","title":"Downloaded or Downloadable Printer Definition","text":"<p>Refer to Printer Definitions for how to craft a base printer cfg file, note at the moment the  installer does not support a printer cfg broken up into separate files, it should be a single .cfg file only.</p> <p>You can specify a http:// or https:// url for the --printer parameter or you can download the file locally yourself!</p> <p>Note</p> <p>For the <code>--printer</code> argument specify the url of the file, so for example <code>--printer https://github.com/pellcorp/klipper-rpi/blob/master/config/printer-creality-ender3-s1plus-2022.cfg</code> or reference a local file if you did download it locally, so for example <code>--printer ~/printer-creality-ender3-s1plus-2022.cfg</code></p>"},{"location":"rpi/#choose-a-probe","title":"Choose a Probe","text":"<p>You need to choose a probe one of:</p> <ul> <li>cartographer</li> <li>cartotouch</li> <li>beacon</li> <li>bltouch</li> <li>microprobe</li> <li>klicky</li> <li>btteddy</li> <li>eddyng</li> </ul>"},{"location":"rpi/#choose-a-mount","title":"Choose a mount","text":"<p>If you have chosen a predefined printer, it might require you to choose a mount, you can run the installer with the --mount option without an argument to get a list of possible mounts:</p> <p></p>"},{"location":"rpi_boot_display/","title":"Boot Display","text":"<p>The boot display step is currently optional and requires some manual steps, so you install the boot display via:</p> <pre><code>~/pellcorp/rpi/install-boot-display.sh\n</code></pre>"},{"location":"rpi_boot_display/#raspberry-pi-os","title":"Raspberry Pi OS","text":"<p>To get the splash screen working on raspberry pi OS you have to jump through a few additional hoops including installing:</p> <pre><code>sudo apt-get install -y plymouth rpd-plym-splash plymouth-themes\n</code></pre> <p>And then enable the splashscreen in raspi-config!</p> <p>Note</p> <p>Installing rpd-plym-splash actually displays the raspberry pi desktop theme so if you enable the splashscreen after running the installer for the boot-display, you will most likely need to rerun:</p> <pre><code>sudo plymouth-set-default-theme -R simpleaf\n</code></pre>"},{"location":"rpi_faq/","title":"Frequently Asked Questions","text":""},{"location":"rpi_faq/#why-is-the-p-argument-ignored-in-the-m106-command","title":"Why is the P argument ignored in the M106 command?","text":"<p>Simple AF implemented support for the P argument into the python code in our klipper and klipper-rpi fork to mitigate performance issues.  </p> <p>Unfortunately until recently the installer for Simple AF for RPi was not ensuring that the p_selector_map was being set on the <code>[fan]</code> config in order to enable this feature.   We have recently updated the installer to ensure the p_selector_map gets added to the fan definition.</p> <p>So if your M106 P1/M106 P2/M106 P3 commands are not working as expected, please ensure you have updated to latest Simple AF!</p> <p>Warning</p> <p>You must replace any <code>M106 P0</code> references with just <code>M106</code> as <code>P0</code> is not supported to reference the part fan.  In order to mitigate performance issues that were causing klipper to crash with a move queue overflow we had to migrate from <code>[fan_generic part]</code> to <code>[fan]</code> for the part fan.</p>"},{"location":"rpi_firmware/","title":"MCU Firmware","text":"<p>Its likely if you are migrating from Marlin (for instance for a Ender 3 V3 SE), you will need to flash new klipper firmware to the mainboard (this is not the same as the RPI), and for the moment at least this guide is lacking a lot of details for that.</p> <p>I think the easiest approach here is to install Simple AF and acccept that the MCU likely won't connect and then login to your RPI and use make menuconfig and make to create the firmware so you can get that flashed in whatever method is required for your mainboard.</p> <p>Creality mainboards in general require the use of an SD-Card to get this done, BTT boards can sometimes be flashed from the cli on the printer (ymmv).   Please consult manufacturer instructions where appropriate.</p>"},{"location":"rpi_firmware/#ender-3-v3-se","title":"Ender 3 V3 SE","text":"<p>The Ender 3 V3 SE is a bit painful to flash, and it depends on which version of the board you have (C13 vs C14), but  there are a few guides this one looks to be the most detailed:</p> <p>For building the firmware: https://athemis.me/projects/klipper_guide/#create-printer-firmware-bin-file For getting it onto your printer: https://athemis.me/projects/klipper_guide/#flash-3d-printer</p>"},{"location":"rpi_firmware/#skr-mini-e3-v2","title":"SKR Mini E3 V2","text":"<p>Its important to ensure the !PA14 GPIO setting is configured, but even more important for RP3 is to ensure that the config.txt setting <code>dtoverlay=dwc2</code> is enabled in the <code>[all]</code> section, otherwise klipper is going to crash the entire pi every time it tries to start up and you will racing to stop it after ssh into the pi to deal with this after the installation.</p>"},{"location":"rpi_grumpyscreen/","title":"GrumpyScreen","text":"<p>To install GrumpyScreen on Simple AF for RPi, there is currently an assumption that you are using a BTT DSI or BTT HDMI screen, other screens might work, but ymmv.</p> <p>From the printer via ssh, run:</p> <pre><code>~/pellcorp/rpi/install-grumpyscreen.sh \n</code></pre> <p>Note</p> <p>GrumpyScreen is not supported on Debian 13.</p>"},{"location":"rpi_grumpyscreen/#btt-dsi-screen","title":"BTT DSI Screen","text":"<p>Support for grumpyscreen will be provided for BTT DSI screens but you need to setup the screen to be correctly configured.</p> <p>https://github.com/bigtreetech/TFT43-DIP</p> <p>By default when grumpyscreen starts its probably going to look like:</p> <p></p> <p>The following changes are required to fix that:</p> <p>Needs this in <code>/boot/firmware/config.txt</code> (for bookworm) or <code>/boot/config.txt</code> (for bulleye)</p> <pre><code>[all]\ngpu_mem=160\n</code></pre> <p>And please make sure you disable this line:</p> <pre><code># dtoverlay=vc4-kms-v3d\n</code></pre> <p>Note</p> <p>The gpu_mem=160 is really important otherwise Grumpyscreen won't display correctly.</p>"},{"location":"rpi_grumpyscreen/#btt-hdmi-5-screen","title":"BTT HDMI 5 Screen","text":"<p>The config required for this screen is a bit different, need to force raspberry pi to 800x480 otherwise it squashes the display down to 640x480, so this config:</p> <pre><code>[all]\ngpu_mem=160\n\nhdmi_force_hotplug=1\nhdmi_group=2\nhdmi_mode=87\nhdmi_cvt=800 480 60 6 0 0 0\n</code></pre> <p>And please make sure you disable this line:</p> <pre><code># dtoverlay=vc4-kms-v3d\n</code></pre> <p>Note</p> <p>The gpu_mem=160 is really important otherwise Grumpyscreen won't display correctly.</p> <p>You will need to modify the <code>/etc/systemd/system/grumpyscreen.service</code> to configure the correct <code>LVGL_EVDEV_DEV</code> which by default is set for DSI 4.3 TFT screen, be aware that the <code>/dev/input/event0</code> will likely be wrong if a webcam is plugged in.</p> <p>Source: https://global.bttwiki.com/HDMI5.html#hdmi-display-output</p>"},{"location":"rpi_klippain/","title":"Klippain","text":"<p>Klippain is only pre-installed on corexy printers</p> <p>If you do not define <code>[adxl345]</code> and <code>[resonance_tester]</code> sections in your base printer cfg, the installer will install klippain but not add the <code>[include klippain.cfg]</code>, so if you setup adxl and resonance tester config after installation you should also manually add the <code>[include klippain.cfg]</code> to your printer.cfg as well!</p> <p>Warning</p> <p>If you do not have a <code>[resonance_tester]</code> section, the <code>TEST_RESONANCES</code>, <code>SHAPER_CALIBRATE</code>, <code>INPUT_SHAPER</code> and <code>INPUT_SHAPER_GRAPHS</code> macros will not work!</p>"},{"location":"rpi_klipperscreen/","title":"KlipperScreen","text":"<p>To install KlipperScreen on Simple AF for RPi, there is currently an assumption that you are using a BTT DSI or BTT HDMI screen, other screens might work, but ymmv.</p> <p>From the printer via ssh, run:</p> <pre><code>~/pellcorp/rpi/install-klipperscreen.sh \n</code></pre> <p>Please note that these errors from the installer are normal and can be ignored:</p> <p></p>"},{"location":"rpi_klipperscreen/#troubleshooting","title":"Troubleshooting","text":""},{"location":"rpi_klipperscreen/#rpi5-and-trixie","title":"RPI5 and Trixie","text":"<p>A user has reported that klipperscreen keeps crashing on trixie with a rpi5, and the fix appears to be modifying the config.txt to disable:</p> <pre><code>dtoverlay=vc4-kms-v3d\n</code></pre> <p>Its counterintuitive and in the future it might be a solved issue, but for now it might be required!</p>"},{"location":"rpi_printer_definitions/","title":"RPI Base Printer Definitions","text":"<p>If you are not using a predefined printer definition you will need to craft or download a basic printer config</p>"},{"location":"rpi_printer_definitions/#what-should-be-in-this-file","title":"What should be in this file?","text":"<p>This definition should not include any kind of probe configuration in the main printer.cfg section, this should just have the basics:</p> <ul> <li><code>mcu</code></li> <li><code>extruder</code></li> <li><code>heater_bed</code></li> <li><code>heater_fan</code></li> <li><code>stepper_x</code></li> <li><code>tmcXXXX stepper_x</code></li> <li><code>stepper_y</code></li> <li><code>tmcXXXX stepper_y</code></li> <li><code>stepper_z</code></li> <li><code>tmcXXXX stepper_z</code></li> <li><code>printer</code></li> <li><code>fan</code></li> <li><code>fan_generic</code></li> <li><code>filament_switch_sensor</code></li> <li><code>temperature_sensor</code></li> <li><code>duplicate_pin_override</code></li> <li><code>temperature_fan</code></li> <li><code>verify_heater</code></li> <li><code>output_pin</code></li> </ul>"},{"location":"rpi_printer_definitions/#optional","title":"Optional","text":"<p>The following can be included:</p> <ul> <li><code>input_shaper</code> (predefined / hard coded input shaper values)</li> <li><code>adxl345</code></li> <li><code>lis2dw</code></li> <li><code>resonance_tester</code></li> <li><code>gcode_arcs</code></li> </ul>"},{"location":"rpi_printer_definitions/#illegal-sections","title":"Illegal Sections","text":"<p>The installer will exit if it finds any <code>[include ]</code> or SAVE_CONFIG sections.</p>"},{"location":"rpi_printer_definitions/#not-required","title":"Not required","text":"<p>The following sections are defined elsewhere in Simple AF and will automatically be removed from the printer definition before its used:</p> <ul> <li><code>bltouch</code></li> <li><code>probe</code></li> <li><code>safe_z_home</code></li> <li><code>homing_override</code></li> <li><code>force_move</code></li> <li><code>pause_resume</code></li> <li><code>bed_mesh</code></li> <li><code>idle_timeout</code></li> <li><code>display_status</code></li> <li><code>virtual_sdcard</code></li> <li><code>exclude_object</code></li> <li><code>axis_twist_compensation</code></li> <li><code>screws_tilt_adjust</code></li> </ul>"},{"location":"rpi_printer_definitions/#support-probes-and-mounts","title":"Support Probes and Mounts","text":"<p>If you are updating the mainboard on one of the printers that supports multiple probes and/or mounts, you should let the installer know what model of printer your config is for, this is done by specifying the model of printer with a <code># MODEL:</code> header at the beginning of the file!</p> <p>The supported models are:</p> <ul> <li><code>k1</code> (K1, K1C, K1SE)</li> <li><code>k1m</code> (K1 Max)</li> <li><code>f004</code> (Ender 5 Max)</li> <li><code>f005</code> (Ender 3 V3 KE)</li> <li><code>e3v3se</code> (Ender 3 V3 SE)</li> </ul> <p>So just stick it into the beginning of the file like this:</p> <pre><code># MODEL:k1\n</code></pre> <p>Warning</p> <p>The MODEL is case sensitive, so K1 is not the same as k1!</p> <p>If you want to support Klicky, Microprobe and Bltouch in your base printer.cfg you will need to do a bit more work, specifically you need to prefix your main printer.cfg definitions with <code>-- printer.cfg</code> and then provide additional sections for each of <code>klicky.cfg</code>, <code>microprobe.cfg</code> and <code>bltouch.cfg</code>, like this:</p> <pre><code>-- bltouch.cfg\n[bltouch]\nsensor_pin: ^PC14\ncontrol_pin: PC13\n\n-- microprobe.cfg\n[probe]\npin: ^!PC14\n\n[output_pin probe_enable]\npin: PC13\n\n-- klicky.cfg\n[probe]\npin: ^!PC14\n</code></pre> <p>Where of course the pins will be relative to the mainboard you are using</p> <p>Check out https://github.com/pellcorp/creality/blob/main/rpi/printers/creality-ender3-v3-se.cfg for an example.</p>"},{"location":"rpi_supported_os/","title":"Supported OS","text":"<p>Simple AF is best supported by RPi or OrangePi running a version of debian 11 or 12 (which includes Orange Pi Debian, Rasbian, Arbian, whatever BTT is doing, etc).</p> <p>Danger</p> <p>Do not try and install Simple AF for RPi on Mainsail OS or onto an existing klipper environment which has been setup using kiuah</p>"},{"location":"rpi_supported_os/#raspberry-pi-os","title":"Raspberry Pi OS","text":"<p>So far been tested to work on a pi 3, 4 and 5, it does not matter whether you use 32 or 64 bit OS. It is recommended to use the Rpi Imager and choose <code>Raspberry PI OS Lite (64-bit)</code> or <code>Raspberry PI OS (Legacy, 64 bit) Lite</code></p> <p>Note</p> <p>If for some strange reason your DHCP server provides an invalid DHCP option, you will need to modify the config, for debian 12 onwards its likely going to be network manager.</p> <p>Assuming you are using Ethernet, something like this might work:</p> <pre><code>sudo nmcli connection modify \"Wired connection 1\" ipv4.ignore-auto-dns yes ipv4.dns \"1.1.1.1 8.8.8.8\"\nsudo nmcli connection down \"Wired connection 1\"\nsudo nmcli connection up \"Wired connection 1\"\n</code></pre> <p>You must login as the pi (Default password is <code>raspberry</code>) user to perform the installation, you are not allowed to run the installer as root!</p>"},{"location":"rpi_supported_os/#orange-pi-os","title":"Orange Pi OS","text":"<p>Please note that OrangePi OS (based on Arch) is not supported and will fail to install because the installer assumes a debian based OS, this is unlikely to change anytime soon.</p>"},{"location":"rpi_supported_os/#orange-pi-debian-os","title":"Orange Pi Debian OS","text":"<p>Testing has been done on an Orange Pi Zero 3 W running a server image available from: https://drive.google.com/drive/folders/10zlO-0mMz-fqRQOKAOWX-mQA_UbN_C1n</p> <p>Note</p> <p>Please make sure to set <code>bootlogo=true</code> in the <code>orangepiEnv.txt</code> before booting for the first time so that the boot display works correctly.</p> <p>When running the <code>sudo apt-get update</code> you might get an error complaining about <code>Err:36 https://repo.huaweicloud.com/docker-ce/linux/debian bullseye/stable arm64 Contents</code>, this is a long standing bug (from 2023) that was never fixed and the work around is to run: <pre><code>sudo rm /etc/apt/sources.list.d/docker.list\nsudo apt-get --allow-releaseinfo-change update\n</code></pre></p> <p>You must login as the orangepi (Default password is <code>orangepi</code>) user to perform the installation, you are not allowed to run the installer as root!</p> <p>Warning</p> <p>By default the <code>orangepi</code> user cannot sudo without providing a password, the installer will create a <code>/etc/sudoers.d/nopasswd</code> file to enable no password sudo for the orangepi user.</p>"},{"location":"rpi_supported_os/#dietpi-os","title":"DietPi OS","text":"<p>Basic testing has been done with DietPi (Bookworm) running on an Orange Pi 3 Zero W</p> <p>I had some trouble getting DietPi setup in my home network which uses a PiHole connected to cleanbrowsing.org DNS family filter which prevented the default DNS settings from working.</p> <p>I updated the dietpi.txt as follows:</p> <pre><code>AUTO_SETUP_AUTOMATED=1\nSURVEY_OPTED_IN=0\nCONFIG_CHECK_CONNECTION_IP=8.8.8.8\nCONFIG_CHECK_CONNECTION_IPV6=2001:4860:4860::8888\nCONFIG_CHECK_DNS_DOMAIN=google.com\nCONFIG_CHECK_DIETPI_UPDATES=0\nCONFIG_CHECK_APT_UPDATES=0\nCONFIG_SERIAL_CONSOLE_ENABLE=0\n</code></pre> <p>You do not want the OS doing updates while prints are going so updating should be controlled by Moonraker only.   I reconfigured the DNS check configuration to use google as the quad9 DNS was not resolved by cleanbrowsing.org, of course your situation may be completely different and the above options might be overkill.</p> <p>I discovered that there is a few hoops to jump through before getting the OrangePi setup, no idea if this is due to some weird combination of settings above, but I discovered you have to physically power off the device after the first run finishes and the pi hole is supposedly rebooted, otherwise ethernet does not come back.</p> <p>What I did was login as root after powering up the device for the first time and it will tell me that first run setup is going on in a different screen and will eventually let me know a restart will be required, I wait until I am kicked from the SSH session and then I give it a minute and power cycle the pi.</p> <p>Then login as the dietpi (Default password is <code>dietpi</code>) user to start the installation, after logging in, you may be told that first run setup is still going, give it a few minutes and you should be greeted with a login prompt.</p>"},{"location":"rpi_supported_os/#ubuntu-based-distributions","title":"Ubuntu based distributions","text":"<p>On Ubuntu 22.04 or 24.04 based distributions, it might work but no formal testing has been performed as yet!</p>"},{"location":"rpi_supported_os/#armbian","title":"Armbian","text":"<p>On Debian 11, Debian 12, Ubuntu 22.04 or 24.04 based distributions, might work but no formal testing has been performed as yet!</p>"},{"location":"rpi_supported_os/#btt-os","title":"BTT OS","text":"<p>On Debian 11, Debian 12 based, might work but no formal testing has been performed as yet!</p>"},{"location":"rpi_webcam/","title":"Crowsnest (Camera Support)","text":"<p>Crowsnest is automatically installed for you but a single webcam is configured and points at <code>/dev/video0</code>, this won't always end up being a valid webcam.</p> <p>To find out what devices are available you can use the crowsnest tool like so:</p> <pre><code>~/crowsnest/tools/dev-helper.sh -c\n</code></pre> <p></p> <p>Warning</p> <p>According to the crowsnest project, its always preferable to use full paths, especially in Mutlicam setups using /dev/video*  will lead to errors or unexpected behaviours.</p> <p>Source: https://crowsnest.mainsail.xyz/configuration/cam-section#device</p>"},{"location":"rpi_webcam/#rpi-camera","title":"Rpi Camera","text":"<p>I've not found a way to get the V1 cam working with rasbian 12, only with 11 and enable classic legacy cam support and then it just works.</p>"},{"location":"spoolman/","title":"Spoolman","text":"<p>Spoolman moonraker integration  is not enabled by default.  To enable it there are a few steps, you need to add the following include to printer.cfg:</p> <pre><code>[include spoolman.cfg]\n</code></pre> <p>And uncomment the <code>[include spoolman.conf]</code> in moonraker.conf, you will need to change the <code>server</code> url to your spoolman server location.</p> <p>You will need to restart moonraker and klipper after this, you can do that via the fluidd or mainsail services section.</p>"},{"location":"support/","title":"Support ZIP","text":"<p>If you have been asked to provide a <code>support.zip</code> file in the SimpleAF discord, there are a few ways to do this.</p>"},{"location":"support/#via-fluidd-or-mainsail","title":"Via Fluidd or Mainsail","text":"<p>Run the <code>SUPPORT_ZIP</code> macro from Fluidd or Mailsail</p> <p></p>"},{"location":"support/#via-grumpyscreen","title":"Via GrumpyScreen","text":"<p>Click the <code>Create Support ZIP</code> button from the Tools menu of GrumpyScreen, be sure to wait for the success message as it can take a while to generate the zip file.</p> <p></p>"},{"location":"support/#via-ssh","title":"Via SSH","text":"<p>Run <code>~/pellcorp/tools/support.sh</code> from ssh on the printer.</p>"},{"location":"support/#where-can-i-find-the-supportzip","title":"Where can I find the support.zip?","text":"<p>In all cases the support.zip can be found in the <code>~/printer_data/config</code> or the config section of fluidd or mailsail.</p> <p>You need to somehow download this zip file to your local desktop / laptop so you can then upload it to discord.</p> <p></p>"},{"location":"switch_to_stock/","title":"Switch to Stock","text":"<p>This feature allows you to quickly switch back to Stock Creality Klipper (aka Crapper) after installing Simple AF, and being able to quickly restore Simple AF without having to do a factory reset.  All that will be required after each switch is to power cycle at least once to get the MCUs updated with the correct firmware.   The use case for this feature is mostly about supporting Simple AF users who have a single printer and perhaps they need to switch back to stock to be able to print a mount or something.</p> <p>Existing users of Simple AF will have to factory reset at least once to get the correct Creality Stock configuration files correctly backed up, but for new users the feature will be available straight away.   If you have a <code>~/backups/creality-backup.tar.gz</code> file, you can use the feature.</p> <p>Its really important before you install Simple AF for the first time that you properly calibrate the printer in stock so that switching back allows you to immediately use the printer, the switch to stock process does not restore the printer to a completely stock configuration, as only klipper and the stock display are restored!</p>"},{"location":"switch_to_stock/#via-grumpyscreen","title":"Via GrumpyScreen","text":"<p>Click the <code>Switch to Stock</code> button from the Tools menu of GrumpyScreen.</p> <p></p> <p>Danger</p> <p>Ensure you wait for the confirmation message in GrumpyScreen before power cycling the printer!</p>"},{"location":"switch_to_stock/#via-ssh","title":"Via SSH","text":"<p>Switching to stock is as simple as running from ssh on the printer:</p> <pre><code>/usr/data/pellcorp/k1/switch-to-stock.sh\n</code></pre> <p>And then power cycling the printer after the script finishes execution</p>"},{"location":"switch_to_stock/#updating-stock-configuration","title":"Updating Stock Configuration","text":"<p>So if you installed Simple AF without calibrating your printer, the first time you switch to stock you will need to execute the first run calibration, do that and then run <code>/usr/data/pellcorp/k1/switch-to-stock.sh --update</code> to update the stock config files backup so that calibration can be reused on subsequent switch to stock usages, otherwise if you do not run the --update you will be forced to run the first run calibration every time you switch to stock!</p>"},{"location":"switch_to_stock/#switching-back-to-simple-af","title":"Switching back to Simple AF","text":"<p>You can easily switch back with:</p> <pre><code>/usr/data/pellcorp/k1/switch-to-stock.sh --revert\n</code></pre> <p>And power cycling the printer once again</p> <p>Danger</p> <p>Do not leave a probe mounted on the printer when you switch back to stock, this is especially important if you have  a rear mounted probe as it is very likely to be damaged when the printer does its nozzle wipe at the back of the printer</p> <p>Switching to stock does not allow using the printer with Helper Script, this is an emergency temporary mode!</p> <p>Switching to stock will leave moonraker, fluidd and mainsail accessible.   The stock screen is restored, but you must not try to perform a firmware upgrade in stock mode as this will most likely remove SimpleAF!</p>"},{"location":"switching_probes/","title":"Switching Probes","text":"<p>Switching a probe is fairly straightforward, the installer will remove any leftover calibrations, bed meshes and  axis twist calibrations for the old probe!</p>"},{"location":"switching_probes/#update-to-latest-repo","title":"Update to Latest Repo","text":"<p>Strongly recommended to update to latest Simple AF repo before switching, this does not change your installation, this just pulls the latest code from the github repo but does not change your installation.</p> <pre><code>~/pellcorp/installer.sh --branch main\n</code></pre> <p>Note</p> <p>If you run the above and receive an error like:</p> <pre><code>```\nroot@K1Max-AF34 /root [#] ~/pellcorp/installer.sh --branch main\n-sh: /root/pellcorp/installer.sh: not found\n```\n</code></pre> <p>It means you are on an older version of Simple AF and you should instead use the old style commands:</p> <pre><code>```\n/usr/data/pellcorp/k1/installer.sh --branch main\n~/pellcorp/installer.sh --update\n```\n</code></pre>"},{"location":"switching_probes/#switching-to-a-new-probe","title":"Switching to a new probe","text":"<p>So you can switch from any probe to any probe, the format of this is identical:</p> <pre><code>~/pellcorp/installer.sh --update TheNewProbe --mount TheMount\n</code></pre> <p>Where <code>TheNewProbe</code> is one of:</p> <ul> <li>cartographer</li> <li>cartotouch</li> <li>beacon</li> <li>bltouch</li> <li>microprobe</li> <li>klicky</li> <li>btteddy</li> <li>eddyng</li> </ul> <p>The <code>TheMount</code> is a specific mount as defined in the specific probe mount-options section!</p> <p>Note</p> <p>For switching from cartotouch to cartographer if you are using the same physical mount you can specify <code>--mount %CURRENT%</code></p>"},{"location":"switching_probes/#cleaning-up-save-configuration-from-previous-probe","title":"Cleaning up Save Configuration from previous probe","text":"<p>The installer has been updated to automatically remove configuration for the old probe, in addition it will remove any bed mesh and  axis twist configuration.</p>"},{"location":"updating/","title":"Updating","text":"<p>Completely updating Simple AF requires running the installer on the command line and also updating components from fluidd or mainsail.</p>"},{"location":"updating/#simple-af-installer","title":"Simple AF Installer","text":"<p>Simple AF cfg and conf files cannot be updated via Fluidd or Mainsail, it must be updated by using ssh to connect to the printer</p> <pre><code>~/pellcorp/installer.sh --branch main\n~/pellcorp/installer.sh --update\n</code></pre> <p>Note</p> <p>If you run the above and receive an error like:</p> <pre><code>```\nroot@K1Max-AF34 /root [#] ~/pellcorp/installer.sh --branch main\n-sh: /root/pellcorp/installer.sh: not found\n```\n</code></pre> <p>It means you are on an older version of Simple AF and you should instead use the old style commands:</p> <pre><code>```\n/usr/data/pellcorp/k1/installer.sh --branch main\n~/pellcorp/installer.sh --update\n```\n</code></pre> <p>If you get a <code>ERRROR: Mount option must be specified</code>, you must provide a <code>--mount TheMount</code> where <code>TheMount</code> is a reference to the mount you are currently using, and that will depend on what probe you are using, you can consult the #mount-options section of your specific probe wiki page.</p> <p>Warning</p> <p>If you specify a --mount option, even if its for the mount you are already using, its going to apply the mount override configuration on top of any local customisations you have, so only provide the --mount argument if you want to change mounts or you want to override your local customisations with those in the mount override config, for example if a fix was pushed for that specific mount override.</p> <p>This backs up your customisations, updates the creality repo, applies all changes to your <code>~/printer_data/config</code> directory and then reapplies your customisations over the top.</p>"},{"location":"updating/#fluidd-and-mainsail-updates","title":"Fluidd and Mainsail Updates","text":"<p>The following components can be updated via Fluidd / Mainsail Software Updates:</p> <ul> <li>beacon</li> <li>cartographer</li> <li>fluidd</li> <li>fluidd-config (aka client-macros)</li> <li>moonraker</li> <li>klipper</li> <li>mainsail</li> <li>timelapse (aka Moonraker Timelapse)</li> </ul> <p>You can update these components via Fluidd or Mainsail, in fluidd make sure you click the CHECK FOR UPDATES button, and in Mainsail click the Refresh button</p> <p>Note</p> <p>It is normal for moonraker and klipper to warn about <code>Unofficial remote url</code>, this is because Simple AF has forked these repositories.</p> <p></p>"},{"location":"updating/#reinstalling","title":"Reinstalling","text":"<p>A reinstall is only needed if one or more github repos have got into an inconsistent state, so you can force a reinstall with the <code>--reinstall</code> argument in place of the <code>--install</code> argument.  The difference to a <code>--install</code>, is a <code>--install</code> will only finish up a partial install that failed due to a network failure or the like.</p>"},{"location":"updating/#clean-reinstall","title":"Clean Reinstall","text":"<p>If you wish to reinstall Simple AF ignoring your pre-existing config overrides, the easiest approach is to first make sure Simple AF repo is up to date and on the right branch:</p> <pre><code>~/pellcorp/installer.sh --branch main\n</code></pre> <p>Then do a clean reinstall:</p> <pre><code>~/pellcorp/installer.sh --clean-reinstall cartographer\n</code></pre> <p>You can of course replace cartographer with any other applicable probe.</p> <p>This will ignore your local changes completely, and is almost 100% the same as doing a factory reset.</p> <p>Note</p> <p>If you run the above and receive an error like:</p> <pre><code>```\nroot@K1Max-AF34 /root [#] ~/pellcorp/installer.sh --clean-reinstall cartographer\n-sh: /root/pellcorp/installer.sh: not found\n```\n</code></pre> <p>It means you are on an older version of Simple AF and you should instead use the old style commands:</p> <pre><code>```\n/usr/data/pellcorp/k1/installer.sh --branch main\n~/pellcorp/installer.sh --clean-reinstall cartographer\n```\n</code></pre>"}]}